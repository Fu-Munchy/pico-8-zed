var vc=Object.create;var yi=Object.defineProperty;var Sc=Object.getOwnPropertyDescriptor;var xc=Object.getOwnPropertyNames;var kc=Object.getPrototypeOf,Tc=Object.prototype.hasOwnProperty;var Rc=n=>yi(n,"__esModule",{value:!0});var L=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var wc=(n,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of xc(e))!Tc.call(n,r)&&(t||r!=="default")&&yi(n,r,{get:()=>e[r],enumerable:!(i=Sc(e,r))||i.enumerable});return n},Ce=(n,e)=>wc(Rc(yi(n!=null?vc(kc(n)):{},"default",!e&&n&&n.__esModule?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var yn=L(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.thenable=ne.typedArray=ne.stringArray=ne.array=ne.func=ne.error=ne.number=ne.string=ne.boolean=void 0;function Cc(n){return n===!0||n===!1}ne.boolean=Cc;function Vr(n){return typeof n=="string"||n instanceof String}ne.string=Vr;function Ec(n){return typeof n=="number"||n instanceof Number}ne.number=Ec;function _c(n){return n instanceof Error}ne.error=_c;function zr(n){return typeof n=="function"}ne.func=zr;function Kr(n){return Array.isArray(n)}ne.array=Kr;function Dc(n){return Kr(n)&&n.every(e=>Vr(e))}ne.stringArray=Dc;function Pc(n,e){return Array.isArray(n)&&n.every(e)}ne.typedArray=Pc;function Nc(n){return n&&zr(n.then)}ne.thenable=Nc});var Me=L(xi=>{"use strict";Object.defineProperty(xi,"__esModule",{value:!0});var vi;function Si(){if(vi===void 0)throw new Error("No runtime abstraction layer installed");return vi}(function(n){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");vi=t}n.install=e})(Si||(Si={}));xi.default=Si});var ki=L(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.Disposable=void 0;var Lc;(function(n){function e(t){return{dispose:t}}n.create=e})(Lc=Wt.Disposable||(Wt.Disposable={}))});var Xr=L(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.AbstractMessageBuffer=void 0;var Fc=13,Ic=10,qc=`\r
`,Jr=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(){if(this._chunks.length===0)return;let e=0,t=0,i=0,r=0;e:for(;t<this._chunks.length;){let b=this._chunks[t];i=0;t:for(;i<b.length;){switch(b[i]){case Fc:switch(e){case 0:e=1;break;case 2:e=3;break;default:e=0}break;case Ic:switch(e){case 1:e=2;break;case 3:e=4,i++;break e;default:e=0}break;default:e=0}i++}r+=b.byteLength,t++}if(e!==4)return;let s=this._read(r+i),c=new Map,y=this.toString(s,"ascii").split(qc);if(y.length<2)return c;for(let b=0;b<y.length-2;b++){let x=y[b],k=x.indexOf(":");if(k===-1)throw new Error("Message header must separate key and value using :");let E=x.substr(0,k),C=x.substr(k+1).trim();c.set(E,C)}return c}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){let s=this._chunks[0],c=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,c}let t=this.allocNative(e),i=0,r=0;for(;e>0;){let s=this._chunks[r];if(s.byteLength>e){let c=s.slice(0,e);t.set(c,i),i+=e,this._chunks[r]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,i),i+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}};vn.AbstractMessageBuffer=Jr});var ts=L(Ri=>{"use strict";Object.defineProperty(Ri,"__esModule",{value:!0});var Oc=Me(),Yr=require("util"),ct=ki(),Ac=Xr(),Bt=class extends Ac.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return Bt.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new Yr.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}};Bt.emptyBuffer=Buffer.allocUnsafe(0);var Qr=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),ct.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),ct.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),ct.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),ct.Disposable.create(()=>this.stream.off("data",e))}},Zr=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),ct.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),ct.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),ct.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((i,r)=>{let s=c=>{c==null?i():r(c)};typeof e=="string"?this.stream.write(e,t,s):this.stream.write(e,s)})}end(){this.stream.end()}},es=Object.freeze({messageBuffer:Object.freeze({create:n=>new Bt(n)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(n,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(n,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(n,e)=>{try{return n instanceof Buffer?Promise.resolve(JSON.parse(n.toString(e.charset))):Promise.resolve(JSON.parse(new Yr.TextDecoder(e.charset).decode(n)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:n=>new Qr(n),asWritableStream:n=>new Zr(n)}),console,timer:Object.freeze({setTimeout(n,e,...t){return setTimeout(n,e,...t)},clearTimeout(n){clearTimeout(n)},setImmediate(n,...e){return setImmediate(n,...e)},clearImmediate(n){clearImmediate(n)}})});function Ti(){return es}(function(n){function e(){Oc.default.install(es)}n.install=e})(Ti||(Ti={}));Ri.default=Ti});var kt=L(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});de.stringArray=de.array=de.func=de.error=de.number=de.string=de.boolean=void 0;function Mc(n){return n===!0||n===!1}de.boolean=Mc;function ns(n){return typeof n=="string"||n instanceof String}de.string=ns;function jc(n){return typeof n=="number"||n instanceof Number}de.number=jc;function Wc(n){return n instanceof Error}de.error=Wc;function Bc(n){return typeof n=="function"}de.func=Bc;function is(n){return Array.isArray(n)}de.array=is;function Uc(n){return is(n)&&n.every(e=>ns(e))}de.stringArray=Uc});var wi=L(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.isResponseMessage=P.isNotificationMessage=P.isRequestMessage=P.NotificationType9=P.NotificationType8=P.NotificationType7=P.NotificationType6=P.NotificationType5=P.NotificationType4=P.NotificationType3=P.NotificationType2=P.NotificationType1=P.NotificationType0=P.NotificationType=P.RequestType9=P.RequestType8=P.RequestType7=P.RequestType6=P.RequestType5=P.RequestType4=P.RequestType3=P.RequestType2=P.RequestType1=P.RequestType=P.RequestType0=P.AbstractMessageSignature=P.ParameterStructures=P.ResponseError=P.ErrorCodes=void 0;var lt=kt(),rs;(function(n){n.ParseError=-32700,n.InvalidRequest=-32600,n.MethodNotFound=-32601,n.InvalidParams=-32602,n.InternalError=-32603,n.jsonrpcReservedErrorRangeStart=-32099,n.serverErrorStart=n.jsonrpcReservedErrorRangeStart,n.MessageWriteError=-32099,n.MessageReadError=-32098,n.ServerNotInitialized=-32002,n.UnknownErrorCode=-32001,n.jsonrpcReservedErrorRangeEnd=-32e3,n.serverErrorEnd=n.jsonrpcReservedErrorRangeEnd})(rs=P.ErrorCodes||(P.ErrorCodes={}));var Sn=class extends Error{constructor(e,t,i){super(t);this.code=lt.number(e)?e:rs.UnknownErrorCode,this.data=i,Object.setPrototypeOf(this,Sn.prototype)}toJson(){return{code:this.code,message:this.message,data:this.data}}};P.ResponseError=Sn;var ue=class{constructor(e){this.kind=e}static is(e){return e===ue.auto||e===ue.byName||e===ue.byPosition}toString(){return this.kind}};P.ParameterStructures=ue;ue.auto=new ue("auto");ue.byPosition=new ue("byPosition");ue.byName=new ue("byName");var Z=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return ue.auto}};P.AbstractMessageSignature=Z;var ss=class extends Z{constructor(e){super(e,0)}};P.RequestType0=ss;var os=class extends Z{constructor(e,t=ue.auto){super(e,1);this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};P.RequestType=os;var as=class extends Z{constructor(e,t=ue.auto){super(e,1);this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};P.RequestType1=as;var cs=class extends Z{constructor(e){super(e,2)}};P.RequestType2=cs;var ls=class extends Z{constructor(e){super(e,3)}};P.RequestType3=ls;var us=class extends Z{constructor(e){super(e,4)}};P.RequestType4=us;var ds=class extends Z{constructor(e){super(e,5)}};P.RequestType5=ds;var hs=class extends Z{constructor(e){super(e,6)}};P.RequestType6=hs;var fs=class extends Z{constructor(e){super(e,7)}};P.RequestType7=fs;var ps=class extends Z{constructor(e){super(e,8)}};P.RequestType8=ps;var ms=class extends Z{constructor(e){super(e,9)}};P.RequestType9=ms;var gs=class extends Z{constructor(e,t=ue.auto){super(e,1);this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};P.NotificationType=gs;var bs=class extends Z{constructor(e){super(e,0)}};P.NotificationType0=bs;var ys=class extends Z{constructor(e,t=ue.auto){super(e,1);this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};P.NotificationType1=ys;var vs=class extends Z{constructor(e){super(e,2)}};P.NotificationType2=vs;var Ss=class extends Z{constructor(e){super(e,3)}};P.NotificationType3=Ss;var xs=class extends Z{constructor(e){super(e,4)}};P.NotificationType4=xs;var ks=class extends Z{constructor(e){super(e,5)}};P.NotificationType5=ks;var Ts=class extends Z{constructor(e){super(e,6)}};P.NotificationType6=Ts;var Rs=class extends Z{constructor(e){super(e,7)}};P.NotificationType7=Rs;var ws=class extends Z{constructor(e){super(e,8)}};P.NotificationType8=ws;var Cs=class extends Z{constructor(e){super(e,9)}};P.NotificationType9=Cs;function Gc(n){let e=n;return e&&lt.string(e.method)&&(lt.string(e.id)||lt.number(e.id))}P.isRequestMessage=Gc;function $c(n){let e=n;return e&&lt.string(e.method)&&n.id===void 0}P.isNotificationMessage=$c;function Hc(n){let e=n;return e&&(e.result!==void 0||!!e.error)&&(lt.string(e.id)||lt.number(e.id)||e.id===null)}P.isResponseMessage=Hc});var Tt=L(ut=>{"use strict";Object.defineProperty(ut,"__esModule",{value:!0});ut.Emitter=ut.Event=void 0;var Vc=Me(),zc;(function(n){let e={dispose(){}};n.None=function(){return e}})(zc=ut.Event||(ut.Event={}));var Es=class{add(e,t=null,i){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(i)&&i.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let i=!1;for(let r=0,s=this._callbacks.length;r<s;r++)if(this._callbacks[r]===e)if(this._contexts[r]===t){this._callbacks.splice(r,1),this._contexts.splice(r,1);return}else i=!0;if(i)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],i=this._callbacks.slice(0),r=this._contexts.slice(0);for(let s=0,c=i.length;s<c;s++)try{t.push(i[s].apply(r[s],e))}catch(y){Vc.default().console.error(y)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},Ut=class{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,i)=>{this._callbacks||(this._callbacks=new Es),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let r={dispose:()=>{!this._callbacks||(this._callbacks.remove(e,t),r.dispose=Ut._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(i)&&i.push(r),r}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};ut.Emitter=Ut;Ut._noop=function(){}});var Di=L(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.CancellationTokenSource=dt.CancellationToken=void 0;var _s=Me(),Kc=kt(),Ci=Tt(),Ei;(function(n){n.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:Ci.Event.None}),n.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:Ci.Event.None});function e(t){let i=t;return i&&(i===n.None||i===n.Cancelled||Kc.boolean(i.isCancellationRequested)&&!!i.onCancellationRequested)}n.is=e})(Ei=dt.CancellationToken||(dt.CancellationToken={}));var Jc=Object.freeze(function(n,e){let t=_s.default().timer.setTimeout(n.bind(e),0);return{dispose(){_s.default().timer.clearTimeout(t)}}}),_i=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Jc:(this._emitter||(this._emitter=new Ci.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},Ds=class{get token(){return this._token||(this._token=new _i),this._token}cancel(){this._token?this._token.cancel():this._token=Ei.Cancelled}dispose(){this._token?this._token instanceof _i&&this._token.dispose():this._token=Ei.None}};dt.CancellationTokenSource=Ds});var Ns=L(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.ReadableStreamMessageReader=je.AbstractMessageReader=je.MessageReader=void 0;var xn=Me(),Rt=kt(),Pi=Tt(),Xc;(function(n){function e(t){let i=t;return i&&Rt.func(i.listen)&&Rt.func(i.dispose)&&Rt.func(i.onError)&&Rt.func(i.onClose)&&Rt.func(i.onPartialMessage)}n.is=e})(Xc=je.MessageReader||(je.MessageReader={}));var Ni=class{constructor(){this.errorEmitter=new Pi.Emitter,this.closeEmitter=new Pi.Emitter,this.partialMessageEmitter=new Pi.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${Rt.string(e.message)?e.message:"unknown"}`)}};je.AbstractMessageReader=Ni;var Li;(function(n){function e(t){var i;let r,s,c,y=new Map,b,x=new Map;if(t===void 0||typeof t=="string")r=t??"utf-8";else{if(r=(i=t.charset)!==null&&i!==void 0?i:"utf-8",t.contentDecoder!==void 0&&(c=t.contentDecoder,y.set(c.name,c)),t.contentDecoders!==void 0)for(let k of t.contentDecoders)y.set(k.name,k);if(t.contentTypeDecoder!==void 0&&(b=t.contentTypeDecoder,x.set(b.name,b)),t.contentTypeDecoders!==void 0)for(let k of t.contentTypeDecoders)x.set(k.name,k)}return b===void 0&&(b=xn.default().applicationJson.decoder,x.set(b.name,b)),{charset:r,contentDecoder:c,contentDecoders:y,contentTypeDecoder:b,contentTypeDecoders:x}}n.fromOptions=e})(Li||(Li={}));var Ps=class extends Ni{constructor(e,t){super();this.readable=e,this.options=Li.fromOptions(t),this.buffer=xn.default().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(i=>{this.onData(i)});return this.readable.onError(i=>this.fireError(i)),this.readable.onClose(()=>this.fireClose()),t}onData(e){for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let r=this.buffer.tryReadHeaders();if(!r)return;let s=r.get("Content-Length");if(!s)throw new Error("Header must provide a Content-Length property.");let c=parseInt(s);if(isNaN(c))throw new Error("Content-Length value must be a number.");this.nextMessageLength=c}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1;let i;this.options.contentDecoder!==void 0?i=this.options.contentDecoder.decode(t):i=Promise.resolve(t),i.then(r=>{this.options.contentTypeDecoder.decode(r,this.options).then(s=>{this.callback(s)},s=>{this.fireError(s)})},r=>{this.fireError(r)})}}clearPartialMessageTimer(){this.partialMessageTimer&&(xn.default().timer.clearTimeout(this.partialMessageTimer),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=xn.default().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};je.ReadableStreamMessageReader=Ps});var Fs=L(kn=>{"use strict";Object.defineProperty(kn,"__esModule",{value:!0});kn.Semaphore=void 0;var Yc=Me(),Ls=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,i)=>{this._waiting.push({thunk:e,resolve:t,reject:i}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||Yc.default().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(i=>{this._active--,e.resolve(i),this.runNext()},i=>{this._active--,e.reject(i),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};kn.Semaphore=Ls});var Ms=L(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});We.WriteableStreamMessageWriter=We.AbstractMessageWriter=We.MessageWriter=void 0;var Is=Me(),Gt=kt(),Qc=Fs(),qs=Tt(),Zc="Content-Length: ",Os=`\r
`,el;(function(n){function e(t){let i=t;return i&&Gt.func(i.dispose)&&Gt.func(i.onClose)&&Gt.func(i.onError)&&Gt.func(i.write)}n.is=e})(el=We.MessageWriter||(We.MessageWriter={}));var Fi=class{constructor(){this.errorEmitter=new qs.Emitter,this.closeEmitter=new qs.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,i){this.errorEmitter.fire([this.asError(e),t,i])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${Gt.string(e.message)?e.message:"unknown"}`)}};We.AbstractMessageWriter=Fi;var Ii;(function(n){function e(t){var i,r;return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:Is.default().applicationJson.encoder}:{charset:(i=t.charset)!==null&&i!==void 0?i:"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:(r=t.contentTypeEncoder)!==null&&r!==void 0?r:Is.default().applicationJson.encoder}}n.fromOptions=e})(Ii||(Ii={}));var As=class extends Fi{constructor(e,t){super();this.writable=e,this.options=Ii.fromOptions(t),this.errorCount=0,this.writeSemaphore=new Qc.Semaphore(1),this.writable.onError(i=>this.fireError(i)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(i=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(i):i).then(i=>{let r=[];return r.push(Zc,i.byteLength.toString(),Os),r.push(Os),this.doWrite(e,r,i)},i=>{throw this.fireError(i),i}))}async doWrite(e,t,i){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(i)}catch(r){return this.handleError(r,e),Promise.reject(r)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}};We.WriteableStreamMessageWriter=As});var Ws=L(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.LRUCache=Be.LinkedMap=Be.Touch=void 0;var fe;(function(n){n.None=0,n.First=1,n.AsOld=n.First,n.Last=2,n.AsNew=n.Last})(fe=Be.Touch||(Be.Touch={}));var qi=class{constructor(){this[Symbol.toStringTag]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){var e;return(e=this._head)===null||e===void 0?void 0:e.value}get last(){var e;return(e=this._tail)===null||e===void 0?void 0:e.value}has(e){return this._map.has(e)}get(e,t=fe.None){let i=this._map.get(e);if(!!i)return t!==fe.None&&this.touch(i,t),i.value}set(e,t,i=fe.None){let r=this._map.get(e);if(r)r.value=t,i!==fe.None&&this.touch(r,i);else{switch(r={key:e,value:t,next:void 0,previous:void 0},i){case fe.None:this.addItemLast(r);break;case fe.First:this.addItemFirst(r);break;case fe.Last:this.addItemLast(r);break;default:this.addItemLast(r);break}this._map.set(e,r),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(!!t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let i=this._state,r=this._head;for(;r;){if(t?e.bind(t)(r.value,r.key,this):e(r.value,r.key,this),this._state!==i)throw new Error("LinkedMap got modified during iteration.");r=r.next}}keys(){let e=this,t=this._state,i=this._head,r={[Symbol.iterator](){return r},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(i){let s={value:i.key,done:!1};return i=i.next,s}else return{value:void 0,done:!0}}};return r}values(){let e=this,t=this._state,i=this._head,r={[Symbol.iterator](){return r},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(i){let s={value:i.value,done:!1};return i=i.next,s}else return{value:void 0,done:!0}}};return r}entries(){let e=this,t=this._state,i=this._head,r={[Symbol.iterator](){return r},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(i){let s={value:[i.key,i.value],done:!1};return i=i.next,s}else return{value:void 0,done:!0}}};return r}[Symbol.iterator](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,i=this.size;for(;t&&i>e;)this._map.delete(t.key),t=t.next,i--;this._head=t,this._size=i,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,i=e.previous;if(!t||!i)throw new Error("Invalid list");t.previous=i,i.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==fe.First&&t!==fe.Last)){if(t===fe.First){if(e===this._head)return;let i=e.next,r=e.previous;e===this._tail?(r.next=void 0,this._tail=r):(i.previous=r,r.next=i),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===fe.Last){if(e===this._tail)return;let i=e.next,r=e.previous;e===this._head?(i.previous=void 0,this._head=i):(i.previous=r,r.next=i),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,i)=>{e.push([i,t])}),e}fromJSON(e){this.clear();for(let[t,i]of e)this.set(t,i)}};Be.LinkedMap=qi;var js=class extends qi{constructor(e,t=1){super();this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=fe.AsNew){return super.get(e,t)}peek(e){return super.get(e,fe.None)}set(e,t){return super.set(e,t,fe.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};Be.LRUCache=js});var Vs=L(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});A.createMessageConnection=A.ConnectionOptions=A.CancellationStrategy=A.CancellationSenderStrategy=A.CancellationReceiverStrategy=A.ConnectionStrategy=A.ConnectionError=A.ConnectionErrors=A.LogTraceNotification=A.SetTraceNotification=A.TraceFormat=A.Trace=A.NullLogger=A.ProgressType=void 0;var Bs=Me(),ae=kt(),O=wi(),Us=Ws(),$t=Tt(),Oi=Di(),Ht;(function(n){n.type=new O.NotificationType("$/cancelRequest")})(Ht||(Ht={}));var Tn;(function(n){n.type=new O.NotificationType("$/progress")})(Tn||(Tn={}));var Gs=class{constructor(){}};A.ProgressType=Gs;var Ai;(function(n){function e(t){return ae.func(t)}n.is=e})(Ai||(Ai={}));A.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var ie;(function(n){n[n.Off=0]="Off",n[n.Messages=1]="Messages",n[n.Verbose=2]="Verbose"})(ie=A.Trace||(A.Trace={}));(function(n){function e(i){if(!ae.string(i))return n.Off;switch(i=i.toLowerCase(),i){case"off":return n.Off;case"messages":return n.Messages;case"verbose":return n.Verbose;default:return n.Off}}n.fromString=e;function t(i){switch(i){case n.Off:return"off";case n.Messages:return"messages";case n.Verbose:return"verbose";default:return"off"}}n.toString=t})(ie=A.Trace||(A.Trace={}));var Ee;(function(n){n.Text="text",n.JSON="json"})(Ee=A.TraceFormat||(A.TraceFormat={}));(function(n){function e(t){return t=t.toLowerCase(),t==="json"?n.JSON:n.Text}n.fromString=e})(Ee=A.TraceFormat||(A.TraceFormat={}));var $s;(function(n){n.type=new O.NotificationType("$/setTrace")})($s=A.SetTraceNotification||(A.SetTraceNotification={}));var Mi;(function(n){n.type=new O.NotificationType("$/logTrace")})(Mi=A.LogTraceNotification||(A.LogTraceNotification={}));var Rn;(function(n){n[n.Closed=1]="Closed",n[n.Disposed=2]="Disposed",n[n.AlreadyListening=3]="AlreadyListening"})(Rn=A.ConnectionErrors||(A.ConnectionErrors={}));var ht=class extends Error{constructor(e,t){super(t);this.code=e,Object.setPrototypeOf(this,ht.prototype)}};A.ConnectionError=ht;var Hs;(function(n){function e(t){let i=t;return i&&ae.func(i.cancelUndispatched)}n.is=e})(Hs=A.ConnectionStrategy||(A.ConnectionStrategy={}));var ji;(function(n){n.Message=Object.freeze({createCancellationTokenSource(t){return new Oi.CancellationTokenSource}});function e(t){let i=t;return i&&ae.func(i.createCancellationTokenSource)}n.is=e})(ji=A.CancellationReceiverStrategy||(A.CancellationReceiverStrategy={}));var Wi;(function(n){n.Message=Object.freeze({sendCancellation(t,i){t.sendNotification(Ht.type,{id:i})},cleanup(t){}});function e(t){let i=t;return i&&ae.func(i.sendCancellation)&&ae.func(i.cleanup)}n.is=e})(Wi=A.CancellationSenderStrategy||(A.CancellationSenderStrategy={}));var Bi;(function(n){n.Message=Object.freeze({receiver:ji.Message,sender:Wi.Message});function e(t){let i=t;return i&&ji.is(i.receiver)&&Wi.is(i.sender)}n.is=e})(Bi=A.CancellationStrategy||(A.CancellationStrategy={}));var tl;(function(n){function e(t){let i=t;return i&&(Bi.is(i.cancellationStrategy)||Hs.is(i.connectionStrategy))}n.is=e})(tl=A.ConnectionOptions||(A.ConnectionOptions={}));var _e;(function(n){n[n.New=1]="New",n[n.Listening=2]="Listening",n[n.Closed=3]="Closed",n[n.Disposed=4]="Disposed"})(_e||(_e={}));function nl(n,e,t,i){let r=t!==void 0?t:A.NullLogger,s=0,c=0,y=0,b="2.0",x,k=Object.create(null),E,C=Object.create(null),D=new Map,N,$=new Us.LinkedMap,B=Object.create(null),v=Object.create(null),g=ie.Off,R=Ee.Text,I,U=_e.New,be=new $t.Emitter,yt=new $t.Emitter,tt=new $t.Emitter,nt=new $t.Emitter,it=new $t.Emitter,rt=i&&i.cancellationStrategy?i.cancellationStrategy:Bi.Message;function st(f){if(f===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+f.toString()}function dn(f){return f===null?"res-unknown-"+(++y).toString():"res-"+f.toString()}function ti(){return"not-"+(++c).toString()}function ni(f,d){O.isRequestMessage(d)?f.set(st(d.id),d):O.isResponseMessage(d)?f.set(dn(d.id),d):f.set(ti(),d)}function ii(f){}function vt(){return U===_e.Listening}function hn(){return U===_e.Closed}function Fe(){return U===_e.Disposed}function At(){(U===_e.New||U===_e.Listening)&&(U=_e.Closed,yt.fire(void 0))}function ri(f){be.fire([f,void 0,void 0])}function si(f){be.fire(f)}n.onClose(At),n.onError(ri),e.onClose(At),e.onError(si);function fn(){N||$.size===0||(N=Bs.default().timer.setImmediate(()=>{N=void 0,oi()}))}function oi(){if($.size===0)return;let f=$.shift();try{O.isRequestMessage(f)?ci(f):O.isNotificationMessage(f)?Mt(f):O.isResponseMessage(f)?li(f):ui(f)}finally{fn()}}let ai=f=>{try{if(O.isNotificationMessage(f)&&f.method===Ht.type.method){let d=st(f.params.id),a=$.get(d);if(O.isRequestMessage(a)){let h=i==null?void 0:i.connectionStrategy,p=h&&h.cancelUndispatched?h.cancelUndispatched(a,ii):void 0;if(p&&(p.error!==void 0||p.result!==void 0)){$.delete(d),p.id=a.id,St(p,f.method,Date.now()),e.write(p);return}}}ni($,f)}finally{fn()}};function ci(f){if(Fe())return;function d(S,_,F){let W={jsonrpc:b,id:f.id};S instanceof O.ResponseError?W.error=S.toJson():W.result=S===void 0?null:S,St(W,_,F),e.write(W)}function a(S,_,F){let W={jsonrpc:b,id:f.id,error:S.toJson()};St(W,_,F),e.write(W)}function h(S,_,F){S===void 0&&(S=null);let W={jsonrpc:b,id:f.id,result:S};St(W,_,F),e.write(W)}fi(f);let p=k[f.method],l,o;p&&(l=p.type,o=p.handler);let m=Date.now();if(o||x){let S=String(f.id),_=rt.receiver.createCancellationTokenSource(S);v[S]=_;try{let F;if(o)if(f.params===void 0){if(l!==void 0&&l.numberOfParams!==0){a(new O.ResponseError(O.ErrorCodes.InvalidParams,`Request ${f.method} defines ${l.numberOfParams} params but recevied none.`),f.method,m);return}F=o(_.token)}else if(Array.isArray(f.params)){if(l!==void 0&&l.parameterStructures===O.ParameterStructures.byName){a(new O.ResponseError(O.ErrorCodes.InvalidParams,`Request ${f.method} defines parameters by name but received parameters by position`),f.method,m);return}F=o(...f.params,_.token)}else{if(l!==void 0&&l.parameterStructures===O.ParameterStructures.byPosition){a(new O.ResponseError(O.ErrorCodes.InvalidParams,`Request ${f.method} defines parameters by position but received parameters by name`),f.method,m);return}F=o(f.params,_.token)}else x&&(F=x(f.method,f.params,_.token));let W=F;F?W.then?W.then(Y=>{delete v[S],d(Y,f.method,m)},Y=>{delete v[S],Y instanceof O.ResponseError?a(Y,f.method,m):Y&&ae.string(Y.message)?a(new O.ResponseError(O.ErrorCodes.InternalError,`Request ${f.method} failed with message: ${Y.message}`),f.method,m):a(new O.ResponseError(O.ErrorCodes.InternalError,`Request ${f.method} failed unexpectedly without providing any details.`),f.method,m)}):(delete v[S],d(F,f.method,m)):(delete v[S],h(F,f.method,m))}catch(F){delete v[S],F instanceof O.ResponseError?d(F,f.method,m):F&&ae.string(F.message)?a(new O.ResponseError(O.ErrorCodes.InternalError,`Request ${f.method} failed with message: ${F.message}`),f.method,m):a(new O.ResponseError(O.ErrorCodes.InternalError,`Request ${f.method} failed unexpectedly without providing any details.`),f.method,m)}}else a(new O.ResponseError(O.ErrorCodes.MethodNotFound,`Unhandled method ${f.method}`),f.method,m)}function li(f){if(!Fe())if(f.id===null)f.error?r.error(`Received response message without id: Error is: 
${JSON.stringify(f.error,void 0,4)}`):r.error("Received response message without id. No further error information provided.");else{let d=String(f.id),a=B[d];if(mi(f,a),a){delete B[d];try{if(f.error){let h=f.error;a.reject(new O.ResponseError(h.code,h.message,h.data))}else if(f.result!==void 0)a.resolve(f.result);else throw new Error("Should never happen.")}catch(h){h.message?r.error(`Response handler '${a.method}' failed with message: ${h.message}`):r.error(`Response handler '${a.method}' failed unexpectedly.`)}}}}function Mt(f){if(Fe())return;let d,a;if(f.method===Ht.type.method)a=h=>{let p=h.id,l=v[String(p)];l&&l.cancel()};else{let h=C[f.method];h&&(a=h.handler,d=h.type)}if(a||E)try{pi(f),a?f.params===void 0?(d!==void 0&&d.numberOfParams!==0&&d.parameterStructures!==O.ParameterStructures.byName&&r.error(`Notification ${f.method} defines ${d.numberOfParams} params but recevied none.`),a()):Array.isArray(f.params)?(d!==void 0&&(d.parameterStructures===O.ParameterStructures.byName&&r.error(`Notification ${f.method} defines parameters by name but received parameters by position`),d.numberOfParams!==f.params.length&&r.error(`Notification ${f.method} defines ${d.numberOfParams} params but received ${f.params.length} argumennts`)),a(...f.params)):(d!==void 0&&d.parameterStructures===O.ParameterStructures.byPosition&&r.error(`Notification ${f.method} defines parameters by position but received parameters by name`),a(f.params)):E&&E(f.method,f.params)}catch(h){h.message?r.error(`Notification handler '${f.method}' failed with message: ${h.message}`):r.error(`Notification handler '${f.method}' failed unexpectedly.`)}else tt.fire(f)}function ui(f){if(!f){r.error("Received empty message.");return}r.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(f,null,4)}`);let d=f;if(ae.string(d.id)||ae.number(d.id)){let a=String(d.id),h=B[a];h&&h.reject(new Error("The received response has neither a result nor an error property."))}}function di(f){if(!(g===ie.Off||!I))if(R===Ee.Text){let d;g===ie.Verbose&&f.params&&(d=`Params: ${JSON.stringify(f.params,null,4)}

`),I.log(`Sending request '${f.method} - (${f.id})'.`,d)}else Ve("send-request",f)}function hi(f){if(!(g===ie.Off||!I))if(R===Ee.Text){let d;g===ie.Verbose&&(f.params?d=`Params: ${JSON.stringify(f.params,null,4)}

`:d=`No parameters provided.

`),I.log(`Sending notification '${f.method}'.`,d)}else Ve("send-notification",f)}function St(f,d,a){if(!(g===ie.Off||!I))if(R===Ee.Text){let h;g===ie.Verbose&&(f.error&&f.error.data?h=`Error data: ${JSON.stringify(f.error.data,null,4)}

`:f.result?h=`Result: ${JSON.stringify(f.result,null,4)}

`:f.error===void 0&&(h=`No result returned.

`)),I.log(`Sending response '${d} - (${f.id})'. Processing request took ${Date.now()-a}ms`,h)}else Ve("send-response",f)}function fi(f){if(!(g===ie.Off||!I))if(R===Ee.Text){let d;g===ie.Verbose&&f.params&&(d=`Params: ${JSON.stringify(f.params,null,4)}

`),I.log(`Received request '${f.method} - (${f.id})'.`,d)}else Ve("receive-request",f)}function pi(f){if(!(g===ie.Off||!I||f.method===Mi.type.method))if(R===Ee.Text){let d;g===ie.Verbose&&(f.params?d=`Params: ${JSON.stringify(f.params,null,4)}

`:d=`No parameters provided.

`),I.log(`Received notification '${f.method}'.`,d)}else Ve("receive-notification",f)}function mi(f,d){if(!(g===ie.Off||!I))if(R===Ee.Text){let a;if(g===ie.Verbose&&(f.error&&f.error.data?a=`Error data: ${JSON.stringify(f.error.data,null,4)}

`:f.result?a=`Result: ${JSON.stringify(f.result,null,4)}

`:f.error===void 0&&(a=`No result returned.

`)),d){let h=f.error?` Request failed: ${f.error.message} (${f.error.code}).`:"";I.log(`Received response '${d.method} - (${f.id})' in ${Date.now()-d.timerStart}ms.${h}`,a)}else I.log(`Received response ${f.id} without active response promise.`,a)}else Ve("receive-response",f)}function Ve(f,d){if(!I||g===ie.Off)return;let a={isLSPMessage:!0,type:f,message:d,timestamp:Date.now()};I.log(a)}function ot(){if(hn())throw new ht(Rn.Closed,"Connection is closed.");if(Fe())throw new ht(Rn.Disposed,"Connection is disposed.")}function gi(){if(vt())throw new ht(Rn.AlreadyListening,"Connection is already listening")}function bi(){if(!vt())throw new Error("Call listen() first.")}function at(f){return f===void 0?null:f}function pn(f){if(f!==null)return f}function mn(f){return f!=null&&!Array.isArray(f)&&typeof f=="object"}function jt(f,d){switch(f){case O.ParameterStructures.auto:return mn(d)?pn(d):[at(d)];case O.ParameterStructures.byName:if(!mn(d))throw new Error("Recevied parameters by name but param is not an object literal.");return pn(d);case O.ParameterStructures.byPosition:return[at(d)];default:throw new Error(`Unknown parameter structure ${f.toString()}`)}}function gn(f,d){let a,h=f.numberOfParams;switch(h){case 0:a=void 0;break;case 1:a=jt(f.parameterStructures,d[0]);break;default:a=[];for(let p=0;p<d.length&&p<h;p++)a.push(at(d[p]));if(d.length<h)for(let p=d.length;p<h;p++)a.push(null);break}return a}let ze={sendNotification:(f,...d)=>{ot();let a,h;if(ae.string(f)){a=f;let l=d[0],o=0,m=O.ParameterStructures.auto;O.ParameterStructures.is(l)&&(o=1,m=l);let S=d.length,_=S-o;switch(_){case 0:h=void 0;break;case 1:h=jt(m,d[o]);break;default:if(m===O.ParameterStructures.byName)throw new Error(`Recevied ${_} parameters for 'by Name' notification parameter structure.`);h=d.slice(o,S).map(F=>at(F));break}}else{let l=d;a=f.method,h=gn(f,l)}let p={jsonrpc:b,method:a,params:h};hi(p),e.write(p)},onNotification:(f,d)=>{ot();let a;return ae.func(f)?E=f:d&&(ae.string(f)?(a=f,C[f]={type:void 0,handler:d}):(a=f.method,C[f.method]={type:f,handler:d})),{dispose:()=>{a!==void 0?delete C[a]:E=void 0}}},onProgress:(f,d,a)=>{if(D.has(d))throw new Error(`Progress handler for token ${d} already registered`);return D.set(d,a),{dispose:()=>{D.delete(d)}}},sendProgress:(f,d,a)=>{ze.sendNotification(Tn.type,{token:d,value:a})},onUnhandledProgress:nt.event,sendRequest:(f,...d)=>{ot(),bi();let a,h,p;if(ae.string(f)){a=f;let S=d[0],_=d[d.length-1],F=0,W=O.ParameterStructures.auto;O.ParameterStructures.is(S)&&(F=1,W=S);let Y=d.length;Oi.CancellationToken.is(_)&&(Y=Y-1,p=_);let se=Y-F;switch(se){case 0:h=void 0;break;case 1:h=jt(W,d[F]);break;default:if(W===O.ParameterStructures.byName)throw new Error(`Recevied ${se} parameters for 'by Name' request parameter structure.`);h=d.slice(F,Y).map(oe=>at(oe));break}}else{let S=d;a=f.method,h=gn(f,S);let _=f.numberOfParams;p=Oi.CancellationToken.is(S[_])?S[_]:void 0}let l=s++,o;return p&&(o=p.onCancellationRequested(()=>{rt.sender.sendCancellation(ze,l)})),new Promise((S,_)=>{let F={jsonrpc:b,id:l,method:a,params:h},W=oe=>{S(oe),rt.sender.cleanup(l),o==null||o.dispose()},Y=oe=>{_(oe),rt.sender.cleanup(l),o==null||o.dispose()},se={method:a,timerStart:Date.now(),resolve:W,reject:Y};di(F);try{e.write(F)}catch(oe){se.reject(new O.ResponseError(O.ErrorCodes.MessageWriteError,oe.message?oe.message:"Unknown reason")),se=null}se&&(B[String(l)]=se)})},onRequest:(f,d)=>{ot();let a=null;return Ai.is(f)?(a=void 0,x=f):ae.string(f)?(a=null,d!==void 0&&(a=f,k[f]={handler:d,type:void 0})):d!==void 0&&(a=f.method,k[f.method]={type:f,handler:d}),{dispose:()=>{a!==null&&(a!==void 0?delete k[a]:x=void 0)}}},trace:(f,d,a)=>{let h=!1,p=Ee.Text;a!==void 0&&(ae.boolean(a)?h=a:(h=a.sendNotification||!1,p=a.traceFormat||Ee.Text)),g=f,R=p,g===ie.Off?I=void 0:I=d,h&&!hn()&&!Fe()&&ze.sendNotification($s.type,{value:ie.toString(f)})},onError:be.event,onClose:yt.event,onUnhandledNotification:tt.event,onDispose:it.event,end:()=>{e.end()},dispose:()=>{if(Fe())return;U=_e.Disposed,it.fire(void 0);let f=new Error("Connection got disposed.");Object.keys(B).forEach(d=>{B[d].reject(f)}),B=Object.create(null),v=Object.create(null),$=new Us.LinkedMap,ae.func(e.dispose)&&e.dispose(),ae.func(n.dispose)&&n.dispose()},listen:()=>{ot(),gi(),U=_e.Listening,n.listen(ai)},inspect:()=>{Bs.default().console.log("inspect")}};return ze.onNotification(Mi.type,f=>{g===ie.Off||!I||I.log(f.message,g===ie.Verbose?f.verbose:void 0)}),ze.onNotification(Tn.type,f=>{let d=D.get(f.token);d?d(f.value):nt.fire(f)}),ze}A.createMessageConnection=nl});var $i=L(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.CancellationSenderStrategy=T.CancellationReceiverStrategy=T.ConnectionError=T.ConnectionErrors=T.LogTraceNotification=T.SetTraceNotification=T.TraceFormat=T.Trace=T.ProgressType=T.createMessageConnection=T.NullLogger=T.ConnectionOptions=T.ConnectionStrategy=T.WriteableStreamMessageWriter=T.AbstractMessageWriter=T.MessageWriter=T.ReadableStreamMessageReader=T.AbstractMessageReader=T.MessageReader=T.CancellationToken=T.CancellationTokenSource=T.Emitter=T.Event=T.Disposable=T.ParameterStructures=T.NotificationType9=T.NotificationType8=T.NotificationType7=T.NotificationType6=T.NotificationType5=T.NotificationType4=T.NotificationType3=T.NotificationType2=T.NotificationType1=T.NotificationType0=T.NotificationType=T.ErrorCodes=T.ResponseError=T.RequestType9=T.RequestType8=T.RequestType7=T.RequestType6=T.RequestType5=T.RequestType4=T.RequestType3=T.RequestType2=T.RequestType1=T.RequestType0=T.RequestType=T.RAL=void 0;T.CancellationStrategy=void 0;var Q=wi();Object.defineProperty(T,"RequestType",{enumerable:!0,get:function(){return Q.RequestType}});Object.defineProperty(T,"RequestType0",{enumerable:!0,get:function(){return Q.RequestType0}});Object.defineProperty(T,"RequestType1",{enumerable:!0,get:function(){return Q.RequestType1}});Object.defineProperty(T,"RequestType2",{enumerable:!0,get:function(){return Q.RequestType2}});Object.defineProperty(T,"RequestType3",{enumerable:!0,get:function(){return Q.RequestType3}});Object.defineProperty(T,"RequestType4",{enumerable:!0,get:function(){return Q.RequestType4}});Object.defineProperty(T,"RequestType5",{enumerable:!0,get:function(){return Q.RequestType5}});Object.defineProperty(T,"RequestType6",{enumerable:!0,get:function(){return Q.RequestType6}});Object.defineProperty(T,"RequestType7",{enumerable:!0,get:function(){return Q.RequestType7}});Object.defineProperty(T,"RequestType8",{enumerable:!0,get:function(){return Q.RequestType8}});Object.defineProperty(T,"RequestType9",{enumerable:!0,get:function(){return Q.RequestType9}});Object.defineProperty(T,"ResponseError",{enumerable:!0,get:function(){return Q.ResponseError}});Object.defineProperty(T,"ErrorCodes",{enumerable:!0,get:function(){return Q.ErrorCodes}});Object.defineProperty(T,"NotificationType",{enumerable:!0,get:function(){return Q.NotificationType}});Object.defineProperty(T,"NotificationType0",{enumerable:!0,get:function(){return Q.NotificationType0}});Object.defineProperty(T,"NotificationType1",{enumerable:!0,get:function(){return Q.NotificationType1}});Object.defineProperty(T,"NotificationType2",{enumerable:!0,get:function(){return Q.NotificationType2}});Object.defineProperty(T,"NotificationType3",{enumerable:!0,get:function(){return Q.NotificationType3}});Object.defineProperty(T,"NotificationType4",{enumerable:!0,get:function(){return Q.NotificationType4}});Object.defineProperty(T,"NotificationType5",{enumerable:!0,get:function(){return Q.NotificationType5}});Object.defineProperty(T,"NotificationType6",{enumerable:!0,get:function(){return Q.NotificationType6}});Object.defineProperty(T,"NotificationType7",{enumerable:!0,get:function(){return Q.NotificationType7}});Object.defineProperty(T,"NotificationType8",{enumerable:!0,get:function(){return Q.NotificationType8}});Object.defineProperty(T,"NotificationType9",{enumerable:!0,get:function(){return Q.NotificationType9}});Object.defineProperty(T,"ParameterStructures",{enumerable:!0,get:function(){return Q.ParameterStructures}});var il=ki();Object.defineProperty(T,"Disposable",{enumerable:!0,get:function(){return il.Disposable}});var zs=Tt();Object.defineProperty(T,"Event",{enumerable:!0,get:function(){return zs.Event}});Object.defineProperty(T,"Emitter",{enumerable:!0,get:function(){return zs.Emitter}});var Ks=Di();Object.defineProperty(T,"CancellationTokenSource",{enumerable:!0,get:function(){return Ks.CancellationTokenSource}});Object.defineProperty(T,"CancellationToken",{enumerable:!0,get:function(){return Ks.CancellationToken}});var Ui=Ns();Object.defineProperty(T,"MessageReader",{enumerable:!0,get:function(){return Ui.MessageReader}});Object.defineProperty(T,"AbstractMessageReader",{enumerable:!0,get:function(){return Ui.AbstractMessageReader}});Object.defineProperty(T,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return Ui.ReadableStreamMessageReader}});var Gi=Ms();Object.defineProperty(T,"MessageWriter",{enumerable:!0,get:function(){return Gi.MessageWriter}});Object.defineProperty(T,"AbstractMessageWriter",{enumerable:!0,get:function(){return Gi.AbstractMessageWriter}});Object.defineProperty(T,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return Gi.WriteableStreamMessageWriter}});var ge=Vs();Object.defineProperty(T,"ConnectionStrategy",{enumerable:!0,get:function(){return ge.ConnectionStrategy}});Object.defineProperty(T,"ConnectionOptions",{enumerable:!0,get:function(){return ge.ConnectionOptions}});Object.defineProperty(T,"NullLogger",{enumerable:!0,get:function(){return ge.NullLogger}});Object.defineProperty(T,"createMessageConnection",{enumerable:!0,get:function(){return ge.createMessageConnection}});Object.defineProperty(T,"ProgressType",{enumerable:!0,get:function(){return ge.ProgressType}});Object.defineProperty(T,"Trace",{enumerable:!0,get:function(){return ge.Trace}});Object.defineProperty(T,"TraceFormat",{enumerable:!0,get:function(){return ge.TraceFormat}});Object.defineProperty(T,"SetTraceNotification",{enumerable:!0,get:function(){return ge.SetTraceNotification}});Object.defineProperty(T,"LogTraceNotification",{enumerable:!0,get:function(){return ge.LogTraceNotification}});Object.defineProperty(T,"ConnectionErrors",{enumerable:!0,get:function(){return ge.ConnectionErrors}});Object.defineProperty(T,"ConnectionError",{enumerable:!0,get:function(){return ge.ConnectionError}});Object.defineProperty(T,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return ge.CancellationReceiverStrategy}});Object.defineProperty(T,"CancellationSenderStrategy",{enumerable:!0,get:function(){return ge.CancellationSenderStrategy}});Object.defineProperty(T,"CancellationStrategy",{enumerable:!0,get:function(){return ge.CancellationStrategy}});var rl=Me();T.RAL=rl.default});var _t=L(K=>{"use strict";var sl=K&&K.__createBinding||(Object.create?function(n,e,t,i){i===void 0&&(i=t),Object.defineProperty(n,i,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,i){i===void 0&&(i=t),n[i]=e[t]}),ol=K&&K.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&sl(e,n,t)};Object.defineProperty(K,"__esModule",{value:!0});K.createMessageConnection=K.createServerSocketTransport=K.createClientSocketTransport=K.createServerPipeTransport=K.createClientPipeTransport=K.generateRandomPipeName=K.StreamMessageWriter=K.StreamMessageReader=K.SocketMessageWriter=K.SocketMessageReader=K.IPCMessageWriter=K.IPCMessageReader=void 0;var wt=ts();wt.default.install();var Ie=$i(),Js=require("path"),al=require("os"),cl=require("crypto"),wn=require("net");ol($i(),K);var Xs=class extends Ie.AbstractMessageReader{constructor(e){super();this.process=e;let t=this.process;t.on("error",i=>this.fireError(i)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),Ie.Disposable.create(()=>this.process.off("message",e))}};K.IPCMessageReader=Xs;var Ys=class extends Ie.AbstractMessageWriter{constructor(e){super();this.process=e,this.errorCount=0;let t=this.process;t.on("error",i=>this.fireError(i)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};K.IPCMessageWriter=Ys;var Ct=class extends Ie.ReadableStreamMessageReader{constructor(e,t="utf-8"){super(wt.default().stream.asReadableStream(e),t)}};K.SocketMessageReader=Ct;var Et=class extends Ie.WriteableStreamMessageWriter{constructor(e,t){super(wt.default().stream.asWritableStream(e),t);this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};K.SocketMessageWriter=Et;var Hi=class extends Ie.ReadableStreamMessageReader{constructor(e,t){super(wt.default().stream.asReadableStream(e),t)}};K.StreamMessageReader=Hi;var Vi=class extends Ie.WriteableStreamMessageWriter{constructor(e,t){super(wt.default().stream.asWritableStream(e),t)}};K.StreamMessageWriter=Vi;var Qs=process.env.XDG_RUNTIME_DIR,ll=new Map([["linux",107],["darwin",103]]);function ul(){let n=cl.randomBytes(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${n}-sock`;let e;Qs?e=Js.join(Qs,`vscode-ipc-${n}.sock`):e=Js.join(al.tmpdir(),`vscode-${n}.sock`);let t=ll.get(process.platform);return t!==void 0&&e.length>=t&&wt.default().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}K.generateRandomPipeName=ul;function dl(n,e="utf-8"){let t,i=new Promise((r,s)=>{t=r});return new Promise((r,s)=>{let c=wn.createServer(y=>{c.close(),t([new Ct(y,e),new Et(y,e)])});c.on("error",s),c.listen(n,()=>{c.removeListener("error",s),r({onConnected:()=>i})})})}K.createClientPipeTransport=dl;function hl(n,e="utf-8"){let t=wn.createConnection(n);return[new Ct(t,e),new Et(t,e)]}K.createServerPipeTransport=hl;function fl(n,e="utf-8"){let t,i=new Promise((r,s)=>{t=r});return new Promise((r,s)=>{let c=wn.createServer(y=>{c.close(),t([new Ct(y,e),new Et(y,e)])});c.on("error",s),c.listen(n,"127.0.0.1",()=>{c.removeListener("error",s),r({onConnected:()=>i})})})}K.createClientSocketTransport=fl;function pl(n,e="utf-8"){let t=wn.createConnection(n,"127.0.0.1");return[new Ct(t,e),new Et(t,e)]}K.createServerSocketTransport=pl;function ml(n){let e=n;return e.read!==void 0&&e.addListener!==void 0}function gl(n){let e=n;return e.write!==void 0&&e.addListener!==void 0}function bl(n,e,t,i){t||(t=Ie.NullLogger);let r=ml(n)?new Hi(n):n,s=gl(e)?new Vi(e):e;return Ie.ConnectionStrategy.is(i)&&(i={connectionStrategy:i}),Ie.createMessageConnection(r,s,t,i)}K.createMessageConnection=bl});var zi=L((_f,Zs)=>{"use strict";Zs.exports=_t()});var to=L((eo,Cn)=>{(function(n){if(typeof Cn=="object"&&typeof Cn.exports=="object"){var e=n(require,eo);e!==void 0&&(Cn.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],n)})(function(n,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=e.EOL=e.SelectionRange=e.DocumentLink=e.FormattingOptions=e.CodeLens=e.CodeAction=e.CodeActionContext=e.CodeActionKind=e.DocumentSymbol=e.SymbolInformation=e.SymbolTag=e.SymbolKind=e.DocumentHighlight=e.DocumentHighlightKind=e.SignatureInformation=e.ParameterInformation=e.Hover=e.MarkedString=e.CompletionList=e.CompletionItem=e.InsertTextMode=e.InsertReplaceEdit=e.CompletionItemTag=e.InsertTextFormat=e.CompletionItemKind=e.MarkupContent=e.MarkupKind=e.TextDocumentItem=e.OptionalVersionedTextDocumentIdentifier=e.VersionedTextDocumentIdentifier=e.TextDocumentIdentifier=e.WorkspaceChange=e.WorkspaceEdit=e.DeleteFile=e.RenameFile=e.CreateFile=e.TextDocumentEdit=e.AnnotatedTextEdit=e.ChangeAnnotationIdentifier=e.ChangeAnnotation=e.TextEdit=e.Command=e.Diagnostic=e.CodeDescription=e.DiagnosticTag=e.DiagnosticSeverity=e.DiagnosticRelatedInformation=e.FoldingRange=e.FoldingRangeKind=e.ColorPresentation=e.ColorInformation=e.Color=e.LocationLink=e.Location=e.Range=e.Position=e.uinteger=e.integer=void 0;var t;(function(a){a.MIN_VALUE=-2147483648,a.MAX_VALUE=2147483647})(t=e.integer||(e.integer={}));var i;(function(a){a.MIN_VALUE=0,a.MAX_VALUE=2147483647})(i=e.uinteger||(e.uinteger={}));var r;(function(a){function h(l,o){return l===Number.MAX_VALUE&&(l=i.MAX_VALUE),o===Number.MAX_VALUE&&(o=i.MAX_VALUE),{line:l,character:o}}a.create=h;function p(l){var o=l;return d.objectLiteral(o)&&d.uinteger(o.line)&&d.uinteger(o.character)}a.is=p})(r=e.Position||(e.Position={}));var s;(function(a){function h(l,o,m,S){if(d.uinteger(l)&&d.uinteger(o)&&d.uinteger(m)&&d.uinteger(S))return{start:r.create(l,o),end:r.create(m,S)};if(r.is(l)&&r.is(o))return{start:l,end:o};throw new Error("Range#create called with invalid arguments["+l+", "+o+", "+m+", "+S+"]")}a.create=h;function p(l){var o=l;return d.objectLiteral(o)&&r.is(o.start)&&r.is(o.end)}a.is=p})(s=e.Range||(e.Range={}));var c;(function(a){function h(l,o){return{uri:l,range:o}}a.create=h;function p(l){var o=l;return d.defined(o)&&s.is(o.range)&&(d.string(o.uri)||d.undefined(o.uri))}a.is=p})(c=e.Location||(e.Location={}));var y;(function(a){function h(l,o,m,S){return{targetUri:l,targetRange:o,targetSelectionRange:m,originSelectionRange:S}}a.create=h;function p(l){var o=l;return d.defined(o)&&s.is(o.targetRange)&&d.string(o.targetUri)&&(s.is(o.targetSelectionRange)||d.undefined(o.targetSelectionRange))&&(s.is(o.originSelectionRange)||d.undefined(o.originSelectionRange))}a.is=p})(y=e.LocationLink||(e.LocationLink={}));var b;(function(a){function h(l,o,m,S){return{red:l,green:o,blue:m,alpha:S}}a.create=h;function p(l){var o=l;return d.numberRange(o.red,0,1)&&d.numberRange(o.green,0,1)&&d.numberRange(o.blue,0,1)&&d.numberRange(o.alpha,0,1)}a.is=p})(b=e.Color||(e.Color={}));var x;(function(a){function h(l,o){return{range:l,color:o}}a.create=h;function p(l){var o=l;return s.is(o.range)&&b.is(o.color)}a.is=p})(x=e.ColorInformation||(e.ColorInformation={}));var k;(function(a){function h(l,o,m){return{label:l,textEdit:o,additionalTextEdits:m}}a.create=h;function p(l){var o=l;return d.string(o.label)&&(d.undefined(o.textEdit)||R.is(o))&&(d.undefined(o.additionalTextEdits)||d.typedArray(o.additionalTextEdits,R.is))}a.is=p})(k=e.ColorPresentation||(e.ColorPresentation={}));var E;(function(a){a.Comment="comment",a.Imports="imports",a.Region="region"})(E=e.FoldingRangeKind||(e.FoldingRangeKind={}));var C;(function(a){function h(l,o,m,S,_){var F={startLine:l,endLine:o};return d.defined(m)&&(F.startCharacter=m),d.defined(S)&&(F.endCharacter=S),d.defined(_)&&(F.kind=_),F}a.create=h;function p(l){var o=l;return d.uinteger(o.startLine)&&d.uinteger(o.startLine)&&(d.undefined(o.startCharacter)||d.uinteger(o.startCharacter))&&(d.undefined(o.endCharacter)||d.uinteger(o.endCharacter))&&(d.undefined(o.kind)||d.string(o.kind))}a.is=p})(C=e.FoldingRange||(e.FoldingRange={}));var D;(function(a){function h(l,o){return{location:l,message:o}}a.create=h;function p(l){var o=l;return d.defined(o)&&c.is(o.location)&&d.string(o.message)}a.is=p})(D=e.DiagnosticRelatedInformation||(e.DiagnosticRelatedInformation={}));var N;(function(a){a.Error=1,a.Warning=2,a.Information=3,a.Hint=4})(N=e.DiagnosticSeverity||(e.DiagnosticSeverity={}));var $;(function(a){a.Unnecessary=1,a.Deprecated=2})($=e.DiagnosticTag||(e.DiagnosticTag={}));var B;(function(a){function h(p){var l=p;return l!=null&&d.string(l.href)}a.is=h})(B=e.CodeDescription||(e.CodeDescription={}));var v;(function(a){function h(l,o,m,S,_,F){var W={range:l,message:o};return d.defined(m)&&(W.severity=m),d.defined(S)&&(W.code=S),d.defined(_)&&(W.source=_),d.defined(F)&&(W.relatedInformation=F),W}a.create=h;function p(l){var o,m=l;return d.defined(m)&&s.is(m.range)&&d.string(m.message)&&(d.number(m.severity)||d.undefined(m.severity))&&(d.integer(m.code)||d.string(m.code)||d.undefined(m.code))&&(d.undefined(m.codeDescription)||d.string((o=m.codeDescription)===null||o===void 0?void 0:o.href))&&(d.string(m.source)||d.undefined(m.source))&&(d.undefined(m.relatedInformation)||d.typedArray(m.relatedInformation,D.is))}a.is=p})(v=e.Diagnostic||(e.Diagnostic={}));var g;(function(a){function h(l,o){for(var m=[],S=2;S<arguments.length;S++)m[S-2]=arguments[S];var _={title:l,command:o};return d.defined(m)&&m.length>0&&(_.arguments=m),_}a.create=h;function p(l){var o=l;return d.defined(o)&&d.string(o.title)&&d.string(o.command)}a.is=p})(g=e.Command||(e.Command={}));var R;(function(a){function h(m,S){return{range:m,newText:S}}a.replace=h;function p(m,S){return{range:{start:m,end:m},newText:S}}a.insert=p;function l(m){return{range:m,newText:""}}a.del=l;function o(m){var S=m;return d.objectLiteral(S)&&d.string(S.newText)&&s.is(S.range)}a.is=o})(R=e.TextEdit||(e.TextEdit={}));var I;(function(a){function h(l,o,m){var S={label:l};return o!==void 0&&(S.needsConfirmation=o),m!==void 0&&(S.description=m),S}a.create=h;function p(l){var o=l;return o!==void 0&&d.objectLiteral(o)&&d.string(o.label)&&(d.boolean(o.needsConfirmation)||o.needsConfirmation===void 0)&&(d.string(o.description)||o.description===void 0)}a.is=p})(I=e.ChangeAnnotation||(e.ChangeAnnotation={}));var U;(function(a){function h(p){var l=p;return typeof l=="string"}a.is=h})(U=e.ChangeAnnotationIdentifier||(e.ChangeAnnotationIdentifier={}));var be;(function(a){function h(m,S,_){return{range:m,newText:S,annotationId:_}}a.replace=h;function p(m,S,_){return{range:{start:m,end:m},newText:S,annotationId:_}}a.insert=p;function l(m,S){return{range:m,newText:"",annotationId:S}}a.del=l;function o(m){var S=m;return R.is(S)&&(I.is(S.annotationId)||U.is(S.annotationId))}a.is=o})(be=e.AnnotatedTextEdit||(e.AnnotatedTextEdit={}));var yt;(function(a){function h(l,o){return{textDocument:l,edits:o}}a.create=h;function p(l){var o=l;return d.defined(o)&&vt.is(o.textDocument)&&Array.isArray(o.edits)}a.is=p})(yt=e.TextDocumentEdit||(e.TextDocumentEdit={}));var tt;(function(a){function h(l,o,m){var S={kind:"create",uri:l};return o!==void 0&&(o.overwrite!==void 0||o.ignoreIfExists!==void 0)&&(S.options=o),m!==void 0&&(S.annotationId=m),S}a.create=h;function p(l){var o=l;return o&&o.kind==="create"&&d.string(o.uri)&&(o.options===void 0||(o.options.overwrite===void 0||d.boolean(o.options.overwrite))&&(o.options.ignoreIfExists===void 0||d.boolean(o.options.ignoreIfExists)))&&(o.annotationId===void 0||U.is(o.annotationId))}a.is=p})(tt=e.CreateFile||(e.CreateFile={}));var nt;(function(a){function h(l,o,m,S){var _={kind:"rename",oldUri:l,newUri:o};return m!==void 0&&(m.overwrite!==void 0||m.ignoreIfExists!==void 0)&&(_.options=m),S!==void 0&&(_.annotationId=S),_}a.create=h;function p(l){var o=l;return o&&o.kind==="rename"&&d.string(o.oldUri)&&d.string(o.newUri)&&(o.options===void 0||(o.options.overwrite===void 0||d.boolean(o.options.overwrite))&&(o.options.ignoreIfExists===void 0||d.boolean(o.options.ignoreIfExists)))&&(o.annotationId===void 0||U.is(o.annotationId))}a.is=p})(nt=e.RenameFile||(e.RenameFile={}));var it;(function(a){function h(l,o,m){var S={kind:"delete",uri:l};return o!==void 0&&(o.recursive!==void 0||o.ignoreIfNotExists!==void 0)&&(S.options=o),m!==void 0&&(S.annotationId=m),S}a.create=h;function p(l){var o=l;return o&&o.kind==="delete"&&d.string(o.uri)&&(o.options===void 0||(o.options.recursive===void 0||d.boolean(o.options.recursive))&&(o.options.ignoreIfNotExists===void 0||d.boolean(o.options.ignoreIfNotExists)))&&(o.annotationId===void 0||U.is(o.annotationId))}a.is=p})(it=e.DeleteFile||(e.DeleteFile={}));var rt;(function(a){function h(p){var l=p;return l&&(l.changes!==void 0||l.documentChanges!==void 0)&&(l.documentChanges===void 0||l.documentChanges.every(function(o){return d.string(o.kind)?tt.is(o)||nt.is(o)||it.is(o):yt.is(o)}))}a.is=h})(rt=e.WorkspaceEdit||(e.WorkspaceEdit={}));var st=function(){function a(h,p){this.edits=h,this.changeAnnotations=p}return a.prototype.insert=function(h,p,l){var o,m;if(l===void 0?o=R.insert(h,p):U.is(l)?(m=l,o=be.insert(h,p,l)):(this.assertChangeAnnotations(this.changeAnnotations),m=this.changeAnnotations.manage(l),o=be.insert(h,p,m)),this.edits.push(o),m!==void 0)return m},a.prototype.replace=function(h,p,l){var o,m;if(l===void 0?o=R.replace(h,p):U.is(l)?(m=l,o=be.replace(h,p,l)):(this.assertChangeAnnotations(this.changeAnnotations),m=this.changeAnnotations.manage(l),o=be.replace(h,p,m)),this.edits.push(o),m!==void 0)return m},a.prototype.delete=function(h,p){var l,o;if(p===void 0?l=R.del(h):U.is(p)?(o=p,l=be.del(h,p)):(this.assertChangeAnnotations(this.changeAnnotations),o=this.changeAnnotations.manage(p),l=be.del(h,o)),this.edits.push(l),o!==void 0)return o},a.prototype.add=function(h){this.edits.push(h)},a.prototype.all=function(){return this.edits},a.prototype.clear=function(){this.edits.splice(0,this.edits.length)},a.prototype.assertChangeAnnotations=function(h){if(h===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},a}(),dn=function(){function a(h){this._annotations=h===void 0?Object.create(null):h,this._counter=0,this._size=0}return a.prototype.all=function(){return this._annotations},Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),a.prototype.manage=function(h,p){var l;if(U.is(h)?l=h:(l=this.nextId(),p=h),this._annotations[l]!==void 0)throw new Error("Id "+l+" is already in use.");if(p===void 0)throw new Error("No annotation provided for id "+l);return this._annotations[l]=p,this._size++,l},a.prototype.nextId=function(){return this._counter++,this._counter.toString()},a}(),ti=function(){function a(h){var p=this;this._textEditChanges=Object.create(null),h!==void 0?(this._workspaceEdit=h,h.documentChanges?(this._changeAnnotations=new dn(h.changeAnnotations),h.changeAnnotations=this._changeAnnotations.all(),h.documentChanges.forEach(function(l){if(yt.is(l)){var o=new st(l.edits,p._changeAnnotations);p._textEditChanges[l.textDocument.uri]=o}})):h.changes&&Object.keys(h.changes).forEach(function(l){var o=new st(h.changes[l]);p._textEditChanges[l]=o})):this._workspaceEdit={}}return Object.defineProperty(a.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),a.prototype.getTextEditChange=function(h){if(vt.is(h)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var p={uri:h.uri,version:h.version},l=this._textEditChanges[p.uri];if(!l){var o=[],m={textDocument:p,edits:o};this._workspaceEdit.documentChanges.push(m),l=new st(o,this._changeAnnotations),this._textEditChanges[p.uri]=l}return l}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var l=this._textEditChanges[h];if(!l){var o=[];this._workspaceEdit.changes[h]=o,l=new st(o),this._textEditChanges[h]=l}return l}},a.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new dn,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},a.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},a.prototype.createFile=function(h,p,l){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var o;I.is(p)||U.is(p)?o=p:l=p;var m,S;if(o===void 0?m=tt.create(h,l):(S=U.is(o)?o:this._changeAnnotations.manage(o),m=tt.create(h,l,S)),this._workspaceEdit.documentChanges.push(m),S!==void 0)return S},a.prototype.renameFile=function(h,p,l,o){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var m;I.is(l)||U.is(l)?m=l:o=l;var S,_;if(m===void 0?S=nt.create(h,p,o):(_=U.is(m)?m:this._changeAnnotations.manage(m),S=nt.create(h,p,o,_)),this._workspaceEdit.documentChanges.push(S),_!==void 0)return _},a.prototype.deleteFile=function(h,p,l){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var o;I.is(p)||U.is(p)?o=p:l=p;var m,S;if(o===void 0?m=it.create(h,l):(S=U.is(o)?o:this._changeAnnotations.manage(o),m=it.create(h,l,S)),this._workspaceEdit.documentChanges.push(m),S!==void 0)return S},a}();e.WorkspaceChange=ti;var ni;(function(a){function h(l){return{uri:l}}a.create=h;function p(l){var o=l;return d.defined(o)&&d.string(o.uri)}a.is=p})(ni=e.TextDocumentIdentifier||(e.TextDocumentIdentifier={}));var ii;(function(a){function h(l,o){return{uri:l,version:o}}a.create=h;function p(l){var o=l;return d.defined(o)&&d.string(o.uri)&&d.integer(o.version)}a.is=p})(ii=e.VersionedTextDocumentIdentifier||(e.VersionedTextDocumentIdentifier={}));var vt;(function(a){function h(l,o){return{uri:l,version:o}}a.create=h;function p(l){var o=l;return d.defined(o)&&d.string(o.uri)&&(o.version===null||d.integer(o.version))}a.is=p})(vt=e.OptionalVersionedTextDocumentIdentifier||(e.OptionalVersionedTextDocumentIdentifier={}));var hn;(function(a){function h(l,o,m,S){return{uri:l,languageId:o,version:m,text:S}}a.create=h;function p(l){var o=l;return d.defined(o)&&d.string(o.uri)&&d.string(o.languageId)&&d.integer(o.version)&&d.string(o.text)}a.is=p})(hn=e.TextDocumentItem||(e.TextDocumentItem={}));var Fe;(function(a){a.PlainText="plaintext",a.Markdown="markdown"})(Fe=e.MarkupKind||(e.MarkupKind={})),function(a){function h(p){var l=p;return l===a.PlainText||l===a.Markdown}a.is=h}(Fe=e.MarkupKind||(e.MarkupKind={}));var At;(function(a){function h(p){var l=p;return d.objectLiteral(p)&&Fe.is(l.kind)&&d.string(l.value)}a.is=h})(At=e.MarkupContent||(e.MarkupContent={}));var ri;(function(a){a.Text=1,a.Method=2,a.Function=3,a.Constructor=4,a.Field=5,a.Variable=6,a.Class=7,a.Interface=8,a.Module=9,a.Property=10,a.Unit=11,a.Value=12,a.Enum=13,a.Keyword=14,a.Snippet=15,a.Color=16,a.File=17,a.Reference=18,a.Folder=19,a.EnumMember=20,a.Constant=21,a.Struct=22,a.Event=23,a.Operator=24,a.TypeParameter=25})(ri=e.CompletionItemKind||(e.CompletionItemKind={}));var si;(function(a){a.PlainText=1,a.Snippet=2})(si=e.InsertTextFormat||(e.InsertTextFormat={}));var fn;(function(a){a.Deprecated=1})(fn=e.CompletionItemTag||(e.CompletionItemTag={}));var oi;(function(a){function h(l,o,m){return{newText:l,insert:o,replace:m}}a.create=h;function p(l){var o=l;return o&&d.string(o.newText)&&s.is(o.insert)&&s.is(o.replace)}a.is=p})(oi=e.InsertReplaceEdit||(e.InsertReplaceEdit={}));var ai;(function(a){a.asIs=1,a.adjustIndentation=2})(ai=e.InsertTextMode||(e.InsertTextMode={}));var ci;(function(a){function h(p){return{label:p}}a.create=h})(ci=e.CompletionItem||(e.CompletionItem={}));var li;(function(a){function h(p,l){return{items:p||[],isIncomplete:!!l}}a.create=h})(li=e.CompletionList||(e.CompletionList={}));var Mt;(function(a){function h(l){return l.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}a.fromPlainText=h;function p(l){var o=l;return d.string(o)||d.objectLiteral(o)&&d.string(o.language)&&d.string(o.value)}a.is=p})(Mt=e.MarkedString||(e.MarkedString={}));var ui;(function(a){function h(p){var l=p;return!!l&&d.objectLiteral(l)&&(At.is(l.contents)||Mt.is(l.contents)||d.typedArray(l.contents,Mt.is))&&(p.range===void 0||s.is(p.range))}a.is=h})(ui=e.Hover||(e.Hover={}));var di;(function(a){function h(p,l){return l?{label:p,documentation:l}:{label:p}}a.create=h})(di=e.ParameterInformation||(e.ParameterInformation={}));var hi;(function(a){function h(p,l){for(var o=[],m=2;m<arguments.length;m++)o[m-2]=arguments[m];var S={label:p};return d.defined(l)&&(S.documentation=l),d.defined(o)?S.parameters=o:S.parameters=[],S}a.create=h})(hi=e.SignatureInformation||(e.SignatureInformation={}));var St;(function(a){a.Text=1,a.Read=2,a.Write=3})(St=e.DocumentHighlightKind||(e.DocumentHighlightKind={}));var fi;(function(a){function h(p,l){var o={range:p};return d.number(l)&&(o.kind=l),o}a.create=h})(fi=e.DocumentHighlight||(e.DocumentHighlight={}));var pi;(function(a){a.File=1,a.Module=2,a.Namespace=3,a.Package=4,a.Class=5,a.Method=6,a.Property=7,a.Field=8,a.Constructor=9,a.Enum=10,a.Interface=11,a.Function=12,a.Variable=13,a.Constant=14,a.String=15,a.Number=16,a.Boolean=17,a.Array=18,a.Object=19,a.Key=20,a.Null=21,a.EnumMember=22,a.Struct=23,a.Event=24,a.Operator=25,a.TypeParameter=26})(pi=e.SymbolKind||(e.SymbolKind={}));var mi;(function(a){a.Deprecated=1})(mi=e.SymbolTag||(e.SymbolTag={}));var Ve;(function(a){function h(p,l,o,m,S){var _={name:p,kind:l,location:{uri:m,range:o}};return S&&(_.containerName=S),_}a.create=h})(Ve=e.SymbolInformation||(e.SymbolInformation={}));var ot;(function(a){function h(l,o,m,S,_,F){var W={name:l,detail:o,kind:m,range:S,selectionRange:_};return F!==void 0&&(W.children=F),W}a.create=h;function p(l){var o=l;return o&&d.string(o.name)&&d.number(o.kind)&&s.is(o.range)&&s.is(o.selectionRange)&&(o.detail===void 0||d.string(o.detail))&&(o.deprecated===void 0||d.boolean(o.deprecated))&&(o.children===void 0||Array.isArray(o.children))&&(o.tags===void 0||Array.isArray(o.tags))}a.is=p})(ot=e.DocumentSymbol||(e.DocumentSymbol={}));var gi;(function(a){a.Empty="",a.QuickFix="quickfix",a.Refactor="refactor",a.RefactorExtract="refactor.extract",a.RefactorInline="refactor.inline",a.RefactorRewrite="refactor.rewrite",a.Source="source",a.SourceOrganizeImports="source.organizeImports",a.SourceFixAll="source.fixAll"})(gi=e.CodeActionKind||(e.CodeActionKind={}));var bi;(function(a){function h(l,o){var m={diagnostics:l};return o!=null&&(m.only=o),m}a.create=h;function p(l){var o=l;return d.defined(o)&&d.typedArray(o.diagnostics,v.is)&&(o.only===void 0||d.typedArray(o.only,d.string))}a.is=p})(bi=e.CodeActionContext||(e.CodeActionContext={}));var at;(function(a){function h(l,o,m){var S={title:l},_=!0;return typeof o=="string"?(_=!1,S.kind=o):g.is(o)?S.command=o:S.edit=o,_&&m!==void 0&&(S.kind=m),S}a.create=h;function p(l){var o=l;return o&&d.string(o.title)&&(o.diagnostics===void 0||d.typedArray(o.diagnostics,v.is))&&(o.kind===void 0||d.string(o.kind))&&(o.edit!==void 0||o.command!==void 0)&&(o.command===void 0||g.is(o.command))&&(o.isPreferred===void 0||d.boolean(o.isPreferred))&&(o.edit===void 0||rt.is(o.edit))}a.is=p})(at=e.CodeAction||(e.CodeAction={}));var pn;(function(a){function h(l,o){var m={range:l};return d.defined(o)&&(m.data=o),m}a.create=h;function p(l){var o=l;return d.defined(o)&&s.is(o.range)&&(d.undefined(o.command)||g.is(o.command))}a.is=p})(pn=e.CodeLens||(e.CodeLens={}));var mn;(function(a){function h(l,o){return{tabSize:l,insertSpaces:o}}a.create=h;function p(l){var o=l;return d.defined(o)&&d.uinteger(o.tabSize)&&d.boolean(o.insertSpaces)}a.is=p})(mn=e.FormattingOptions||(e.FormattingOptions={}));var jt;(function(a){function h(l,o,m){return{range:l,target:o,data:m}}a.create=h;function p(l){var o=l;return d.defined(o)&&s.is(o.range)&&(d.undefined(o.target)||d.string(o.target))}a.is=p})(jt=e.DocumentLink||(e.DocumentLink={}));var gn;(function(a){function h(l,o){return{range:l,parent:o}}a.create=h;function p(l){var o=l;return o!==void 0&&s.is(o.range)&&(o.parent===void 0||a.is(o.parent))}a.is=p})(gn=e.SelectionRange||(e.SelectionRange={})),e.EOL=[`
`,`\r
`,"\r"];var ze;(function(a){function h(m,S,_,F){return new f(m,S,_,F)}a.create=h;function p(m){var S=m;return!!(d.defined(S)&&d.string(S.uri)&&(d.undefined(S.languageId)||d.string(S.languageId))&&d.uinteger(S.lineCount)&&d.func(S.getText)&&d.func(S.positionAt)&&d.func(S.offsetAt))}a.is=p;function l(m,S){for(var _=m.getText(),F=o(S,function(xt,bn){var Hr=xt.range.start.line-bn.range.start.line;return Hr===0?xt.range.start.character-bn.range.start.character:Hr}),W=_.length,Y=F.length-1;Y>=0;Y--){var se=F[Y],oe=m.offsetAt(se.range.start),H=m.offsetAt(se.range.end);if(H<=W)_=_.substring(0,oe)+se.newText+_.substring(H,_.length);else throw new Error("Overlapping edit");W=oe}return _}a.applyEdits=l;function o(m,S){if(m.length<=1)return m;var _=m.length/2|0,F=m.slice(0,_),W=m.slice(_);o(F,S),o(W,S);for(var Y=0,se=0,oe=0;Y<F.length&&se<W.length;){var H=S(F[Y],W[se]);H<=0?m[oe++]=F[Y++]:m[oe++]=W[se++]}for(;Y<F.length;)m[oe++]=F[Y++];for(;se<W.length;)m[oe++]=W[se++];return m}})(ze=e.TextDocument||(e.TextDocument={}));var f=function(){function a(h,p,l,o){this._uri=h,this._languageId=p,this._version=l,this._content=o,this._lineOffsets=void 0}return Object.defineProperty(a.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),a.prototype.getText=function(h){if(h){var p=this.offsetAt(h.start),l=this.offsetAt(h.end);return this._content.substring(p,l)}return this._content},a.prototype.update=function(h,p){this._content=h.text,this._version=p,this._lineOffsets=void 0},a.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var h=[],p=this._content,l=!0,o=0;o<p.length;o++){l&&(h.push(o),l=!1);var m=p.charAt(o);l=m==="\r"||m===`
`,m==="\r"&&o+1<p.length&&p.charAt(o+1)===`
`&&o++}l&&p.length>0&&h.push(p.length),this._lineOffsets=h}return this._lineOffsets},a.prototype.positionAt=function(h){h=Math.max(Math.min(h,this._content.length),0);var p=this.getLineOffsets(),l=0,o=p.length;if(o===0)return r.create(0,h);for(;l<o;){var m=Math.floor((l+o)/2);p[m]>h?o=m:l=m+1}var S=l-1;return r.create(S,h-p[S])},a.prototype.offsetAt=function(h){var p=this.getLineOffsets();if(h.line>=p.length)return this._content.length;if(h.line<0)return 0;var l=p[h.line],o=h.line+1<p.length?p[h.line+1]:this._content.length;return Math.max(Math.min(l+h.character,o),l)},Object.defineProperty(a.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),a}(),d;(function(a){var h=Object.prototype.toString;function p(H){return typeof H!="undefined"}a.defined=p;function l(H){return typeof H=="undefined"}a.undefined=l;function o(H){return H===!0||H===!1}a.boolean=o;function m(H){return h.call(H)==="[object String]"}a.string=m;function S(H){return h.call(H)==="[object Number]"}a.number=S;function _(H,xt,bn){return h.call(H)==="[object Number]"&&xt<=H&&H<=bn}a.numberRange=_;function F(H){return h.call(H)==="[object Number]"&&-2147483648<=H&&H<=2147483647}a.integer=F;function W(H){return h.call(H)==="[object Number]"&&0<=H&&H<=2147483647}a.uinteger=W;function Y(H){return h.call(H)==="[object Function]"}a.func=Y;function se(H){return H!==null&&typeof H=="object"}a.objectLiteral=se;function oe(H,xt){return Array.isArray(H)&&H.every(xt)}a.typedArray=oe})(d||(d={}))})});var ce=L(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.ProtocolNotificationType=ke.ProtocolNotificationType0=ke.ProtocolRequestType=ke.ProtocolRequestType0=ke.RegistrationType=void 0;var Dt=_t(),no=class{constructor(e){this.method=e}};ke.RegistrationType=no;var io=class extends Dt.RequestType0{constructor(e){super(e)}};ke.ProtocolRequestType0=io;var ro=class extends Dt.RequestType{constructor(e){super(e,Dt.ParameterStructures.byName)}};ke.ProtocolRequestType=ro;var so=class extends Dt.NotificationType0{constructor(e){super(e)}};ke.ProtocolNotificationType0=so;var oo=class extends Dt.NotificationType{constructor(e){super(e,Dt.ParameterStructures.byName)}};ke.ProtocolNotificationType=oo});var lo=L(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});re.objectLiteral=re.typedArray=re.stringArray=re.array=re.func=re.error=re.number=re.string=re.boolean=void 0;function yl(n){return n===!0||n===!1}re.boolean=yl;function ao(n){return typeof n=="string"||n instanceof String}re.string=ao;function vl(n){return typeof n=="number"||n instanceof Number}re.number=vl;function Sl(n){return n instanceof Error}re.error=Sl;function xl(n){return typeof n=="function"}re.func=xl;function co(n){return Array.isArray(n)}re.array=co;function kl(n){return co(n)&&n.every(e=>ao(e))}re.stringArray=kl;function Tl(n,e){return Array.isArray(n)&&n.every(e)}re.typedArray=Tl;function Rl(n){return n!==null&&typeof n=="object"}re.objectLiteral=Rl});var uo=L(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.ImplementationRequest=void 0;var wl=ce(),Cl;(function(n){n.method="textDocument/implementation",n.type=new wl.ProtocolRequestType(n.method)})(Cl=Vt.ImplementationRequest||(Vt.ImplementationRequest={}))});var ho=L(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.TypeDefinitionRequest=void 0;var El=ce(),_l;(function(n){n.method="textDocument/typeDefinition",n.type=new El.ProtocolRequestType(n.method)})(_l=zt.TypeDefinitionRequest||(zt.TypeDefinitionRequest={}))});var po=L(Ke=>{"use strict";Object.defineProperty(Ke,"__esModule",{value:!0});Ke.DidChangeWorkspaceFoldersNotification=Ke.WorkspaceFoldersRequest=void 0;var fo=ce(),Dl;(function(n){n.type=new fo.ProtocolRequestType0("workspace/workspaceFolders")})(Dl=Ke.WorkspaceFoldersRequest||(Ke.WorkspaceFoldersRequest={}));var Pl;(function(n){n.type=new fo.ProtocolNotificationType("workspace/didChangeWorkspaceFolders")})(Pl=Ke.DidChangeWorkspaceFoldersNotification||(Ke.DidChangeWorkspaceFoldersNotification={}))});var mo=L(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.ConfigurationRequest=void 0;var Nl=ce(),Ll;(function(n){n.type=new Nl.ProtocolRequestType("workspace/configuration")})(Ll=Kt.ConfigurationRequest||(Kt.ConfigurationRequest={}))});var bo=L(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.ColorPresentationRequest=Je.DocumentColorRequest=void 0;var go=ce(),Fl;(function(n){n.method="textDocument/documentColor",n.type=new go.ProtocolRequestType(n.method)})(Fl=Je.DocumentColorRequest||(Je.DocumentColorRequest={}));var Il;(function(n){n.type=new go.ProtocolRequestType("textDocument/colorPresentation")})(Il=Je.ColorPresentationRequest||(Je.ColorPresentationRequest={}))});var yo=L(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.FoldingRangeRequest=Xe.FoldingRangeKind=void 0;var ql=ce(),Ol;(function(n){n.Comment="comment",n.Imports="imports",n.Region="region"})(Ol=Xe.FoldingRangeKind||(Xe.FoldingRangeKind={}));var Al;(function(n){n.method="textDocument/foldingRange",n.type=new ql.ProtocolRequestType(n.method)})(Al=Xe.FoldingRangeRequest||(Xe.FoldingRangeRequest={}))});var vo=L(Jt=>{"use strict";Object.defineProperty(Jt,"__esModule",{value:!0});Jt.DeclarationRequest=void 0;var Ml=ce(),jl;(function(n){n.method="textDocument/declaration",n.type=new Ml.ProtocolRequestType(n.method)})(jl=Jt.DeclarationRequest||(Jt.DeclarationRequest={}))});var So=L(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.SelectionRangeRequest=void 0;var Wl=ce(),Bl;(function(n){n.method="textDocument/selectionRange",n.type=new Wl.ProtocolRequestType(n.method)})(Bl=Xt.SelectionRangeRequest||(Xt.SelectionRangeRequest={}))});var ko=L(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.WorkDoneProgressCancelNotification=De.WorkDoneProgressCreateRequest=De.WorkDoneProgress=void 0;var Ul=_t(),xo=ce(),Gl;(function(n){n.type=new Ul.ProgressType;function e(t){return t===n.type}n.is=e})(Gl=De.WorkDoneProgress||(De.WorkDoneProgress={}));var $l;(function(n){n.type=new xo.ProtocolRequestType("window/workDoneProgress/create")})($l=De.WorkDoneProgressCreateRequest||(De.WorkDoneProgressCreateRequest={}));var Hl;(function(n){n.type=new xo.ProtocolNotificationType("window/workDoneProgress/cancel")})(Hl=De.WorkDoneProgressCancelNotification||(De.WorkDoneProgressCancelNotification={}))});var To=L(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.CallHierarchyOutgoingCallsRequest=Pe.CallHierarchyIncomingCallsRequest=Pe.CallHierarchyPrepareRequest=void 0;var Ki=ce(),Vl;(function(n){n.method="textDocument/prepareCallHierarchy",n.type=new Ki.ProtocolRequestType(n.method)})(Vl=Pe.CallHierarchyPrepareRequest||(Pe.CallHierarchyPrepareRequest={}));var zl;(function(n){n.method="callHierarchy/incomingCalls",n.type=new Ki.ProtocolRequestType(n.method)})(zl=Pe.CallHierarchyIncomingCallsRequest||(Pe.CallHierarchyIncomingCallsRequest={}));var Kl;(function(n){n.method="callHierarchy/outgoingCalls",n.type=new Ki.ProtocolRequestType(n.method)})(Kl=Pe.CallHierarchyOutgoingCallsRequest||(Pe.CallHierarchyOutgoingCallsRequest={}))});var Ro=L(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.SemanticTokensRefreshRequest=X.SemanticTokensRangeRequest=X.SemanticTokensDeltaRequest=X.SemanticTokensRequest=X.SemanticTokensRegistrationType=X.TokenFormat=X.SemanticTokens=X.SemanticTokenModifiers=X.SemanticTokenTypes=void 0;var Yt=ce(),Jl;(function(n){n.namespace="namespace",n.type="type",n.class="class",n.enum="enum",n.interface="interface",n.struct="struct",n.typeParameter="typeParameter",n.parameter="parameter",n.variable="variable",n.property="property",n.enumMember="enumMember",n.event="event",n.function="function",n.method="method",n.macro="macro",n.keyword="keyword",n.modifier="modifier",n.comment="comment",n.string="string",n.number="number",n.regexp="regexp",n.operator="operator"})(Jl=X.SemanticTokenTypes||(X.SemanticTokenTypes={}));var Xl;(function(n){n.declaration="declaration",n.definition="definition",n.readonly="readonly",n.static="static",n.deprecated="deprecated",n.abstract="abstract",n.async="async",n.modification="modification",n.documentation="documentation",n.defaultLibrary="defaultLibrary"})(Xl=X.SemanticTokenModifiers||(X.SemanticTokenModifiers={}));var Yl;(function(n){function e(t){let i=t;return i!==void 0&&(i.resultId===void 0||typeof i.resultId=="string")&&Array.isArray(i.data)&&(i.data.length===0||typeof i.data[0]=="number")}n.is=e})(Yl=X.SemanticTokens||(X.SemanticTokens={}));var Ql;(function(n){n.Relative="relative"})(Ql=X.TokenFormat||(X.TokenFormat={}));var Zl;(function(n){n.method="textDocument/semanticTokens",n.type=new Yt.RegistrationType(n.method)})(Zl=X.SemanticTokensRegistrationType||(X.SemanticTokensRegistrationType={}));var eu;(function(n){n.method="textDocument/semanticTokens/full",n.type=new Yt.ProtocolRequestType(n.method)})(eu=X.SemanticTokensRequest||(X.SemanticTokensRequest={}));var tu;(function(n){n.method="textDocument/semanticTokens/full/delta",n.type=new Yt.ProtocolRequestType(n.method)})(tu=X.SemanticTokensDeltaRequest||(X.SemanticTokensDeltaRequest={}));var nu;(function(n){n.method="textDocument/semanticTokens/range",n.type=new Yt.ProtocolRequestType(n.method)})(nu=X.SemanticTokensRangeRequest||(X.SemanticTokensRangeRequest={}));var iu;(function(n){n.method="workspace/semanticTokens/refresh",n.type=new Yt.ProtocolRequestType0(n.method)})(iu=X.SemanticTokensRefreshRequest||(X.SemanticTokensRefreshRequest={}))});var wo=L(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.ShowDocumentRequest=void 0;var ru=ce(),su;(function(n){n.method="window/showDocument",n.type=new ru.ProtocolRequestType(n.method)})(su=Qt.ShowDocumentRequest||(Qt.ShowDocumentRequest={}))});var Co=L(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.LinkedEditingRangeRequest=void 0;var ou=ce(),au;(function(n){n.method="textDocument/linkedEditingRange",n.type=new ou.ProtocolRequestType(n.method)})(au=Zt.LinkedEditingRangeRequest||(Zt.LinkedEditingRangeRequest={}))});var Eo=L(ee=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0});ee.WillDeleteFilesRequest=ee.DidDeleteFilesNotification=ee.DidRenameFilesNotification=ee.WillRenameFilesRequest=ee.DidCreateFilesNotification=ee.WillCreateFilesRequest=ee.FileOperationPatternKind=void 0;var Pt=ce(),cu;(function(n){n.file="file",n.folder="folder"})(cu=ee.FileOperationPatternKind||(ee.FileOperationPatternKind={}));var lu;(function(n){n.method="workspace/willCreateFiles",n.type=new Pt.ProtocolRequestType(n.method)})(lu=ee.WillCreateFilesRequest||(ee.WillCreateFilesRequest={}));var uu;(function(n){n.method="workspace/didCreateFiles",n.type=new Pt.ProtocolNotificationType(n.method)})(uu=ee.DidCreateFilesNotification||(ee.DidCreateFilesNotification={}));var du;(function(n){n.method="workspace/willRenameFiles",n.type=new Pt.ProtocolRequestType(n.method)})(du=ee.WillRenameFilesRequest||(ee.WillRenameFilesRequest={}));var hu;(function(n){n.method="workspace/didRenameFiles",n.type=new Pt.ProtocolNotificationType(n.method)})(hu=ee.DidRenameFilesNotification||(ee.DidRenameFilesNotification={}));var fu;(function(n){n.method="workspace/didDeleteFiles",n.type=new Pt.ProtocolNotificationType(n.method)})(fu=ee.DidDeleteFilesNotification||(ee.DidDeleteFilesNotification={}));var pu;(function(n){n.method="workspace/willDeleteFiles",n.type=new Pt.ProtocolRequestType(n.method)})(pu=ee.WillDeleteFilesRequest||(ee.WillDeleteFilesRequest={}))});var _o=L(Ne=>{"use strict";Object.defineProperty(Ne,"__esModule",{value:!0});Ne.MonikerRequest=Ne.MonikerKind=Ne.UniquenessLevel=void 0;var mu=ce(),gu;(function(n){n.document="document",n.project="project",n.group="group",n.scheme="scheme",n.global="global"})(gu=Ne.UniquenessLevel||(Ne.UniquenessLevel={}));var bu;(function(n){n.import="import",n.export="export",n.local="local"})(bu=Ne.MonikerKind||(Ne.MonikerKind={}));var yu;(function(n){n.method="textDocument/moniker",n.type=new mu.ProtocolRequestType(n.method)})(yu=Ne.MonikerRequest||(Ne.MonikerRequest={}))});var Fo=L(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.DocumentLinkRequest=u.CodeLensRefreshRequest=u.CodeLensResolveRequest=u.CodeLensRequest=u.WorkspaceSymbolRequest=u.CodeActionResolveRequest=u.CodeActionRequest=u.DocumentSymbolRequest=u.DocumentHighlightRequest=u.ReferencesRequest=u.DefinitionRequest=u.SignatureHelpRequest=u.SignatureHelpTriggerKind=u.HoverRequest=u.CompletionResolveRequest=u.CompletionRequest=u.CompletionTriggerKind=u.PublishDiagnosticsNotification=u.WatchKind=u.FileChangeType=u.DidChangeWatchedFilesNotification=u.WillSaveTextDocumentWaitUntilRequest=u.WillSaveTextDocumentNotification=u.TextDocumentSaveReason=u.DidSaveTextDocumentNotification=u.DidCloseTextDocumentNotification=u.DidChangeTextDocumentNotification=u.TextDocumentContentChangeEvent=u.DidOpenTextDocumentNotification=u.TextDocumentSyncKind=u.TelemetryEventNotification=u.LogMessageNotification=u.ShowMessageRequest=u.ShowMessageNotification=u.MessageType=u.DidChangeConfigurationNotification=u.ExitNotification=u.ShutdownRequest=u.InitializedNotification=u.InitializeError=u.InitializeRequest=u.WorkDoneProgressOptions=u.TextDocumentRegistrationOptions=u.StaticRegistrationOptions=u.FailureHandlingKind=u.ResourceOperationKind=u.UnregistrationRequest=u.RegistrationRequest=u.DocumentSelector=u.DocumentFilter=void 0;u.MonikerRequest=u.MonikerKind=u.UniquenessLevel=u.WillDeleteFilesRequest=u.DidDeleteFilesNotification=u.WillRenameFilesRequest=u.DidRenameFilesNotification=u.WillCreateFilesRequest=u.DidCreateFilesNotification=u.FileOperationPatternKind=u.LinkedEditingRangeRequest=u.ShowDocumentRequest=u.SemanticTokensRegistrationType=u.SemanticTokensRefreshRequest=u.SemanticTokensRangeRequest=u.SemanticTokensDeltaRequest=u.SemanticTokensRequest=u.TokenFormat=u.SemanticTokens=u.SemanticTokenModifiers=u.SemanticTokenTypes=u.CallHierarchyPrepareRequest=u.CallHierarchyOutgoingCallsRequest=u.CallHierarchyIncomingCallsRequest=u.WorkDoneProgressCancelNotification=u.WorkDoneProgressCreateRequest=u.WorkDoneProgress=u.SelectionRangeRequest=u.DeclarationRequest=u.FoldingRangeRequest=u.ColorPresentationRequest=u.DocumentColorRequest=u.ConfigurationRequest=u.DidChangeWorkspaceFoldersNotification=u.WorkspaceFoldersRequest=u.TypeDefinitionRequest=u.ImplementationRequest=u.ApplyWorkspaceEditRequest=u.ExecuteCommandRequest=u.PrepareRenameRequest=u.RenameRequest=u.PrepareSupportDefaultBehavior=u.DocumentOnTypeFormattingRequest=u.DocumentRangeFormattingRequest=u.DocumentFormattingRequest=u.DocumentLinkResolveRequest=void 0;var Ye=lo(),M=ce(),vu=uo();Object.defineProperty(u,"ImplementationRequest",{enumerable:!0,get:function(){return vu.ImplementationRequest}});var Su=ho();Object.defineProperty(u,"TypeDefinitionRequest",{enumerable:!0,get:function(){return Su.TypeDefinitionRequest}});var Do=po();Object.defineProperty(u,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return Do.WorkspaceFoldersRequest}});Object.defineProperty(u,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return Do.DidChangeWorkspaceFoldersNotification}});var xu=mo();Object.defineProperty(u,"ConfigurationRequest",{enumerable:!0,get:function(){return xu.ConfigurationRequest}});var Po=bo();Object.defineProperty(u,"DocumentColorRequest",{enumerable:!0,get:function(){return Po.DocumentColorRequest}});Object.defineProperty(u,"ColorPresentationRequest",{enumerable:!0,get:function(){return Po.ColorPresentationRequest}});var ku=yo();Object.defineProperty(u,"FoldingRangeRequest",{enumerable:!0,get:function(){return ku.FoldingRangeRequest}});var Tu=vo();Object.defineProperty(u,"DeclarationRequest",{enumerable:!0,get:function(){return Tu.DeclarationRequest}});var Ru=So();Object.defineProperty(u,"SelectionRangeRequest",{enumerable:!0,get:function(){return Ru.SelectionRangeRequest}});var Ji=ko();Object.defineProperty(u,"WorkDoneProgress",{enumerable:!0,get:function(){return Ji.WorkDoneProgress}});Object.defineProperty(u,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return Ji.WorkDoneProgressCreateRequest}});Object.defineProperty(u,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return Ji.WorkDoneProgressCancelNotification}});var Xi=To();Object.defineProperty(u,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return Xi.CallHierarchyIncomingCallsRequest}});Object.defineProperty(u,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return Xi.CallHierarchyOutgoingCallsRequest}});Object.defineProperty(u,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return Xi.CallHierarchyPrepareRequest}});var Ue=Ro();Object.defineProperty(u,"SemanticTokenTypes",{enumerable:!0,get:function(){return Ue.SemanticTokenTypes}});Object.defineProperty(u,"SemanticTokenModifiers",{enumerable:!0,get:function(){return Ue.SemanticTokenModifiers}});Object.defineProperty(u,"SemanticTokens",{enumerable:!0,get:function(){return Ue.SemanticTokens}});Object.defineProperty(u,"TokenFormat",{enumerable:!0,get:function(){return Ue.TokenFormat}});Object.defineProperty(u,"SemanticTokensRequest",{enumerable:!0,get:function(){return Ue.SemanticTokensRequest}});Object.defineProperty(u,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return Ue.SemanticTokensDeltaRequest}});Object.defineProperty(u,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return Ue.SemanticTokensRangeRequest}});Object.defineProperty(u,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return Ue.SemanticTokensRefreshRequest}});Object.defineProperty(u,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return Ue.SemanticTokensRegistrationType}});var wu=wo();Object.defineProperty(u,"ShowDocumentRequest",{enumerable:!0,get:function(){return wu.ShowDocumentRequest}});var Cu=Co();Object.defineProperty(u,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return Cu.LinkedEditingRangeRequest}});var ft=Eo();Object.defineProperty(u,"FileOperationPatternKind",{enumerable:!0,get:function(){return ft.FileOperationPatternKind}});Object.defineProperty(u,"DidCreateFilesNotification",{enumerable:!0,get:function(){return ft.DidCreateFilesNotification}});Object.defineProperty(u,"WillCreateFilesRequest",{enumerable:!0,get:function(){return ft.WillCreateFilesRequest}});Object.defineProperty(u,"DidRenameFilesNotification",{enumerable:!0,get:function(){return ft.DidRenameFilesNotification}});Object.defineProperty(u,"WillRenameFilesRequest",{enumerable:!0,get:function(){return ft.WillRenameFilesRequest}});Object.defineProperty(u,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return ft.DidDeleteFilesNotification}});Object.defineProperty(u,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return ft.WillDeleteFilesRequest}});var Yi=_o();Object.defineProperty(u,"UniquenessLevel",{enumerable:!0,get:function(){return Yi.UniquenessLevel}});Object.defineProperty(u,"MonikerKind",{enumerable:!0,get:function(){return Yi.MonikerKind}});Object.defineProperty(u,"MonikerRequest",{enumerable:!0,get:function(){return Yi.MonikerRequest}});var No;(function(n){function e(t){let i=t;return Ye.string(i.language)||Ye.string(i.scheme)||Ye.string(i.pattern)}n.is=e})(No=u.DocumentFilter||(u.DocumentFilter={}));var Lo;(function(n){function e(t){if(!Array.isArray(t))return!1;for(let i of t)if(!Ye.string(i)&&!No.is(i))return!1;return!0}n.is=e})(Lo=u.DocumentSelector||(u.DocumentSelector={}));var Eu;(function(n){n.type=new M.ProtocolRequestType("client/registerCapability")})(Eu=u.RegistrationRequest||(u.RegistrationRequest={}));var _u;(function(n){n.type=new M.ProtocolRequestType("client/unregisterCapability")})(_u=u.UnregistrationRequest||(u.UnregistrationRequest={}));var Du;(function(n){n.Create="create",n.Rename="rename",n.Delete="delete"})(Du=u.ResourceOperationKind||(u.ResourceOperationKind={}));var Pu;(function(n){n.Abort="abort",n.Transactional="transactional",n.TextOnlyTransactional="textOnlyTransactional",n.Undo="undo"})(Pu=u.FailureHandlingKind||(u.FailureHandlingKind={}));var Nu;(function(n){function e(t){let i=t;return i&&Ye.string(i.id)&&i.id.length>0}n.hasId=e})(Nu=u.StaticRegistrationOptions||(u.StaticRegistrationOptions={}));var Lu;(function(n){function e(t){let i=t;return i&&(i.documentSelector===null||Lo.is(i.documentSelector))}n.is=e})(Lu=u.TextDocumentRegistrationOptions||(u.TextDocumentRegistrationOptions={}));var Fu;(function(n){function e(i){let r=i;return Ye.objectLiteral(r)&&(r.workDoneProgress===void 0||Ye.boolean(r.workDoneProgress))}n.is=e;function t(i){let r=i;return r&&Ye.boolean(r.workDoneProgress)}n.hasWorkDoneProgress=t})(Fu=u.WorkDoneProgressOptions||(u.WorkDoneProgressOptions={}));var Iu;(function(n){n.type=new M.ProtocolRequestType("initialize")})(Iu=u.InitializeRequest||(u.InitializeRequest={}));var qu;(function(n){n.unknownProtocolVersion=1})(qu=u.InitializeError||(u.InitializeError={}));var Ou;(function(n){n.type=new M.ProtocolNotificationType("initialized")})(Ou=u.InitializedNotification||(u.InitializedNotification={}));var Au;(function(n){n.type=new M.ProtocolRequestType0("shutdown")})(Au=u.ShutdownRequest||(u.ShutdownRequest={}));var Mu;(function(n){n.type=new M.ProtocolNotificationType0("exit")})(Mu=u.ExitNotification||(u.ExitNotification={}));var ju;(function(n){n.type=new M.ProtocolNotificationType("workspace/didChangeConfiguration")})(ju=u.DidChangeConfigurationNotification||(u.DidChangeConfigurationNotification={}));var Wu;(function(n){n.Error=1,n.Warning=2,n.Info=3,n.Log=4})(Wu=u.MessageType||(u.MessageType={}));var Bu;(function(n){n.type=new M.ProtocolNotificationType("window/showMessage")})(Bu=u.ShowMessageNotification||(u.ShowMessageNotification={}));var Uu;(function(n){n.type=new M.ProtocolRequestType("window/showMessageRequest")})(Uu=u.ShowMessageRequest||(u.ShowMessageRequest={}));var Gu;(function(n){n.type=new M.ProtocolNotificationType("window/logMessage")})(Gu=u.LogMessageNotification||(u.LogMessageNotification={}));var $u;(function(n){n.type=new M.ProtocolNotificationType("telemetry/event")})($u=u.TelemetryEventNotification||(u.TelemetryEventNotification={}));var Hu;(function(n){n.None=0,n.Full=1,n.Incremental=2})(Hu=u.TextDocumentSyncKind||(u.TextDocumentSyncKind={}));var Vu;(function(n){n.method="textDocument/didOpen",n.type=new M.ProtocolNotificationType(n.method)})(Vu=u.DidOpenTextDocumentNotification||(u.DidOpenTextDocumentNotification={}));var zu;(function(n){function e(i){let r=i;return r!=null&&typeof r.text=="string"&&r.range!==void 0&&(r.rangeLength===void 0||typeof r.rangeLength=="number")}n.isIncremental=e;function t(i){let r=i;return r!=null&&typeof r.text=="string"&&r.range===void 0&&r.rangeLength===void 0}n.isFull=t})(zu=u.TextDocumentContentChangeEvent||(u.TextDocumentContentChangeEvent={}));var Ku;(function(n){n.method="textDocument/didChange",n.type=new M.ProtocolNotificationType(n.method)})(Ku=u.DidChangeTextDocumentNotification||(u.DidChangeTextDocumentNotification={}));var Ju;(function(n){n.method="textDocument/didClose",n.type=new M.ProtocolNotificationType(n.method)})(Ju=u.DidCloseTextDocumentNotification||(u.DidCloseTextDocumentNotification={}));var Xu;(function(n){n.method="textDocument/didSave",n.type=new M.ProtocolNotificationType(n.method)})(Xu=u.DidSaveTextDocumentNotification||(u.DidSaveTextDocumentNotification={}));var Yu;(function(n){n.Manual=1,n.AfterDelay=2,n.FocusOut=3})(Yu=u.TextDocumentSaveReason||(u.TextDocumentSaveReason={}));var Qu;(function(n){n.method="textDocument/willSave",n.type=new M.ProtocolNotificationType(n.method)})(Qu=u.WillSaveTextDocumentNotification||(u.WillSaveTextDocumentNotification={}));var Zu;(function(n){n.method="textDocument/willSaveWaitUntil",n.type=new M.ProtocolRequestType(n.method)})(Zu=u.WillSaveTextDocumentWaitUntilRequest||(u.WillSaveTextDocumentWaitUntilRequest={}));var ed;(function(n){n.type=new M.ProtocolNotificationType("workspace/didChangeWatchedFiles")})(ed=u.DidChangeWatchedFilesNotification||(u.DidChangeWatchedFilesNotification={}));var td;(function(n){n.Created=1,n.Changed=2,n.Deleted=3})(td=u.FileChangeType||(u.FileChangeType={}));var nd;(function(n){n.Create=1,n.Change=2,n.Delete=4})(nd=u.WatchKind||(u.WatchKind={}));var id;(function(n){n.type=new M.ProtocolNotificationType("textDocument/publishDiagnostics")})(id=u.PublishDiagnosticsNotification||(u.PublishDiagnosticsNotification={}));var rd;(function(n){n.Invoked=1,n.TriggerCharacter=2,n.TriggerForIncompleteCompletions=3})(rd=u.CompletionTriggerKind||(u.CompletionTriggerKind={}));var sd;(function(n){n.method="textDocument/completion",n.type=new M.ProtocolRequestType(n.method)})(sd=u.CompletionRequest||(u.CompletionRequest={}));var od;(function(n){n.method="completionItem/resolve",n.type=new M.ProtocolRequestType(n.method)})(od=u.CompletionResolveRequest||(u.CompletionResolveRequest={}));var ad;(function(n){n.method="textDocument/hover",n.type=new M.ProtocolRequestType(n.method)})(ad=u.HoverRequest||(u.HoverRequest={}));var cd;(function(n){n.Invoked=1,n.TriggerCharacter=2,n.ContentChange=3})(cd=u.SignatureHelpTriggerKind||(u.SignatureHelpTriggerKind={}));var ld;(function(n){n.method="textDocument/signatureHelp",n.type=new M.ProtocolRequestType(n.method)})(ld=u.SignatureHelpRequest||(u.SignatureHelpRequest={}));var ud;(function(n){n.method="textDocument/definition",n.type=new M.ProtocolRequestType(n.method)})(ud=u.DefinitionRequest||(u.DefinitionRequest={}));var dd;(function(n){n.method="textDocument/references",n.type=new M.ProtocolRequestType(n.method)})(dd=u.ReferencesRequest||(u.ReferencesRequest={}));var hd;(function(n){n.method="textDocument/documentHighlight",n.type=new M.ProtocolRequestType(n.method)})(hd=u.DocumentHighlightRequest||(u.DocumentHighlightRequest={}));var fd;(function(n){n.method="textDocument/documentSymbol",n.type=new M.ProtocolRequestType(n.method)})(fd=u.DocumentSymbolRequest||(u.DocumentSymbolRequest={}));var pd;(function(n){n.method="textDocument/codeAction",n.type=new M.ProtocolRequestType(n.method)})(pd=u.CodeActionRequest||(u.CodeActionRequest={}));var md;(function(n){n.method="codeAction/resolve",n.type=new M.ProtocolRequestType(n.method)})(md=u.CodeActionResolveRequest||(u.CodeActionResolveRequest={}));var gd;(function(n){n.method="workspace/symbol",n.type=new M.ProtocolRequestType(n.method)})(gd=u.WorkspaceSymbolRequest||(u.WorkspaceSymbolRequest={}));var bd;(function(n){n.method="textDocument/codeLens",n.type=new M.ProtocolRequestType(n.method)})(bd=u.CodeLensRequest||(u.CodeLensRequest={}));var yd;(function(n){n.method="codeLens/resolve",n.type=new M.ProtocolRequestType(n.method)})(yd=u.CodeLensResolveRequest||(u.CodeLensResolveRequest={}));var vd;(function(n){n.method="workspace/codeLens/refresh",n.type=new M.ProtocolRequestType0(n.method)})(vd=u.CodeLensRefreshRequest||(u.CodeLensRefreshRequest={}));var Sd;(function(n){n.method="textDocument/documentLink",n.type=new M.ProtocolRequestType(n.method)})(Sd=u.DocumentLinkRequest||(u.DocumentLinkRequest={}));var xd;(function(n){n.method="documentLink/resolve",n.type=new M.ProtocolRequestType(n.method)})(xd=u.DocumentLinkResolveRequest||(u.DocumentLinkResolveRequest={}));var kd;(function(n){n.method="textDocument/formatting",n.type=new M.ProtocolRequestType(n.method)})(kd=u.DocumentFormattingRequest||(u.DocumentFormattingRequest={}));var Td;(function(n){n.method="textDocument/rangeFormatting",n.type=new M.ProtocolRequestType(n.method)})(Td=u.DocumentRangeFormattingRequest||(u.DocumentRangeFormattingRequest={}));var Rd;(function(n){n.method="textDocument/onTypeFormatting",n.type=new M.ProtocolRequestType(n.method)})(Rd=u.DocumentOnTypeFormattingRequest||(u.DocumentOnTypeFormattingRequest={}));var wd;(function(n){n.Identifier=1})(wd=u.PrepareSupportDefaultBehavior||(u.PrepareSupportDefaultBehavior={}));var Cd;(function(n){n.method="textDocument/rename",n.type=new M.ProtocolRequestType(n.method)})(Cd=u.RenameRequest||(u.RenameRequest={}));var Ed;(function(n){n.method="textDocument/prepareRename",n.type=new M.ProtocolRequestType(n.method)})(Ed=u.PrepareRenameRequest||(u.PrepareRenameRequest={}));var _d;(function(n){n.type=new M.ProtocolRequestType("workspace/executeCommand")})(_d=u.ExecuteCommandRequest||(u.ExecuteCommandRequest={}));var Dd;(function(n){n.type=new M.ProtocolRequestType("workspace/applyEdit")})(Dd=u.ApplyWorkspaceEditRequest||(u.ApplyWorkspaceEditRequest={}))});var qo=L(En=>{"use strict";Object.defineProperty(En,"__esModule",{value:!0});En.createProtocolConnection=void 0;var Io=_t();function Pd(n,e,t,i){return Io.ConnectionStrategy.is(i)&&(i={connectionStrategy:i}),Io.createMessageConnection(n,e,t,i)}En.createProtocolConnection=Pd});var Oo=L(pe=>{"use strict";var Nd=pe&&pe.__createBinding||(Object.create?function(n,e,t,i){i===void 0&&(i=t),Object.defineProperty(n,i,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,i){i===void 0&&(i=t),n[i]=e[t]}),_n=pe&&pe.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Nd(e,n,t)};Object.defineProperty(pe,"__esModule",{value:!0});pe.LSPErrorCodes=pe.createProtocolConnection=void 0;_n(_t(),pe);_n(to(),pe);_n(ce(),pe);_n(Fo(),pe);var Ld=qo();Object.defineProperty(pe,"createProtocolConnection",{enumerable:!0,get:function(){return Ld.createProtocolConnection}});var Fd;(function(n){n.lspReservedErrorRangeStart=-32899,n.ContentModified=-32801,n.RequestCancelled=-32800,n.lspReservedErrorRangeEnd=-32800})(Fd=pe.LSPErrorCodes||(pe.LSPErrorCodes={}))});var ye=L(qe=>{"use strict";var Id=qe&&qe.__createBinding||(Object.create?function(n,e,t,i){i===void 0&&(i=t),Object.defineProperty(n,i,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,i){i===void 0&&(i=t),n[i]=e[t]}),Ao=qe&&qe.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Id(e,n,t)};Object.defineProperty(qe,"__esModule",{value:!0});qe.createProtocolConnection=void 0;var qd=zi();Ao(zi(),qe);Ao(Oo(),qe);function Od(n,e,t,i){return qd.createMessageConnection(n,e,t,i)}qe.createProtocolConnection=Od});var Qi=L(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});Te.generateUuid=Te.parse=Te.isUUID=Te.v4=Te.empty=void 0;var Dn=class{constructor(e){this._value=e}asHex(){return this._value}equals(e){return this.asHex()===e.asHex()}},G=class extends Dn{constructor(){super([G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),"-",G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),"-","4",G._randomHex(),G._randomHex(),G._randomHex(),"-",G._oneOf(G._timeHighBits),G._randomHex(),G._randomHex(),G._randomHex(),"-",G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex(),G._randomHex()].join(""))}static _oneOf(e){return e[Math.floor(e.length*Math.random())]}static _randomHex(){return G._oneOf(G._chars)}};G._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"];G._timeHighBits=["8","9","a","b"];Te.empty=new Dn("00000000-0000-0000-0000-000000000000");function Mo(){return new G}Te.v4=Mo;var Ad=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function jo(n){return Ad.test(n)}Te.isUUID=jo;function Md(n){if(!jo(n))throw new Error("invalid uuid");return new Dn(n)}Te.parse=Md;function jd(){return Mo().asHex()}Te.generateUuid=jd});var Bo=L(Ze=>{"use strict";Object.defineProperty(Ze,"__esModule",{value:!0});Ze.attachPartialResult=Ze.ProgressFeature=Ze.attachWorkDone=void 0;var Qe=ye(),Wd=Qi(),Ge=class{constructor(e,t){this._connection=e,this._token=t,Ge.Instances.set(this._token,this)}begin(e,t,i,r){let s={kind:"begin",title:e,percentage:t,message:i,cancellable:r};this._connection.sendProgress(Qe.WorkDoneProgress.type,this._token,s)}report(e,t){let i={kind:"report"};typeof e=="number"?(i.percentage=e,t!==void 0&&(i.message=t)):i.message=e,this._connection.sendProgress(Qe.WorkDoneProgress.type,this._token,i)}done(){Ge.Instances.delete(this._token),this._connection.sendProgress(Qe.WorkDoneProgress.type,this._token,{kind:"end"})}};Ge.Instances=new Map;var Zi=class extends Ge{constructor(e,t){super(e,t);this._source=new Qe.CancellationTokenSource}get token(){return this._source.token}done(){this._source.dispose(),super.done()}cancel(){this._source.cancel()}},Pn=class{constructor(){}begin(){}report(){}done(){}},er=class extends Pn{constructor(){super();this._source=new Qe.CancellationTokenSource}get token(){return this._source.token}done(){this._source.dispose()}cancel(){this._source.cancel()}};function Bd(n,e){if(e===void 0||e.workDoneToken===void 0)return new Pn;let t=e.workDoneToken;return delete e.workDoneToken,new Ge(n,t)}Ze.attachWorkDone=Bd;var Ud=n=>class extends n{constructor(){super();this._progressSupported=!1}initialize(e){var t;((t=e==null?void 0:e.window)===null||t===void 0?void 0:t.workDoneProgress)===!0&&(this._progressSupported=!0,this.connection.onNotification(Qe.WorkDoneProgressCancelNotification.type,i=>{let r=Ge.Instances.get(i.token);(r instanceof Zi||r instanceof er)&&r.cancel()}))}attachWorkDoneProgress(e){return e===void 0?new Pn:new Ge(this.connection,e)}createWorkDoneProgress(){if(this._progressSupported){let e=Wd.generateUuid();return this.connection.sendRequest(Qe.WorkDoneProgressCreateRequest.type,{token:e}).then(()=>new Zi(this.connection,e))}else return Promise.resolve(new er)}};Ze.ProgressFeature=Ud;var tr;(function(n){n.type=new Qe.ProgressType})(tr||(tr={}));var Wo=class{constructor(e,t){this._connection=e,this._token=t}report(e){this._connection.sendProgress(tr.type,this._token,e)}};function Gd(n,e){if(e===void 0||e.partialResultToken===void 0)return;let t=e.partialResultToken;return delete e.partialResultToken,new Wo(n,t)}Ze.attachPartialResult=Gd});var Uo=L(Nn=>{"use strict";Object.defineProperty(Nn,"__esModule",{value:!0});Nn.ConfigurationFeature=void 0;var $d=ye(),Hd=yn(),Vd=n=>class extends n{getConfiguration(e){return e?Hd.string(e)?this._getConfiguration({section:e}):this._getConfiguration(e):this._getConfiguration({})}_getConfiguration(e){let t={items:Array.isArray(e)?e:[e]};return this.connection.sendRequest($d.ConfigurationRequest.type,t).then(i=>Array.isArray(e)?i:i[0])}};Nn.ConfigurationFeature=Vd});var Go=L(Fn=>{"use strict";Object.defineProperty(Fn,"__esModule",{value:!0});Fn.WorkspaceFoldersFeature=void 0;var Ln=ye(),zd=n=>class extends n{initialize(e){let t=e.workspace;t&&t.workspaceFolders&&(this._onDidChangeWorkspaceFolders=new Ln.Emitter,this.connection.onNotification(Ln.DidChangeWorkspaceFoldersNotification.type,i=>{this._onDidChangeWorkspaceFolders.fire(i.event)}))}getWorkspaceFolders(){return this.connection.sendRequest(Ln.WorkspaceFoldersRequest.type)}get onDidChangeWorkspaceFolders(){if(!this._onDidChangeWorkspaceFolders)throw new Error("Client doesn't support sending workspace folder change events.");return this._unregistration||(this._unregistration=this.connection.client.register(Ln.DidChangeWorkspaceFoldersNotification.type)),this._onDidChangeWorkspaceFolders.event}};Fn.WorkspaceFoldersFeature=zd});var $o=L(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.CallHierarchyFeature=void 0;var nr=ye(),Kd=n=>class extends n{get callHierarchy(){return{onPrepare:e=>{this.connection.onRequest(nr.CallHierarchyPrepareRequest.type,(t,i)=>e(t,i,this.attachWorkDoneProgress(t),void 0))},onIncomingCalls:e=>{let t=nr.CallHierarchyIncomingCallsRequest.type;this.connection.onRequest(t,(i,r)=>e(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(t,i)))},onOutgoingCalls:e=>{let t=nr.CallHierarchyOutgoingCallsRequest.type;this.connection.onRequest(t,(i,r)=>e(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(t,i)))}}}};In.CallHierarchyFeature=Kd});var rr=L(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.SemanticTokensBuilder=Nt.SemanticTokensFeature=void 0;var ir=ye(),Jd=n=>class extends n{get semanticTokens(){return{on:e=>{let t=ir.SemanticTokensRequest.type;this.connection.onRequest(t,(i,r)=>e(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(t,i)))},onDelta:e=>{let t=ir.SemanticTokensDeltaRequest.type;this.connection.onRequest(t,(i,r)=>e(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(t,i)))},onRange:e=>{let t=ir.SemanticTokensRangeRequest.type;this.connection.onRequest(t,(i,r)=>e(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(t,i)))}}}};Nt.SemanticTokensFeature=Jd;var Ho=class{constructor(){this._prevData=void 0,this.initialize()}initialize(){this._id=Date.now(),this._prevLine=0,this._prevChar=0,this._data=[],this._dataLen=0}push(e,t,i,r,s){let c=e,y=t;this._dataLen>0&&(c-=this._prevLine,c===0&&(y-=this._prevChar)),this._data[this._dataLen++]=c,this._data[this._dataLen++]=y,this._data[this._dataLen++]=i,this._data[this._dataLen++]=r,this._data[this._dataLen++]=s,this._prevLine=e,this._prevChar=t}get id(){return this._id.toString()}previousResult(e){this.id===e&&(this._prevData=this._data),this.initialize()}build(){return this._prevData=void 0,{resultId:this.id,data:this._data}}canBuildEdits(){return this._prevData!==void 0}buildEdits(){if(this._prevData!==void 0){let e=this._prevData.length,t=this._data.length,i=0;for(;i<t&&i<e&&this._prevData[i]===this._data[i];)i++;if(i<t&&i<e){let r=0;for(;r<t&&r<e&&this._prevData[e-1-r]===this._data[t-1-r];)r++;let s=this._data.slice(i,t-r);return{resultId:this.id,edits:[{start:i,deleteCount:e-r-i,data:s}]}}else return i<t?{resultId:this.id,edits:[{start:i,deleteCount:0,data:this._data.slice(i)}]}:i<e?{resultId:this.id,edits:[{start:i,deleteCount:e-i}]}:{resultId:this.id,edits:[]}}else return this.build()}};Nt.SemanticTokensBuilder=Ho});var Vo=L(qn=>{"use strict";Object.defineProperty(qn,"__esModule",{value:!0});qn.ShowDocumentFeature=void 0;var Xd=ye(),Yd=n=>class extends n{showDocument(e){return this.connection.sendRequest(Xd.ShowDocumentRequest.type,e)}};qn.ShowDocumentFeature=Yd});var zo=L(On=>{"use strict";Object.defineProperty(On,"__esModule",{value:!0});On.FileOperationsFeature=void 0;var Lt=ye(),Qd=n=>class extends n{onDidCreateFiles(e){this.connection.onNotification(Lt.DidCreateFilesNotification.type,t=>{e(t)})}onDidRenameFiles(e){this.connection.onNotification(Lt.DidRenameFilesNotification.type,t=>{e(t)})}onDidDeleteFiles(e){this.connection.onNotification(Lt.DidDeleteFilesNotification.type,t=>{e(t)})}onWillCreateFiles(e){return this.connection.onRequest(Lt.WillCreateFilesRequest.type,(t,i)=>e(t,i))}onWillRenameFiles(e){return this.connection.onRequest(Lt.WillRenameFilesRequest.type,(t,i)=>e(t,i))}onWillDeleteFiles(e){return this.connection.onRequest(Lt.WillDeleteFilesRequest.type,(t,i)=>e(t,i))}};On.FileOperationsFeature=Qd});var Ko=L(An=>{"use strict";Object.defineProperty(An,"__esModule",{value:!0});An.LinkedEditingRangeFeature=void 0;var Zd=ye(),eh=n=>class extends n{onLinkedEditingRange(e){this.connection.onRequest(Zd.LinkedEditingRangeRequest.type,(t,i)=>e(t,i,this.attachWorkDoneProgress(t),void 0))}};An.LinkedEditingRangeFeature=eh});var Jo=L(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.MonikerFeature=void 0;var th=ye(),nh=n=>class extends n{get moniker(){return{on:e=>{let t=th.MonikerRequest.type;this.connection.onRequest(t,(i,r)=>e(i,r,this.attachWorkDoneProgress(i),this.attachPartialResultProgress(t,i)))}}}};Mn.MonikerFeature=nh});var fr=L(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.createConnection=z.combineFeatures=z.combineLanguagesFeatures=z.combineWorkspaceFeatures=z.combineWindowFeatures=z.combineClientFeatures=z.combineTracerFeatures=z.combineTelemetryFeatures=z.combineConsoleFeatures=z._LanguagesImpl=z.BulkUnregistration=z.BulkRegistration=z.ErrorMessageTracker=z.TextDocuments=void 0;var w=ye(),Re=yn(),sr=Qi(),j=Bo(),ih=Uo(),rh=Go(),sh=$o(),oh=rr(),ah=Vo(),ch=zo(),lh=Ko(),uh=Jo();function or(n){if(n!==null)return n}var Xo=class{constructor(e){this._documents=Object.create(null),this._configuration=e,this._onDidChangeContent=new w.Emitter,this._onDidOpen=new w.Emitter,this._onDidClose=new w.Emitter,this._onDidSave=new w.Emitter,this._onWillSave=new w.Emitter}get onDidChangeContent(){return this._onDidChangeContent.event}get onDidOpen(){return this._onDidOpen.event}get onWillSave(){return this._onWillSave.event}onWillSaveWaitUntil(e){this._willSaveWaitUntil=e}get onDidSave(){return this._onDidSave.event}get onDidClose(){return this._onDidClose.event}get(e){return this._documents[e]}all(){return Object.keys(this._documents).map(e=>this._documents[e])}keys(){return Object.keys(this._documents)}listen(e){e.__textDocumentSync=w.TextDocumentSyncKind.Full,e.onDidOpenTextDocument(t=>{let i=t.textDocument,r=this._configuration.create(i.uri,i.languageId,i.version,i.text);this._documents[i.uri]=r;let s=Object.freeze({document:r});this._onDidOpen.fire(s),this._onDidChangeContent.fire(s)}),e.onDidChangeTextDocument(t=>{let i=t.textDocument,r=t.contentChanges;if(r.length===0)return;let s=this._documents[i.uri],{version:c}=i;if(c==null)throw new Error(`Received document change event for ${i.uri} without valid version identifier`);s=this._configuration.update(s,r,c),this._documents[i.uri]=s,this._onDidChangeContent.fire(Object.freeze({document:s}))}),e.onDidCloseTextDocument(t=>{let i=this._documents[t.textDocument.uri];i&&(delete this._documents[t.textDocument.uri],this._onDidClose.fire(Object.freeze({document:i})))}),e.onWillSaveTextDocument(t=>{let i=this._documents[t.textDocument.uri];i&&this._onWillSave.fire(Object.freeze({document:i,reason:t.reason}))}),e.onWillSaveTextDocumentWaitUntil((t,i)=>{let r=this._documents[t.textDocument.uri];return r&&this._willSaveWaitUntil?this._willSaveWaitUntil(Object.freeze({document:r,reason:t.reason}),i):[]}),e.onDidSaveTextDocument(t=>{let i=this._documents[t.textDocument.uri];i&&this._onDidSave.fire(Object.freeze({document:i}))})}};z.TextDocuments=Xo;var Yo=class{constructor(){this._messages=Object.create(null)}add(e){let t=this._messages[e];t||(t=0),t++,this._messages[e]=t}sendErrors(e){Object.keys(this._messages).forEach(t=>{e.window.showErrorMessage(t)})}};z.ErrorMessageTracker=Yo;var ar=class{constructor(){}rawAttach(e){this._rawConnection=e}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}fillServerCapabilities(e){}initialize(e){}error(e){this.send(w.MessageType.Error,e)}warn(e){this.send(w.MessageType.Warning,e)}info(e){this.send(w.MessageType.Info,e)}log(e){this.send(w.MessageType.Log,e)}send(e,t){this._rawConnection&&this._rawConnection.sendNotification(w.LogMessageNotification.type,{type:e,message:t})}},Qo=class{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}showErrorMessage(e,...t){let i={type:w.MessageType.Error,message:e,actions:t};return this.connection.sendRequest(w.ShowMessageRequest.type,i).then(or)}showWarningMessage(e,...t){let i={type:w.MessageType.Warning,message:e,actions:t};return this.connection.sendRequest(w.ShowMessageRequest.type,i).then(or)}showInformationMessage(e,...t){let i={type:w.MessageType.Info,message:e,actions:t};return this.connection.sendRequest(w.ShowMessageRequest.type,i).then(or)}},Zo=ah.ShowDocumentFeature(j.ProgressFeature(Qo)),dh;(function(n){function e(){return new cr}n.create=e})(dh=z.BulkRegistration||(z.BulkRegistration={}));var cr=class{constructor(){this._registrations=[],this._registered=new Set}add(e,t){let i=Re.string(e)?e:e.method;if(this._registered.has(i))throw new Error(`${i} is already added to this registration`);let r=sr.generateUuid();this._registrations.push({id:r,method:i,registerOptions:t||{}}),this._registered.add(i)}asRegistrationParams(){return{registrations:this._registrations}}},hh;(function(n){function e(){return new jn(void 0,[])}n.create=e})(hh=z.BulkUnregistration||(z.BulkUnregistration={}));var jn=class{constructor(e,t){this._connection=e,this._unregistrations=new Map,t.forEach(i=>{this._unregistrations.set(i.method,i)})}get isAttached(){return!!this._connection}attach(e){this._connection=e}add(e){this._unregistrations.set(e.method,e)}dispose(){let e=[];for(let i of this._unregistrations.values())e.push(i);let t={unregisterations:e};this._connection.sendRequest(w.UnregistrationRequest.type,t).then(void 0,i=>{this._connection.console.info("Bulk unregistration failed.")})}disposeSingle(e){let t=Re.string(e)?e:e.method,i=this._unregistrations.get(t);if(!i)return!1;let r={unregisterations:[i]};return this._connection.sendRequest(w.UnregistrationRequest.type,r).then(()=>{this._unregistrations.delete(t)},s=>{this._connection.console.info(`Un-registering request handler for ${i.id} failed.`)}),!0}},lr=class{attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}register(e,t,i){return e instanceof cr?this.registerMany(e):e instanceof jn?this.registerSingle1(e,t,i):this.registerSingle2(e,t)}registerSingle1(e,t,i){let r=Re.string(t)?t:t.method,s=sr.generateUuid(),c={registrations:[{id:s,method:r,registerOptions:i||{}}]};return e.isAttached||e.attach(this.connection),this.connection.sendRequest(w.RegistrationRequest.type,c).then(y=>(e.add({id:s,method:r}),e),y=>(this.connection.console.info(`Registering request handler for ${r} failed.`),Promise.reject(y)))}registerSingle2(e,t){let i=Re.string(e)?e:e.method,r=sr.generateUuid(),s={registrations:[{id:r,method:i,registerOptions:t||{}}]};return this.connection.sendRequest(w.RegistrationRequest.type,s).then(c=>w.Disposable.create(()=>{this.unregisterSingle(r,i)}),c=>(this.connection.console.info(`Registering request handler for ${i} failed.`),Promise.reject(c)))}unregisterSingle(e,t){let i={unregisterations:[{id:e,method:t}]};return this.connection.sendRequest(w.UnregistrationRequest.type,i).then(void 0,r=>{this.connection.console.info(`Un-registering request handler for ${e} failed.`)})}registerMany(e){let t=e.asRegistrationParams();return this.connection.sendRequest(w.RegistrationRequest.type,t).then(()=>new jn(this._connection,t.registrations.map(i=>({id:i.id,method:i.method}))),i=>(this.connection.console.info("Bulk registration failed."),Promise.reject(i)))}},ea=class{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}applyEdit(e){function t(r){return r&&!!r.edit}let i=t(e)?e:{edit:e};return this.connection.sendRequest(w.ApplyWorkspaceEditRequest.type,i)}},ta=ch.FileOperationsFeature(rh.WorkspaceFoldersFeature(ih.ConfigurationFeature(ea))),ur=class{constructor(){this._trace=w.Trace.Off}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}set trace(e){this._trace=e}log(e,t){this._trace!==w.Trace.Off&&this.connection.sendNotification(w.LogTraceNotification.type,{message:e,verbose:this._trace===w.Trace.Verbose?t:void 0})}},dr=class{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}logEvent(e){this.connection.sendNotification(w.TelemetryEventNotification.type,e)}},hr=class{constructor(){}attach(e){this._connection=e}get connection(){if(!this._connection)throw new Error("Remote is not attached to a connection yet.");return this._connection}initialize(e){}fillServerCapabilities(e){}attachWorkDoneProgress(e){return j.attachWorkDone(this.connection,e)}attachPartialResultProgress(e,t){return j.attachPartialResult(this.connection,t)}};z._LanguagesImpl=hr;var na=uh.MonikerFeature(lh.LinkedEditingRangeFeature(oh.SemanticTokensFeature(sh.CallHierarchyFeature(hr))));function ia(n,e){return function(t){return e(n(t))}}z.combineConsoleFeatures=ia;function ra(n,e){return function(t){return e(n(t))}}z.combineTelemetryFeatures=ra;function sa(n,e){return function(t){return e(n(t))}}z.combineTracerFeatures=sa;function oa(n,e){return function(t){return e(n(t))}}z.combineClientFeatures=oa;function aa(n,e){return function(t){return e(n(t))}}z.combineWindowFeatures=aa;function ca(n,e){return function(t){return e(n(t))}}z.combineWorkspaceFeatures=ca;function fh(n,e){return function(t){return e(n(t))}}z.combineLanguagesFeatures=fh;function ph(n,e){function t(r,s,c){return r&&s?c(r,s):r||s}return{__brand:"features",console:t(n.console,e.console,ia),tracer:t(n.tracer,e.tracer,sa),telemetry:t(n.telemetry,e.telemetry,ra),client:t(n.client,e.client,oa),window:t(n.window,e.window,aa),workspace:t(n.workspace,e.workspace,ca)}}z.combineFeatures=ph;function mh(n,e,t){let i=t&&t.console?new(t.console(ar)):new ar,r=n(i);i.rawAttach(r);let s=t&&t.tracer?new(t.tracer(ur)):new ur,c=t&&t.telemetry?new(t.telemetry(dr)):new dr,y=t&&t.client?new(t.client(lr)):new lr,b=t&&t.window?new(t.window(Zo)):new Zo,x=t&&t.workspace?new(t.workspace(ta)):new ta,k=t&&t.languages?new(t.languages(na)):new na,E=[i,s,c,y,b,x,k];function C(v){return v instanceof Promise?v:Re.thenable(v)?new Promise((g,R)=>{v.then(I=>g(I),I=>R(I))}):Promise.resolve(v)}let D,N,$,B={listen:()=>r.listen(),sendRequest:(v,...g)=>r.sendRequest(Re.string(v)?v:v.method,...g),onRequest:(v,g)=>r.onRequest(v,g),sendNotification:(v,g)=>{let R=Re.string(v)?v:v.method;arguments.length===1?r.sendNotification(R):r.sendNotification(R,g)},onNotification:(v,g)=>r.onNotification(v,g),onProgress:r.onProgress,sendProgress:r.sendProgress,onInitialize:v=>N=v,onInitialized:v=>r.onNotification(w.InitializedNotification.type,v),onShutdown:v=>D=v,onExit:v=>$=v,get console(){return i},get telemetry(){return c},get tracer(){return s},get client(){return y},get window(){return b},get workspace(){return x},get languages(){return k},onDidChangeConfiguration:v=>r.onNotification(w.DidChangeConfigurationNotification.type,v),onDidChangeWatchedFiles:v=>r.onNotification(w.DidChangeWatchedFilesNotification.type,v),__textDocumentSync:void 0,onDidOpenTextDocument:v=>r.onNotification(w.DidOpenTextDocumentNotification.type,v),onDidChangeTextDocument:v=>r.onNotification(w.DidChangeTextDocumentNotification.type,v),onDidCloseTextDocument:v=>r.onNotification(w.DidCloseTextDocumentNotification.type,v),onWillSaveTextDocument:v=>r.onNotification(w.WillSaveTextDocumentNotification.type,v),onWillSaveTextDocumentWaitUntil:v=>r.onRequest(w.WillSaveTextDocumentWaitUntilRequest.type,v),onDidSaveTextDocument:v=>r.onNotification(w.DidSaveTextDocumentNotification.type,v),sendDiagnostics:v=>r.sendNotification(w.PublishDiagnosticsNotification.type,v),onHover:v=>r.onRequest(w.HoverRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),void 0)),onCompletion:v=>r.onRequest(w.CompletionRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onCompletionResolve:v=>r.onRequest(w.CompletionResolveRequest.type,v),onSignatureHelp:v=>r.onRequest(w.SignatureHelpRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),void 0)),onDeclaration:v=>r.onRequest(w.DeclarationRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onDefinition:v=>r.onRequest(w.DefinitionRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onTypeDefinition:v=>r.onRequest(w.TypeDefinitionRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onImplementation:v=>r.onRequest(w.ImplementationRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onReferences:v=>r.onRequest(w.ReferencesRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onDocumentHighlight:v=>r.onRequest(w.DocumentHighlightRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onDocumentSymbol:v=>r.onRequest(w.DocumentSymbolRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onWorkspaceSymbol:v=>r.onRequest(w.WorkspaceSymbolRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onCodeAction:v=>r.onRequest(w.CodeActionRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onCodeActionResolve:v=>r.onRequest(w.CodeActionResolveRequest.type,(g,R)=>v(g,R)),onCodeLens:v=>r.onRequest(w.CodeLensRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onCodeLensResolve:v=>r.onRequest(w.CodeLensResolveRequest.type,(g,R)=>v(g,R)),onDocumentFormatting:v=>r.onRequest(w.DocumentFormattingRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),void 0)),onDocumentRangeFormatting:v=>r.onRequest(w.DocumentRangeFormattingRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),void 0)),onDocumentOnTypeFormatting:v=>r.onRequest(w.DocumentOnTypeFormattingRequest.type,(g,R)=>v(g,R)),onRenameRequest:v=>r.onRequest(w.RenameRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),void 0)),onPrepareRename:v=>r.onRequest(w.PrepareRenameRequest.type,(g,R)=>v(g,R)),onDocumentLinks:v=>r.onRequest(w.DocumentLinkRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onDocumentLinkResolve:v=>r.onRequest(w.DocumentLinkResolveRequest.type,(g,R)=>v(g,R)),onDocumentColor:v=>r.onRequest(w.DocumentColorRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onColorPresentation:v=>r.onRequest(w.ColorPresentationRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onFoldingRanges:v=>r.onRequest(w.FoldingRangeRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onSelectionRanges:v=>r.onRequest(w.SelectionRangeRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),j.attachPartialResult(r,g))),onExecuteCommand:v=>r.onRequest(w.ExecuteCommandRequest.type,(g,R)=>v(g,R,j.attachWorkDone(r,g),void 0)),dispose:()=>r.dispose()};for(let v of E)v.attach(B);return r.onRequest(w.InitializeRequest.type,v=>{e.initialize(v),Re.string(v.trace)&&(s.trace=w.Trace.fromString(v.trace));for(let g of E)g.initialize(v.capabilities);if(N){let g=N(v,new w.CancellationTokenSource().token,j.attachWorkDone(r,v),void 0);return C(g).then(R=>{if(R instanceof w.ResponseError)return R;let I=R;I||(I={capabilities:{}});let U=I.capabilities;U||(U={},I.capabilities=U),U.textDocumentSync===void 0||U.textDocumentSync===null?U.textDocumentSync=Re.number(B.__textDocumentSync)?B.__textDocumentSync:w.TextDocumentSyncKind.None:!Re.number(U.textDocumentSync)&&!Re.number(U.textDocumentSync.change)&&(U.textDocumentSync.change=Re.number(B.__textDocumentSync)?B.__textDocumentSync:w.TextDocumentSyncKind.None);for(let be of E)be.fillServerCapabilities(U);return I})}else{let g={capabilities:{textDocumentSync:w.TextDocumentSyncKind.None}};for(let R of E)R.fillServerCapabilities(g.capabilities);return g}}),r.onRequest(w.ShutdownRequest.type,()=>{if(e.shutdownReceived=!0,D)return D(new w.CancellationTokenSource().token)}),r.onNotification(w.ExitNotification.type,()=>{try{$&&$()}finally{e.shutdownReceived?e.exit(0):e.exit(1)}}),r.onNotification(w.SetTraceNotification.type,v=>{s.trace=w.Trace.fromString(v.value)}),B}z.createConnection=mh});var ua=L(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.resolveModulePath=me.FileSystem=me.resolveGlobalYarnPath=me.resolveGlobalNodePath=me.resolve=me.uriToFilePath=void 0;var gh=require("url"),Le=require("path"),pr=require("fs"),mr=require("child_process");function bh(n){let e=gh.parse(n);if(e.protocol!=="file:"||!e.path)return;let t=e.path.split("/");for(var i=0,r=t.length;i<r;i++)t[i]=decodeURIComponent(t[i]);if(process.platform==="win32"&&t.length>1){let s=t[0],c=t[1];s.length===0&&c.length>1&&c[1]===":"&&t.shift()}return Le.normalize(t.join("/"))}me.uriToFilePath=bh;function gr(){return process.platform==="win32"}function Wn(n,e,t,i){let r="NODE_PATH",s=["var p = process;","p.on('message',function(m){","if(m.c==='e'){","p.exit(0);","}","else if(m.c==='rs'){","try{","var r=require.resolve(m.a);","p.send({c:'r',s:true,r:r});","}","catch(err){","p.send({c:'r',s:false});","}","}","});"].join("");return new Promise((c,y)=>{let b=process.env,x=Object.create(null);Object.keys(b).forEach(k=>x[k]=b[k]),e&&pr.existsSync(e)&&(x[r]?x[r]=e+Le.delimiter+x[r]:x[r]=e,i&&i(`NODE_PATH value is: ${x[r]}`)),x.ELECTRON_RUN_AS_NODE="1";try{let k=mr.fork("",[],{cwd:t,env:x,execArgv:["-e",s]});if(k.pid===void 0){y(new Error(`Starting process to resolve node module  ${n} failed`));return}k.on("error",C=>{y(C)}),k.on("message",C=>{C.c==="r"&&(k.send({c:"e"}),C.s?c(C.r):y(new Error(`Failed to resolve module: ${n}`)))});let E={c:"rs",a:n};k.send(E)}catch(k){y(k)}})}me.resolve=Wn;function br(n){let e="npm",t=Object.create(null);Object.keys(process.env).forEach(s=>t[s]=process.env[s]),t.NO_UPDATE_NOTIFIER="true";let i={encoding:"utf8",env:t};gr()&&(e="npm.cmd",i.shell=!0);let r=()=>{};try{process.on("SIGPIPE",r);let s=mr.spawnSync(e,["config","get","prefix"],i).stdout;if(!s){n&&n("'npm config get prefix' didn't return a value.");return}let c=s.trim();return n&&n(`'npm config get prefix' value is: ${c}`),c.length>0?gr()?Le.join(c,"node_modules"):Le.join(c,"lib","node_modules"):void 0}catch{return}finally{process.removeListener("SIGPIPE",r)}}me.resolveGlobalNodePath=br;function yh(n){let e="yarn",t={encoding:"utf8"};gr()&&(e="yarn.cmd",t.shell=!0);let i=()=>{};try{process.on("SIGPIPE",i);let r=mr.spawnSync(e,["global","dir","--json"],t),s=r.stdout;if(!s){n&&(n("'yarn global dir' didn't return a value."),r.stderr&&n(r.stderr));return}let c=s.trim().split(/\r?\n/);for(let y of c)try{let b=JSON.parse(y);if(b.type==="log")return Le.join(b.data,"node_modules")}catch{}return}catch{return}finally{process.removeListener("SIGPIPE",i)}}me.resolveGlobalYarnPath=yh;var la;(function(n){let e;function t(){return e!==void 0||(process.platform==="win32"?e=!1:e=!pr.existsSync(__filename.toUpperCase())||!pr.existsSync(__filename.toLowerCase())),e}n.isCaseSensitive=t;function i(r,s){return t()?Le.normalize(s).indexOf(Le.normalize(r))===0:Le.normalize(s).toLowerCase().indexOf(Le.normalize(r).toLowerCase())===0}n.isParent=i})(la=me.FileSystem||(me.FileSystem={}));function vh(n,e,t,i){return t?(Le.isAbsolute(t)||(t=Le.join(n,t)),Wn(e,t,t,i).then(r=>la.isParent(t,r)?r:Promise.reject(new Error(`Failed to load ${e} from node path location.`))).then(void 0,r=>Wn(e,br(i),n,i))):Wn(e,br(i),n,i)}me.resolveModulePath=vh});var yr=L((cp,da)=>{"use strict";da.exports=ye()});var fa=L(ve=>{"use strict";var Sh=ve&&ve.__createBinding||(Object.create?function(n,e,t,i){i===void 0&&(i=t),Object.defineProperty(n,i,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,i){i===void 0&&(i=t),n[i]=e[t]}),ha=ve&&ve.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Sh(e,n,t)};Object.defineProperty(ve,"__esModule",{value:!0});ve.ProposedFeatures=ve.SemanticTokensBuilder=void 0;var xh=rr();Object.defineProperty(ve,"SemanticTokensBuilder",{enumerable:!0,get:function(){return xh.SemanticTokensBuilder}});ha(ye(),ve);ha(fr(),ve);var kh;(function(n){n.all={__brand:"features"}})(kh=ve.ProposedFeatures||(ve.ProposedFeatures={}))});var ba=L(Se=>{"use strict";var Th=Se&&Se.__createBinding||(Object.create?function(n,e,t,i){i===void 0&&(i=t),Object.defineProperty(n,i,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,i){i===void 0&&(i=t),n[i]=e[t]}),pa=Se&&Se.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Th(e,n,t)};Object.defineProperty(Se,"__esModule",{value:!0});Se.createConnection=Se.Files=void 0;var vr=yn(),Rh=fr(),en=ua(),pt=yr();pa(yr(),Se);pa(fa(),Se);var wh;(function(n){n.uriToFilePath=en.uriToFilePath,n.resolveGlobalNodePath=en.resolveGlobalNodePath,n.resolveGlobalYarnPath=en.resolveGlobalYarnPath,n.resolve=en.resolve,n.resolveModulePath=en.resolveModulePath})(wh=Se.Files||(Se.Files={}));var ma;function Bn(){if(ma!==void 0)try{ma.end()}catch{}}var Ft=!1,ga;function Ch(){let n="--clientProcessId";function e(t){try{let i=parseInt(t);isNaN(i)||(ga=setInterval(()=>{try{process.kill(i,0)}catch{Bn(),process.exit(Ft?0:1)}},3e3))}catch{}}for(let t=2;t<process.argv.length;t++){let i=process.argv[t];if(i===n&&t+1<process.argv.length){e(process.argv[t+1]);return}else{let r=i.split("=");r[0]===n&&e(r[1])}}}Ch();var Eh={initialize:n=>{let e=n.processId;vr.number(e)&&ga===void 0&&setInterval(()=>{try{process.kill(e,0)}catch{process.exit(Ft?0:1)}},3e3)},get shutdownReceived(){return Ft},set shutdownReceived(n){Ft=n},exit:n=>{Bn(),process.exit(n)}};function _h(n,e,t,i){let r,s,c,y;return n!==void 0&&n.__brand==="features"&&(r=n,n=e,e=t,t=i),pt.ConnectionStrategy.is(n)||pt.ConnectionOptions.is(n)?y=n:(s=n,c=e,y=t),Dh(s,c,y,r)}Se.createConnection=_h;function Dh(n,e,t,i){if(!n&&!e&&process.argv.length>2){let y,b,x=process.argv.slice(2);for(let k=0;k<x.length;k++){let E=x[k];if(E==="--node-ipc"){n=new pt.IPCMessageReader(process),e=new pt.IPCMessageWriter(process);break}else if(E==="--stdio"){n=process.stdin,e=process.stdout;break}else if(E==="--socket"){y=parseInt(x[k+1]);break}else if(E==="--pipe"){b=x[k+1];break}else{var r=E.split("=");if(r[0]==="--socket"){y=parseInt(r[1]);break}else if(r[0]==="--pipe"){b=r[1];break}}}if(y){let k=pt.createServerSocketTransport(y);n=k[0],e=k[1]}else if(b){let k=pt.createServerPipeTransport(b);n=k[0],e=k[1]}}var s="Use arguments of createConnection or set command line parameters: '--node-ipc', '--stdio' or '--socket={number}'";if(!n)throw new Error("Connection input stream is not set. "+s);if(!e)throw new Error("Connection output stream is not set. "+s);if(vr.func(n.read)&&vr.func(n.on)){let y=n;y.on("end",()=>{Bn(),process.exit(Ft?0:1)}),y.on("close",()=>{Bn(),process.exit(Ft?0:1)})}let c=y=>pt.createProtocolConnection(n,e,y,t);return Rh.createConnection(c,Eh,i)}});var va=L((dp,ya)=>{"use strict";ya.exports=ba()});var xa=L((Sa,Un)=>{(function(n){if(typeof Un=="object"&&typeof Un.exports=="object"){var e=n(require,Sa);e!==void 0&&(Un.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],n)})(function(n,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=void 0;class t{constructor(x,k,E,C){this._uri=x,this._languageId=k,this._version=E,this._content=C,this._lineOffsets=void 0}get uri(){return this._uri}get languageId(){return this._languageId}get version(){return this._version}getText(x){if(x){let k=this.offsetAt(x.start),E=this.offsetAt(x.end);return this._content.substring(k,E)}return this._content}update(x,k){for(let E of x)if(t.isIncremental(E)){let C=c(E.range),D=this.offsetAt(C.start),N=this.offsetAt(C.end);this._content=this._content.substring(0,D)+E.text+this._content.substring(N,this._content.length);let $=Math.max(C.start.line,0),B=Math.max(C.end.line,0),v=this._lineOffsets,g=s(E.text,!1,D);if(B-$===g.length)for(let I=0,U=g.length;I<U;I++)v[I+$+1]=g[I];else g.length<1e4?v.splice($+1,B-$,...g):this._lineOffsets=v=v.slice(0,$+1).concat(g,v.slice(B+1));let R=E.text.length-(N-D);if(R!==0)for(let I=$+1+g.length,U=v.length;I<U;I++)v[I]=v[I]+R}else if(t.isFull(E))this._content=E.text,this._lineOffsets=void 0;else throw new Error("Unknown change event received");this._version=k}getLineOffsets(){return this._lineOffsets===void 0&&(this._lineOffsets=s(this._content,!0)),this._lineOffsets}positionAt(x){x=Math.max(Math.min(x,this._content.length),0);let k=this.getLineOffsets(),E=0,C=k.length;if(C===0)return{line:0,character:x};for(;E<C;){let N=Math.floor((E+C)/2);k[N]>x?C=N:E=N+1}let D=E-1;return{line:D,character:x-k[D]}}offsetAt(x){let k=this.getLineOffsets();if(x.line>=k.length)return this._content.length;if(x.line<0)return 0;let E=k[x.line],C=x.line+1<k.length?k[x.line+1]:this._content.length;return Math.max(Math.min(E+x.character,C),E)}get lineCount(){return this.getLineOffsets().length}static isIncremental(x){let k=x;return k!=null&&typeof k.text=="string"&&k.range!==void 0&&(k.rangeLength===void 0||typeof k.rangeLength=="number")}static isFull(x){let k=x;return k!=null&&typeof k.text=="string"&&k.range===void 0&&k.rangeLength===void 0}}var i;(function(b){function x(C,D,N,$){return new t(C,D,N,$)}b.create=x;function k(C,D,N){if(C instanceof t)return C.update(D,N),C;throw new Error("TextDocument.update: document must be created by TextDocument.create")}b.update=k;function E(C,D){let N=C.getText(),$=r(D.map(y),(g,R)=>{let I=g.range.start.line-R.range.start.line;return I===0?g.range.start.character-R.range.start.character:I}),B=0,v=[];for(let g of $){let R=C.offsetAt(g.range.start);if(R<B)throw new Error("Overlapping edit");R>B&&v.push(N.substring(B,R)),g.newText.length&&v.push(g.newText),B=C.offsetAt(g.range.end)}return v.push(N.substr(B)),v.join("")}b.applyEdits=E})(i=e.TextDocument||(e.TextDocument={}));function r(b,x){if(b.length<=1)return b;let k=b.length/2|0,E=b.slice(0,k),C=b.slice(k);r(E,x),r(C,x);let D=0,N=0,$=0;for(;D<E.length&&N<C.length;)x(E[D],C[N])<=0?b[$++]=E[D++]:b[$++]=C[N++];for(;D<E.length;)b[$++]=E[D++];for(;N<C.length;)b[$++]=C[N++];return b}function s(b,x,k=0){let E=x?[k]:[];for(let C=0;C<b.length;C++){let D=b.charCodeAt(C);(D===13||D===10)&&(D===13&&C+1<b.length&&b.charCodeAt(C+1)===10&&C++,E.push(k+C+1))}return E}function c(b){let x=b.start,k=b.end;return x.line>k.line||x.line===k.line&&x.character>k.character?{start:k,end:x}:b}function y(b){let x=c(b.range);return x!==b.range?{newText:b.newText,range:x}:b}})});var J=Ce(va()),Ar=Ce(xa());var Sr=Ce(require("path"));function ka(n,e){return n.line===e.line&&n.column===e.column&&n.index===e.index&&n.filename.equals(e.filename)}function Ta(n){return`${Sr.basename(n.filename.path)} ${n.line}:${n.column}`}function xr(n,e){let t=n.start,i=n.end,r=e.start,s=e.end;return i.index<r.index?-1:s.index<t.index?1:0}function tn(n,e){return n&&e&&ka(n.start,e.start)&&ka(n.end,e.end)}function kr(n){if(n.start.filename.path!==n.end.filename.path)return`${Ta(n.start)} to ${Ta(n.end)} % ${n.start.index}-${n.end.index}`;let e=Sr.basename(n.start.filename.path);return n.start.line!==n.end.line?`${e} ${n.start.line}:${n.start.column} to ${n.end.line}:${n.end.column} % ${n.start.index}-${n.end.index}`:`${e} ${n.start.line}:${n.start.column}-${n.end.column} % ${n.start.index}-${n.end.index}`}function Tr(n){let e=n.end.line-n.start.line;return n.end.column-n.start.column+1e4*e}function Rr(n){return{start:{line:n.start.line,column:n.start.column,index:n.start.index,filename:n.start.filename},end:{line:n.end.line,column:n.end.column,index:n.end.index,filename:n.end.filename}}}var q=class{static block(e){return{type:"Block",body:e}}static labelStatement(e){return{type:"LabelStatement",label:e}}static breakStatement(){return{type:"BreakStatement"}}static gotoStatement(e){return{type:"GotoStatement",label:e}}static returnStatement(e){return{type:"ReturnStatement",arguments:e}}static ifStatement(e,t){return{type:"IfStatement",clauses:e,oneLine:t}}static ifClause(e,t){return{type:"IfClause",condition:e,block:t}}static elseifClause(e,t){return{type:"ElseifClause",condition:e,block:t}}static elseClause(e){return{type:"ElseClause",block:e}}static whileStatement(e,t){return{type:"WhileStatement",condition:e,block:t}}static doStatement(e){return{type:"DoStatement",block:e}}static repeatStatement(e,t){return{type:"RepeatStatement",condition:e,block:t}}static localStatement(e,t,i){return{type:"LocalStatement",variables:e,operator:t,init:i}}static assignmentStatement(e,t,i){return{type:"AssignmentStatement",variables:e,operator:t,init:i}}static callStatement(e){return{type:"CallStatement",expression:e}}static functionStatement(e,t,i,r){return{type:"FunctionDeclaration",identifier:e,isLocal:i,parameters:t,block:r}}static forNumericStatement(e,t,i,r,s){return{type:"ForNumericStatement",variable:e,start:t,end:i,step:r,block:s}}static forGenericStatement(e,t,i){return{type:"ForGenericStatement",variables:e,iterators:t,block:i}}static chunk(e,t){return{type:"Chunk",block:e,errors:t,symbols:[]}}static identifier(e){return{type:"Identifier",name:e}}static literal(e,t,i){switch(e){case"StringLiteral":return{type:"StringLiteral",value:t,raw:i};case"NumericLiteral":return{type:"NumericLiteral",value:t,raw:i};case"BooleanLiteral":return{type:"BooleanLiteral",value:t};case"NilLiteral":return{type:"NilLiteral"};default:return{type:"VarargLiteral",value:t,raw:i}}}static tableKey(e,t){return{type:"TableKey",key:e,value:t}}static tableKeyString(e,t){return{type:"TableKeyString",key:e,value:t}}static tableValue(e){return{type:"TableValue",value:e}}static tableConstructorExpression(e){return{type:"TableConstructorExpression",fields:e}}static binaryExpression(e,t,i){return e==="and"||e==="or"?{type:"LogicalExpression",operator:e,left:t,right:i}:{type:"BinaryExpression",operator:e,left:t,right:i}}static unaryExpression(e,t){return{type:"UnaryExpression",operator:e,argument:t}}static memberExpression(e,t,i){return{type:"MemberExpression",indexer:t,identifier:i,base:e}}static indexExpression(e,t){return{type:"IndexExpression",base:e,index:t}}static callExpression(e,t){return{type:"CallExpression",base:e,arguments:t}}static tableCallExpression(e,t){return{type:"TableCallExpression",base:e,arguments:t}}static stringCallExpression(e,t){return{type:"StringCallExpression",base:e,argument:t}}static comment(e,t){return{type:"Comment",value:e,raw:t}}};function Ra(n,e,t){for(let i=0,r=n.length;i<r;++i)if(n[i][e]===t)return i;return-1}function Gn(n,...e){return n=n.replace(/%(\d)/g,function(t,i){return""+e[i-1]||""}),n}var V=Object.freeze({unexpected:"unexpected %1 '%2' near '%3'",unexpectedEOF:"unexpected symbol near '<eof>'",expected:"'%1' expected near '%2'",expectedToken:"%1 expected near '%2'",unfinishedString:"unfinished string near '%1'",malformedNumber:"malformed number near '%1'",decimalEscapeTooLarge:"decimal escape too large near '%1'",invalidEscape:"invalid escape sequence near '%1'",hexadecimalDigitExpected:"hexadecimal digit expected near '%1'",braceExpected:"missing '%1' near '%2'",tooLargeCodepoint:"UTF-8 value too large near '%1'",unfinishedLongString:"unfinished long string (starting at line %1) near '%2'",unfinishedLongComment:"unfinished long comment (starting at line %1) near '%2'",ambiguousSyntax:"ambiguous syntax (function call x new statement) near '%1'",noLoopToBreak:"no loop to break near '%1'",labelAlreadyDefined:"label '%1' already defined on line %2",labelNotVisible:"no visible label '%1' for <goto>",gotoJumpInLocalScope:"<goto %1> jumps into the scope of local '%2'",cannotUseVararg:"cannot use '...' outside a Vararg function near '%1'",invalidCodeUnit:"code unit U+%1 is not allowed in the current encoding mode",undefinedVariable:"undefined variable: %1",unusedLocal:"%1 is defined but not used"}),nn=class extends Error{constructor(e,t){super();this.type="ParseError";this.message=e,this.bounds=t}},wa=class{constructor(e,t){this.type="Warning";this.message=e,this.bounds=t}};function $n(n){return!!n&&typeof n=="object"&&n.type==="ParseError"}function Wh(n,e,...t){let i=Gn(e,...t);return new nn(i,n)}function Ca(n,e,...t){let i=Gn(e,...t);return new wa(i,n)}function Hn(n,e,...t){throw Wh(n,e,...t)}function et(n,e,...t){return new nn(Gn(e,...t),n.bounds)}function he(n,e,...t){throw et(n,e,...t)}function we(n,e){he(e,V.expectedToken,n,e.value)}var Vn=class{constructor(){this.allowVararg=!1,this.scopes=[],this.pendingGotos=[]}isInLoop(){let e=this.scopes.length;for(;e-- >0;)if(this.scopes[e].isLoop)return!0;return!1}currentScope(){return this.scopes[this.scopes.length-1]}pushScope(e){let t={labels:{},locals:[],deferredGotos:[],isLoop:!!e};this.scopes.push(t)}popScope(){for(let e=0;e<this.pendingGotos.length;++e){let t=this.pendingGotos[e];t.maxDepth>=this.scopes.length&&--t.maxDepth<=0&&he(t.token,V.labelNotVisible,t.target)}this.scopes.pop()}addGoto(e,t){let i=[];for(let r=0;r<this.scopes.length;++r){let s=this.scopes[r];if(i.push(s.locals.length),Object.prototype.hasOwnProperty.call(s.labels,e))return}this.pendingGotos.push({maxDepth:this.scopes.length,target:e,token:t,localCounts:i})}addLabel(e,t){let i=this.currentScope();if(Object.prototype.hasOwnProperty.call(i.labels,e))he(t,V.labelAlreadyDefined,e,i.labels[e].line);else{let r=[];for(let s=0;s<this.pendingGotos.length;++s){let c=this.pendingGotos[s];if(c.maxDepth>=this.scopes.length&&c.target===e){c.localCounts[this.scopes.length-1]<i.locals.length&&i.deferredGotos.push(c);continue}r.push(c)}this.pendingGotos=r}i.labels[e]={localCount:i.locals.length,line:t.bounds.start.line}}addLocal(e,t){this.currentScope().locals.push({name:e,token:t})}raiseDeferredErrors(){let e=this.currentScope(),t=e.deferredGotos;for(let i=0;i<t.length;++i){let r=t[i];he(r.token,V.gotoJumpInLocalScope,r.target,e.locals[r.localCounts[this.scopes.length-1]].name)}}};var It=Ce(require("fs")),qt=Ce(require("path")),zn=Ce(require("url")),$e=class{constructor(e,t){this.path=e,this.fileURL=t}static fromFileURL(e){return new $e(Bh(e),e)}static fromPath(e){return new $e(e,Cr(e))}equals(e){return this.path===e.path&&this.fileURL===e.fileURL}toString(){return`ResolvedFile(path=${this.path},fileURL=${this.fileURL})`}};function Bh(n){return zn.fileURLToPath(n)}function Cr(n){let e=zn.pathToFileURL(n).toString(),t=/^file:\/\/\/(\w):\/(.*)$/.exec(e);if(t){let i=t[1],r=t[2];e=`file:///${i}%3A/${r}`}return e}function Ea(n,e){let t=qt.dirname(n.path),i=qt.normalize(qt.join(t,e));return $e.fromPath(i)}var Er=class{doesFileExist(e){return It.existsSync(e)}isFile(e){return It.lstatSync(e).isFile()}loadFileContents(e){return It.readFileSync(e).toString()}};function _a(n,e){return e=e||0,n<128?String.fromCharCode(n):n<2048?String.fromCharCode(e|192|n>>6,e|128|n&63):n<65536?String.fromCharCode(e|224|n>>12,e|128|n>>6&63,e|128|n&63):n<1114112?String.fromCharCode(e|240|n>>18,e|128|n>>12&63,e|128|n>>6&63,e|128|n&63):null}function Uh(n,e){let t=n.toString(16);for(;t.length<e;)t="0"+t;return t}function Gh(n,e,t){let i=t.exec(e);if(!i)return e;Hn({start:n,end:n},V.invalidCodeUnit,Uh(i[0].charCodeAt(0),4).toUpperCase())}var Da=class{constructor(){this.discardStrings=!1}fixup(e,t){return Gh(e,t,/[^\x00-\xff]/)}encodeByte(e){return e===null?"":String.fromCharCode(e)}encodeUTF8(e){return _a(e)}},Pa=class{constructor(){this.discardStrings=!1}fixup(e,t){return t}encodeByte(e){return e===null?"":e>=128?String.fromCharCode(e|63232):String.fromCharCode(e)}encodeUTF8(e){return _a(e,63232)}},Na=class{constructor(){this.discardStrings=!0}fixup(e){return e}encodeByte(e){return""}encodeUTF8(e){return""}};var La={"pseudo-latin1":new Da,"x-user-defined":new Pa,none:new Na};var rn=class{constructor(e,t){this.charCode=0;this.peekCharCodeindex=0;this.index=0;this.line=1;this.lineStart=0;this.tokenStart=0;this.tokenStartLine=0;this.tokenStartLineIdx=0;this.comments=[];this.fullP8File=!1;this.reachedEnd=!1;this.input="";this.length=0;this.encodingMode=La["x-user-defined"];this.newlineSignificant=!1;this.input=e,this.length=this.input.length,this.filename=t,this.skipHeader()}skipHeader(){if(this.input.startsWith("pico-8 cartridge")){for(this.fullP8File=!0;this.index<this.length&&this.currentLine()!=="__lua__";)this.skipLine();this.skipLine()}}currentLine(){let e=this.lineStart;for(;e<this.length&&this.input.charCodeAt(e)!=10&&this.input.charCodeAt(e)!=13;)e++;return this.input.substring(this.lineStart,e)}skipLine(){for(;this.index<this.length;){let e=this.input.charCodeAt(this.index);if(He(e)){this.consumeEOL();break}else this.index++}}withSignificantNewline(e){let t=(()=>{this.newlineSignificant=!1}).bind(this);this.newlineSignificant=!0;try{e(t)}finally{this.token.type==="Newline"&&this.next(),this.newlineSignificant=!1}}unexpectedToken(e){let t=this.lookahead.value,i;switch(e.type){case"StringLiteral":i="string";break;case"Keyword":i="keyword";break;case"Identifier":i="identifier";break;case"NumericLiteral":i="number";break;case"Punctuator":i="symbol";break;case"BooleanLiteral":i="boolean";break;case"NilLiteral":he(e,V.unexpected,"symbol","nil",t);break;case"EOF":he(e,V.unexpectedEOF);break}he(e,V.unexpected,i,e.value,t)}unexpectedString(e){var i;let t=(i=this.lookahead)==null?void 0:i.value;this.raiseErr(V.unexpected,"symbol",e,t)}raiseErr(e,...t){Hn(this.getCurrentBounds(),e,...t)}getLocation(){return{index:this.index,line:this.line,column:this.index-this.lineStart+1,filename:this.filename}}getCurrentBounds(){return{start:{index:this.tokenStart,line:this.tokenStartLine,column:this.tokenStart-this.tokenStartLineIdx,filename:this.filename},end:{index:this.index,line:this.line,column:this.index-this.lineStart,filename:this.filename}}}makeToken(e,t){return{type:e,value:t,bounds:this.getCurrentBounds()}}lex(){if(this.reachedEnd)return this.makeToken("EOF","<eof>");for(this.skipWhiteSpace();this.input.charCodeAt(this.index)===45&&this.input.charCodeAt(this.index+1)===45||this.input.charCodeAt(this.index)===47&&this.input.charCodeAt(this.index+1)===47;){let i=this.input.charCodeAt(this.index)===45;this.scanComment(i),this.skipWhiteSpace()}if(this.index>=this.length)return this.makeToken("EOF","<eof>");let e=this.input.charCodeAt(this.index),t=this.input.charCodeAt(this.index+1);if(this.tokenStart=this.index,this.tokenStartLine=this.line,this.tokenStartLineIdx=this.lineStart,Vh(e))return this.scanIdentifierOrKeyword();switch(e){case 39:case 34:return this.scanStringLiteral();case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.scanNumericLiteral();case 46:if(sn(t))return this.scanNumericLiteral();if(t===46){let i=this.input.charCodeAt(this.index+2);return i===61?this.scanPunctuator("..="):i===46?this.scanVarargLiteral():this.scanPunctuator("..")}return this.scanPunctuator(".");case 61:return t===61?this.scanPunctuator("=="):this.scanPunctuator("=");case 62:if(t===62){let i=this.input.charCodeAt(this.index+2);if(i===61)return this.scanPunctuator(">>=");if(i===62)return this.input.charCodeAt(this.index+3)===61?this.scanPunctuator(">>>="):this.scanPunctuator(">>>");if(i===60)return this.input.charCodeAt(this.index+3)===61?this.scanPunctuator(">><="):this.scanPunctuator(">><");if(t===62)return this.scanPunctuator(">>")}return t===61?this.scanPunctuator(">="):this.scanPunctuator(">");case 60:if(t===60){let i=this.input.charCodeAt(this.index+2);return i===61?this.scanPunctuator("<<="):i===62?this.input.charCodeAt(this.index+3)===61?this.scanPunctuator("<<>="):this.scanPunctuator("<<>"):this.scanPunctuator("<<")}return t===61?this.scanPunctuator("<="):this.scanPunctuator("<");case 126:return t===61?this.scanPunctuator("~="):this.scanPunctuator("~");case 58:return t===58?this.scanPunctuator("::"):this.scanPunctuator(":");case 91:return t===91||t===61?this.scanLongStringLiteral():this.scanPunctuator("[");case 94:return t===61?this.scanPunctuator("^="):t===94?this.input.charCodeAt(this.index+2)===61?this.scanPunctuator("^^="):this.scanPunctuator("^^"):this.scanPunctuator("^");case 33:return this.scanPunctuator("!=");case 37:case 38:case 42:case 43:case 45:case 47:case 92:case 124:return t===61?this.scanPunctuator(this.input.charAt(this.index)+"="):this.scanPunctuator(this.input.charAt(this.index));case 35:case 36:case 40:case 41:case 44:case 59:case 63:case 64:case 93:case 123:case 125:return this.scanPunctuator(this.input.charAt(this.index))}this.unexpectedString(this.input.charAt(this.index))}consumeEOL(){let e=this.input.charCodeAt(this.index),t=this.input.charCodeAt(this.index+1);if(He(e)){let i=1;return e===10&&t===13&&(this.peekCharCodeindex++,i=2),e===13&&t===10&&(this.peekCharCodeindex++,i=2),this.index+=i,this.line++,this.lineStart=this.index,!0}return!1}skipWhiteSpace(){for(;this.index<this.length;){let e=this.input.charCodeAt(this.index);if(Hh(e))this.index++;else if(!this.consumeEOL())break}}scanIdentifierOrKeyword(){let e,t;for(;an(this.input.charCodeAt(this.index));)this.index++;return e=this.encodingMode.fixup(this.getLocation(),this.input.slice(this.tokenStart,this.index)),zh(e)?t="Keyword":e==="true"||e==="false"?(t="BooleanLiteral",e=e==="true"):e==="nil"?(t="NilLiteral",e=null):_r(e)&&this.lineStart===this.tokenStart&&He(this.input.charCodeAt(this.index))?(this.reachedEnd=!0,t="EOF"):t="Identifier",this.makeToken(t,e)}scanPunctuator(e){return this.index+=e.length,this.makeToken("Punctuator",e)}scanVarargLiteral(){return this.index+=3,this.makeToken("VarargLiteral","...")}scanStringLiteral(){let e=this.input.charCodeAt(this.index++),t=this.index,i=this.encodingMode.discardStrings?null:"";for(;this.charCode=this.input.charCodeAt(this.index++),e!==this.charCode;)if((this.index>this.length||He(this.charCode))&&(i+=this.input.slice(t,this.index-1),He(this.charCode)&&this.consumeEOL(),this.raiseErr(V.unfinishedString,this.input.slice(this.tokenStart,this.index-1))),this.charCode===92){if(!this.encodingMode.discardStrings){let s=this.input.slice(t,this.index-1);i+=this.encodingMode.fixup(this.getLocation(),s)}let r=this.readEscapeSequence();this.encodingMode.discardStrings||(i+=r),t=this.index}return this.encodingMode.discardStrings||(i+=this.encodingMode.encodeByte(null),i+=this.encodingMode.fixup(this.getLocation(),this.input.slice(t,this.index-1))),this.makeToken("StringLiteral",i)}scanLongStringLiteral(){let e=this.readLongString(!1);return e===!1&&he(this.token,V.expected,"[",this.token.value),this.makeToken("StringLiteral",this.encodingMode.discardStrings?null:this.encodingMode.fixup(this.getLocation(),e))}scanNumericLiteral(){let e=this.input.charAt(this.index),t=this.input.charAt(this.index+1),i;return e==="0"&&(["x","X"].includes(t)?i=this.readHexLiteral():["b","B"].includes(t)&&(i=this.readBinaryLiteral())),i===void 0&&(i=this.readDecLiteral()),this.makeToken("NumericLiteral",i.value)}readHexLiteral(){let e=0,t=1,i=1,r,s,c=this.index+=2,y,b=!1;if(this.input.charAt(this.index)!=="."){for(on(this.input.charCodeAt(this.index))||this.raiseErr(V.malformedNumber,this.input.slice(this.tokenStart,this.index));on(this.input.charCodeAt(this.index));)++this.index;y=parseInt(this.input.slice(c,this.index),16)}else y=0,b=!0;let x=!1;if(this.input.charAt(this.index)==="."){for(x=!0,r=++this.index;on(this.input.charCodeAt(this.index));)b=!1,++this.index;b&&this.raiseErr(V.malformedNumber,this.input.slice(this.tokenStart,this.index));let E=this.input.slice(r,this.index);e=r===this.index?0:parseInt(E,16)/Math.pow(16,this.index-r)}let k=!1;if(["p","P"].includes(this.input.charAt(this.index))){for(k=!0,++this.index,["+","-"].includes(this.input.charAt(this.index))&&(i=this.input.charAt(this.index++)==="+"?1:-1),s=this.index,sn(this.input.charCodeAt(this.index))||this.raiseErr(V.malformedNumber,this.input.slice(this.tokenStart,this.index));sn(this.input.charCodeAt(this.index));)++this.index;t=+this.input.slice(s,this.index),t=Math.pow(2,t*i)}return{value:(y+e)*t,hasFractionPart:x||k}}readDecLiteral(){for(;sn(this.input.charCodeAt(this.index));)++this.index;let e=!1;if(this.input.charAt(this.index)===".")for(e=!0,++this.index;sn(this.input.charCodeAt(this.index));)++this.index;return{value:parseFloat(this.input.slice(this.tokenStart,this.index)),hasFractionPart:e}}readBinaryLiteral(){for(this.index+=2;Fa(this.input.charCodeAt(this.index));)++this.index;let e=!1;if(this.input.charAt(this.index)===".")for(e=!0,++this.index;Fa(this.input.charCodeAt(this.index));)++this.index;return{value:parseFloat(this.input.slice(this.tokenStart,this.index)),hasFractionPart:e}}readEscapeSequence(){let e=this.index;switch(this.input.charAt(this.index)){case"n":return++this.index,`
`;case"r":return++this.index,"\r";case"t":return++this.index,"	";case"\r":case`
`:return this.consumeEOL(),`
`;case"z":return++this.index,this.skipWhiteSpace(),"";case"x":if(on(this.input.charCodeAt(this.index+1))&&on(this.input.charCodeAt(this.index+2)))return this.index+=3,this.encodingMode.encodeByte(parseInt(this.input.slice(e+1,this.index),16));this.raiseErr(V.hexadecimalDigitExpected,"\\"+this.input.slice(e,this.index+2));break;case"\\":case'"':case"'":return this.input.charAt(this.index++);case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"*":case"#":case"-":case"|":case"+":case"^":case"a":case"b":case"v":case"f":return this.input.charAt(this.index++)}this.raiseErr(V.invalidEscape,"\\"+this.input.slice(e,this.index+1))}scanComment(e){this.tokenStart=this.index,this.index+=2;let t=this.input.charAt(this.index),i=this.index,r=this.lineStart,s=this.line,c="",y=!1;if(e&&t==="["&&(c=this.readLongString(!0),c===!1?c=t:y=!0),!y){for(;this.index<this.length&&!He(this.input.charCodeAt(this.index));)++this.index;c=this.input.slice(i,this.index)}let b=q.comment(c,this.input.slice(this.tokenStart,this.index));b.loc={start:{index:this.tokenStart,line:s,column:this.tokenStart-r,filename:this.filename},end:{index:this.index,line:this.line,column:this.index-this.lineStart,filename:this.filename}},this.comments.push(b)}readLongString(e){let t=0,i="",r=!1,s,c=this.line;for(++this.index;this.input.charAt(this.index+t)==="=";)++t;if(this.input.charAt(this.index+t)!=="[")return!1;this.index+=t+1,He(this.input.charCodeAt(this.index))&&this.consumeEOL();let y=this.index;for(;this.index<this.length;){for(;He(this.input.charCodeAt(this.index));)this.consumeEOL();if(s=this.input.charAt(this.index++),s==="]"){r=!0;for(let x=0;x<t;++x)this.input.charAt(this.index+x)!=="="&&(r=!1);this.input.charAt(this.index+t)!=="]"&&(r=!1)}if(r)return i+=this.input.slice(y,this.index-1),this.index+=t+1,i}let b=e?V.unfinishedLongComment:V.unfinishedLongString;this.raiseErr(b,c,"<eof>")}next(){var e;this.previousToken=this.token,this.lookahead===void 0&&(this.lookahead=this.lex()),this.newlineSignificant&&((e=this.token)==null?void 0:e.bounds.start.line)!==this.lookahead.bounds.start.line?this.token=this.makeToken("Newline","\\n"):(this.token=this.lookahead,this.lookahead=this.lex())}consumeRestOfLine(e){this.previousToken=this.token,e===void 0?e=this.index:this.index=e;let t=this.input.charCodeAt(this.index);for(;this.index<this.length&&!He(t);)this.index++,t=this.input.charCodeAt(this.index);this.token=this.makeToken("Raw",this.input.slice(e,this.index)),this.lookahead=this.lex()}consume(e){var t;return e===((t=this.token)==null?void 0:t.value)?(this.next(),!0):!1}consumeTokenType(e){var t;return((t=this.token)==null?void 0:t.type)===e?(this.next(),!0):!1}expect(e){var t;e===((t=this.token)==null?void 0:t.value)?this.next():he(this.token,V.expected,e,this.token.value)}};function Hh(n){return n===9||n===32||n===11||n===12}function He(n){return n===10||n===13}function sn(n){return n>=48&&n<=57}function on(n){return n>=48&&n<=57||n>=97&&n<=102||n>=65&&n<=70}function Fa(n){return n===48||n===49}function Vh(n){return n>=65&&n<=90||n>=97&&n<=122||n===95||n>=128}function an(n){return n>=65&&n<=90||n>=97&&n<=122||n===95||n>=48&&n<=57||n>=128}function zh(n){switch(n.length){case 2:return n==="do"||n==="if"||n==="in"||n==="or";case 3:return n==="and"||n==="end"||n==="for"||n==="not";case 4:return n==="else"||n==="then"||n==="goto";case 5:return n==="break"||n==="local"||n==="until"||n==="while";case 6:return n==="elseif"||n==="repeat"||n==="return";case 8:return n==="function"}return!1}function Ia(n){return n==="__lua__"}function _r(n){return["__gfx__","__label__","__gff__","__map__","__sfx__","__music__"].includes(n)}var mt=class{constructor(e){e.type?this.loc=e.bounds:this.loc=e}complete(e){this.loc=Rr(this.loc),this.loc.end=e}bless(e){e.loc=this.loc}clone(){return new mt(Rr(this.loc))}};var Kh=Object.freeze(["TableKey","TableKeyString","TableValue"]);function Dr(n){return n&&Kh.includes(n.type)}function xe(n){let e;switch(n.base.type){case"Identifier":e=n.base.name;break;case"MemberExpression":let t=xe(n.base);if(t===void 0)return;e=t;break;default:return}return e+"."+n.identifier.name}function Pr(n){let e=xe(n);if(e){let t=e.split(/[.:]/);return t.length>1?t.slice(0,t.length-1).join("."):void 0}return e}function Nr(n){let e=n.base;for(;;)switch(e.type){case"Identifier":return e;case"MemberExpression":e=e.base;break;default:return}}var Lr="<anonymous function>";function qa(n){return n.identifier?n.identifier.type==="Identifier"?n.identifier.name:xe(n.identifier)||Lr:Lr}function Oa(n){return n.identifier?n.identifier.type==="Identifier"?n.identifier.name:n.identifier.identifier.name:Lr}function Fr(n){return!!n&&n.block!==void 0}function Aa(n){return!!n&&n.condition!==void 0}var gt=class{constructor(){this.scopeStack=[];this.nodeStack=[]}topScope(e){let t=1;return e&&(t+=e),this.scopeStack[this.scopeStack.length-t]}topNode(e){let t=1;return e&&(t+=e),this.nodeStack[this.nodeStack.length-t]}startingScope(){return this.createDefaultScope(null)}pushScope(e,t){this.scopeStack.push(e),this.onEnterScope(e,t)}popScope(){let e=this.scopeStack.pop();this.onExitScope(e)}onEnterScope(e,t){}onExitScope(e){}isInAssignment(){let e=this.topNode(),t=this.topNode(1);return e&&t&&((e.node.type==="Identifier"||e.node.type==="MemberExpression")&&(t.node.type==="AssignmentStatement"||t.node.type==="LocalStatement")||e.node.type==="TableKeyString"&&t.node.type==="TableConstructorExpression")}isInAssignmentTarget(){var t;let e=this.topNode();return!!((t=e==null?void 0:e.flags)==null?void 0:t.includes(0))}visitIfClause(e){return this.createDefaultScope(e)}visitElseifClause(e){return this.createDefaultScope(e)}visitElseClause(e){return this.createDefaultScope(e)}visitDoStatement(e){return this.createDefaultScope(e)}visitForGenericStatement(e){return this.createDefaultScope(e)}visitForNumericStatement(e){return this.createDefaultScope(e)}visitFunctionDeclaration(e){return this.createDefaultScope(e)}visitRepeatStatement(e){return this.createDefaultScope(e)}visitWhileStatement(e){return this.createDefaultScope(e)}visitTableConstructorExpression(e){return this.createDefaultScope(e)}visitAssignmentStatement(e){}visitBreakStatement(e){}visitCallStatement(e){}visitGotoStatement(e){}visitIfStatement(e){}visitLabelStatement(e){}visitLocalStatement(e){}visitReturnStatement(e){}visitIncludeStatement(e){}visitBinaryExpression(e){}visitBooleanLiteral(e){}visitCallExpression(e){}visitIdentifier(e){}visitIndexExpression(e){}visitLogicalExpression(e){}visitMemberExpression(e){}visitNilLiteral(e){}visitNumericLiteral(e){}visitStringCallExpression(e){}visitStringLiteral(e){}visitTableCallExpression(e){}visitTableKey(e){}visitTableKeyString(e){}visitTableValue(e){}visitUnaryExpression(e){}visitVarargLiteral(e){}visit(e){this.scopeStack.push(this.startingScope());for(let t of e.block.body)this.visitNode(t)}visitBlock(e){for(let t of e.body)this.visitNode(t)}visitAll(e){for(let t of e)this.visitNode(t)}visitNode(e){switch(e.type){case"AssignmentStatement":this.visitAssignmentStatement(e),this.nodeStack.push({node:e});for(let t=0;t<e.variables.length;t++)this.visitNode(e.variables[t]),this.nodeStack.push({node:e.variables[t],flags:[0]}),e.init[t]&&this.visitNode(e.init[t]),this.nodeStack.pop();this.nodeStack.pop();break;case"BreakStatement":this.visitBreakStatement(e);break;case"CallStatement":this.visitCallStatement(e),this.nodeStack.push({node:e}),e.expression&&this.visitNode(e.expression),this.nodeStack.pop();break;case"DoStatement":{let t=this.visitDoStatement(e);this.nodeStack.push({node:e}),this.pushScope(t,e),this.visitBlock(e.block),this.popScope(),this.nodeStack.pop();break}case"ForGenericStatement":{let t=this.visitForGenericStatement(e);this.nodeStack.push({node:e}),this.pushScope(t,e);for(let i=0;i<e.variables.length;i++)this.visitNode(e.variables[i]),e.iterators[i]&&this.visitNode(e.iterators[i]);this.visitBlock(e.block),this.popScope(),this.nodeStack.pop();break}case"ForNumericStatement":{let t=this.visitForNumericStatement(e);this.nodeStack.push({node:e}),this.pushScope(t,e),this.visitNode(e.variable),this.visitNode(e.start),this.visitNode(e.end),e.step&&this.visitNode(e.step),this.visitBlock(e.block),this.popScope(),this.nodeStack.pop();break}case"FunctionDeclaration":{let t=this.visitFunctionDeclaration(e);this.nodeStack.push({node:e}),e.identifier&&e.identifier.type==="MemberExpression"&&this.visitNode(e.identifier),this.pushScope(t,e),this.visitAll(e.parameters),this.visitBlock(e.block),this.popScope(),this.nodeStack.pop();break}case"GotoStatement":this.visitGotoStatement(e),this.nodeStack.push({node:e}),this.visitNode(e.label),this.nodeStack.pop();break;case"IfStatement":this.visitIfStatement(e),this.nodeStack.push({node:e}),this.visitAll(e.clauses),this.nodeStack.pop();break;case"IfClause":{let t=this.visitIfClause(e);this.nodeStack.push({node:e}),this.visitNode(e.condition),this.pushScope(t,e),this.visitBlock(e.block),this.popScope(),this.nodeStack.pop();break}case"ElseifClause":{let t=this.visitElseifClause(e);this.nodeStack.push({node:e}),this.visitNode(e.condition),this.pushScope(t,e),this.visitBlock(e.block),this.popScope(),this.nodeStack.pop();break}case"ElseClause":{let t=this.visitElseClause(e);this.nodeStack.push({node:e}),this.pushScope(t,e),this.visitBlock(e.block),this.popScope(),this.nodeStack.pop();break}case"LabelStatement":this.visitLabelStatement(e),this.nodeStack.push({node:e}),this.visitNode(e.label),this.nodeStack.pop();break;case"LocalStatement":this.visitLocalStatement(e),this.nodeStack.push({node:e});for(let t=0;t<e.variables.length;t++)this.visitNode(e.variables[t]),this.nodeStack.push({node:e.variables[t],flags:[0]}),e.init[t]&&this.visitNode(e.init[t]),this.nodeStack.pop();this.nodeStack.pop();break;case"RepeatStatement":{let t=this.visitRepeatStatement(e);this.nodeStack.push({node:e}),this.pushScope(t,e),this.visitBlock(e.block),this.popScope(),this.visitNode(e.condition),this.nodeStack.pop();break}case"ReturnStatement":this.visitReturnStatement(e),this.nodeStack.push({node:e}),this.visitAll(e.arguments),this.nodeStack.pop();break;case"WhileStatement":{let t=this.visitWhileStatement(e);this.nodeStack.push({node:e}),this.visitNode(e.condition),this.pushScope(t,e),this.visitBlock(e.block),this.popScope(),this.nodeStack.pop();break}case"IncludeStatement":this.visitIncludeStatement(e);break;case"BinaryExpression":this.visitBinaryExpression(e),this.nodeStack.push({node:e}),this.visitNode(e.left),this.visitNode(e.right),this.nodeStack.pop();break;case"BooleanLiteral":this.visitBooleanLiteral(e);break;case"CallExpression":this.visitCallExpression(e),this.nodeStack.push({node:e}),this.visitNode(e.base),this.visitAll(e.arguments),this.nodeStack.pop();break;case"Identifier":this.visitIdentifier(e);break;case"IndexExpression":this.visitIndexExpression(e),this.nodeStack.push({node:e}),this.visitNode(e.base),this.visitNode(e.index),this.nodeStack.pop();break;case"LogicalExpression":this.visitLogicalExpression(e),this.nodeStack.push({node:e}),this.visitNode(e.left),this.visitNode(e.right),this.nodeStack.pop();break;case"MemberExpression":this.visitMemberExpression(e),this.nodeStack.push({node:e}),this.visitNode(e.base),this.visitNode(e.identifier),this.nodeStack.pop();break;case"NilLiteral":this.visitNilLiteral(e);break;case"NumericLiteral":this.visitNumericLiteral(e);break;case"StringCallExpression":this.visitStringCallExpression(e),this.nodeStack.push({node:e}),this.visitNode(e.base),this.visitNode(e.argument),this.nodeStack.pop();break;case"StringLiteral":this.visitStringLiteral(e);break;case"TableCallExpression":this.visitTableCallExpression(e),this.nodeStack.push({node:e}),this.visitNode(e.base),this.visitNode(e.arguments),this.nodeStack.pop();break;case"TableConstructorExpression":{let t=this.visitTableConstructorExpression(e);this.nodeStack.push({node:e}),this.pushScope(t,e),this.visitAll(e.fields),this.popScope(),this.nodeStack.pop();break}case"TableKey":this.visitTableKey(e),this.nodeStack.push({node:e}),this.visitNode(e.key),this.visitNode(e.value),this.nodeStack.pop();break;case"TableKeyString":this.visitTableKeyString(e),this.nodeStack.push({node:e}),this.visitNode(e.value),this.nodeStack.pop();break;case"TableValue":this.visitTableValue(e),this.nodeStack.push({node:e}),this.visitNode(e.value),this.nodeStack.pop();break;case"UnaryExpression":this.visitUnaryExpression(e),this.nodeStack.push({node:e}),this.visitNode(e.argument),this.nodeStack.pop();break;case"VarargLiteral":this.visitVarargLiteral(e);break;default:throw new Error("Unexpected node type: "+e.type)}}};function Ma(n){return new ja(n).findSymbols()}var Ot=class{constructor(e,t){this.symbols=new Set;this.parent=e,this.self=t}},ja=class extends gt{constructor(e){super();this.symbols=[];this.chunk=e}findSymbols(){return this.visit(this.chunk),this.symbols}createDefaultScope(){return this.topScope()?new Ot(this.topScope().parent,this.topScope().self):new Ot(void 0,void 0)}isSymbolInLocalScope(e){for(let t=this.scopeStack.length-1;t>0;t--)if(this.scopeStack[t].symbols.has(e))return!0;return!1}addSymbol(e,t,i,r,s,c,y){if(!e)throw new Error("name cannot be falsey! "+JSON.stringify({detail:t,type:i,loc:r}));let b={name:e,detail:t,type:i,loc:r,selectionLoc:s,children:[]},x=y||this.getCurrentParent();return x&&c?x.children.push(b):this.symbols.push(b),c&&this.topScope().symbols.add(e),this.lastAddedSymbol=b,b}getCurrentParent(){return this.topScope().parent}visitFunctionDeclaration(e){return!e.identifier&&this.isInAssignment()?this.visitFunctionDeclarationWithoutIdentifier(e):this.visitFunctionDeclarationWithIdentifier(e)}visitFunctionDeclarationWithIdentifier(e){var r;let t;if(((r=e.identifier)==null?void 0:r.type)==="MemberExpression"&&e.identifier.indexer===":"){let s=e.identifier.base;if(s.type==="Identifier")t=s.name;else if(s.type==="MemberExpression")t=xe(s);else throw new Error("Unreachable")}let i=this.addSymbol(qa(e),this.getFunctionSignature(e),"Function",e.loc,e.identifier?e.identifier.loc:e.loc,this.getCurrentParent()!==void 0);return new Ot(i,t)}visitFunctionDeclarationWithoutIdentifier(e){var s;let t=this.lastAddedSymbol;t.detail=this.getFunctionSignature(e),t.type="Function";let i,r=t.name.split(/[.:]/);return r.length>1?i=r.slice(0,r.length-1).join("."):i=(s=this.topScope().parent)==null?void 0:s.name,new Ot(t,i)}getFunctionSignature(e){let t=e.parameters.map(i=>i.type==="Identifier"?i.name:"...").join(",");return t="("+t+")",t}visitIdentifier(e){this.topNode()&&this.topNode().node.type==="FunctionDeclaration"&&this.addSymbol(e.name,void 0,"LocalVariable",e.loc,e.loc,!0)}visitAssignmentStatement(e){this.findSymbolsInAssignment(e)}visitLocalStatement(e){this.findSymbolsInAssignment(e)}findSymbolsInAssignment(e){for(let t=0;t<e.variables.length;t++){let i=e.variables[t],r=e.init[t]&&e.init[t].type==="FunctionDeclaration";i.type==="Identifier"?this.addSymbolForSimpleAssignment(i,e,r):i.type==="MemberExpression"&&this.addSymbolForMemberExpressionAssignment(i,e,r)}}addSymbolForSimpleAssignment(e,t,i){let r=e.name,s=t.type==="LocalStatement"||this.isSymbolInLocalScope(r),c=s?"LocalVariable":"GlobalVariable";i&&(c="Function"),this.addSymbol(r,void 0,c,t.loc,e.loc,s)}addSymbolForMemberExpressionAssignment(e,t,i){let r,s=e.base;e:for(;;)switch(s.type){case"Identifier":r=s.name;break e;case"MemberExpression":s=s.base;break;default:return}let c=xe(e),y=this.topScope().self;r==="self"&&y&&(r=y,c=c.replace(/\bself\b/,y));let b=this.isSymbolInLocalScope(r),x=b?"LocalVariable":"GlobalVariable";i&&(x="Function"),this.addSymbol(c,void 0,x,t.loc,e.loc,b)}visitTableConstructorExpression(e){return this.isInAssignment()?new Ot(this.lastAddedSymbol,void 0):this.createDefaultScope()}visitTableKeyString(e){this.addSymbol(e.key.name,void 0,"LocalVariable",e.loc,e.loc,!0)}visitForGenericStatement(e){for(let t of e.variables)this.addSymbol(t.name,void 0,"LocalVariable",t.loc,t.loc,!0);return this.createDefaultScope()}visitForNumericStatement(e){return this.addSymbol(e.variable.name,void 0,"LocalVariable",e.variable.loc,e.variable.loc,!0),this.createDefaultScope()}visitLabelStatement(e){this.addSymbol(e.label.name,void 0,"Label",e.loc,e.loc,!0)}};var Wa=Ce(require("path"));var Kn=class{static binaryPrecedenceOf(e){let t=e.charCodeAt(0),i=e.length;if(i===1)switch(t){case 1:return Kn.maxPrecedenceValue;case 94:return 12;case 42:case 47:case 37:case 92:return 10;case 43:case 45:return 9;case 38:return 6;case 124:return 4;case 60:case 62:return 3}else if(i===2)switch(t){case 46:return 8;case 60:case 62:return e==="<<"||e===">>"?7:3;case 33:case 61:case 126:return 3;case 111:return 1;case 94:return 5}else if(i===3)switch(e){case">>>":case"<<>":case">><":return 7;case"and":return 2}return Kn.minPrecedenceValue}static doesNeedParenthesesIfOnTheRightSide(e){let t=e.charCodeAt(0),i=e.length;if(i===1)switch(t){case 42:return!1;case 43:return!1;case 38:return!1;case 124:return!1}else if(i===2)switch(t){case 46:return!1;case 61:return!1;case 111:return!1}else if(i===3)switch(e){case"and":return!1}return!0}},le=Kn;le.fakeMaxPrecedenceOperator="",le.maxPrecedenceValue=99,le.minPrecedenceValue=0;var Jn=class{constructor(e,t,i={}){this.locations=[];this.scopes=[[]];this.scopeDepth=0;this.globals=[];this.errors=[];this.includes=[];this.includeFileResolver=(i==null?void 0:i.includeFileResolver)||new Er,this.dontAddGlobalSymbols=!!(i==null?void 0:i.dontAddGlobalSymbols),this.lexerStack=[{lexer:new rn(t,e),includeStatement:null}]}isInIncludedFile(){return this.lexerStack.length>1}get lexer(){return this.lexerStack[this.lexerStack.length-1].lexer}get filename(){return this.lexer.filename}get token(){return this.lexer.token}get previousToken(){return this.lexer.previousToken}lexerNext(){this.lexer.next(),Xn(this.token)&&this.isInIncludedFile()&&this.lexerStack.pop()}parse(){return this.parseChunk()}finishNode(e,t){let i=this.popLocation(),r=t?this.token:this.previousToken;return t&&!r&&(r=this.previousToken),i&&r&&(i.complete(r.bounds.end),i.bless(e)),e.included=this.isInIncludedFile(),e}getUnexpectedTokenErr(e){let t=this.lexer.lookahead.value,i;switch(e.type){case"StringLiteral":i="string";break;case"Keyword":i="keyword";break;case"Identifier":i="identifier";break;case"NumericLiteral":i="number";break;case"Punctuator":i="symbol";break;case"BooleanLiteral":i="boolean";break;case"Newline":i="newline";break;case"NilLiteral":return et(e,V.unexpected,"symbol","nil",t);case"EOF":return et(e,V.unexpectedEOF)}return et(e,V.unexpected,i,e.value,t)}unexpectedToken(e){throw this.getUnexpectedTokenErr(e)}createLocationMarker(){return new mt(this.token)}markLocation(){this.locations.push(this.createLocationMarker())}pushLocation(e){this.locations.push(e.clone())}popLocation(){return this.locations.pop()}createScope(){let e=this.scopes[this.scopeDepth].slice();this.scopeDepth++,this.scopes.push(e)}destroyScope(){--this.scopeDepth}scopeIdentifierName(e){this.scopes[this.scopeDepth].indexOf(e)===-1&&this.scopes[this.scopeDepth].push(e)}scopeIdentifier(e){this.scopeIdentifierName(e.name),this.attachScope(e,!0)}attachScope(e,t){!t&&Ra(this.globals,"name",e.name)===-1&&this.globals.push(e),e.isLocal=t}scopeHasName(e){return this.scopes[this.scopeDepth].indexOf(e)!==-1}parseChunk(){this.lexerNext(),this.markLocation(),this.createScope();let e=new Vn;e.allowVararg=!0,e.pushScope();let t=this.parseBlock(e,!0);e.popScope(),this.destroyScope(),this.token.type!=="EOF"&&this.errors.push(this.getUnexpectedTokenErr(this.token));let i=this.finishNode(q.chunk(t,this.errors));return i.includes=this.includes,i.comments=this.lexer.comments,i.symbols=Ma(i),i}parseBlock(e,t){this.pushLocation(this.createLocationMarker());let i=[],r=t?Xn:Xh;for(;!r(this.token);){try{let s=this.parseStatement(e);if((s==null?void 0:s.type)==="IncludeStatement"){let c=Ea(this.filename,s.filename);this.lexerStack.some(y=>y.lexer.filename.equals(c))?this.errors.push(this.getIncludeStatementError(s,"Circular #includes detected!")):(i.push(s),this.includeFile(s,c))}else this.lexer.consume(";"),s&&i.push(s)}catch(s){if($n(s)){for(this.errors.push(s),this.lexer.newlineSignificant=!0;this.token.type!=="Newline"&&!r(this.token);)this.lexerNext();if(this.lexer.newlineSignificant=!1,this.token.type==="Newline")this.lexerNext();else if(Xn(this.token)&&this.isInIncludedFile())this.lexerStack.pop();else break}else throw s}Xn(this.token)&&this.isInIncludedFile()&&this.lexerStack.pop()}return this.finishNode(q.block(i),!0)}includeFile(e,t){if(!this.includeFileResolver.doesFileExist(t.path)){this.errors.push(this.getIncludeStatementError(e,"File does not exist"));return}if(!this.includeFileResolver.isFile(t.path)){this.errors.push(this.getIncludeStatementError(e,"File cannot be read (is it a directory?)"));return}this.isInIncludedFile()||this.includes.push({stmt:e,resolvedFile:t});let i=this.includeFileResolver.loadFileContents(t.path),r=new rn(i,t);r.next(),this.lexerStack.push({lexer:r,includeStatement:e})}parseStatement(e){if(this.markLocation(),this.token.type==="Punctuator"&&this.lexer.consume("::"))return this.parseLabelStatement(e);if(this.lexer.consume(";"))return this.popLocation(),null;if(e.raiseDeferredErrors(),this.token.type==="Keyword")switch(this.token.value){case"local":return this.lexerNext(),this.parseLocalStatement(e);case"if":return this.lexerNext(),this.parseIfStatement(e);case"return":return this.lexerNext(),this.parseReturnStatement(e);case"function":this.lexerNext();let t=this.parseFunctionName();return this.parseFunctionDeclaration(t,!1);case"while":return this.lexerNext(),this.parseWhileStatement(e);case"for":return this.lexerNext(),this.parseForStatement(e);case"repeat":return this.lexerNext(),this.parseRepeatStatement(e);case"break":return this.lexerNext(),e.isInLoop()||he(this.token,V.noLoopToBreak,this.token.value),this.parseBreakStatement();case"do":return this.lexerNext(),this.parseDoStatement(e);case"goto":return this.lexerNext(),this.parseGotoStatement(e)}if(this.token.type==="Punctuator")switch(this.token.value){case"?":return this.lexerNext(),this.parseSpecialPrint(e);case"#":let t=this.token.bounds.start.index;return this.lexer.consumeRestOfLine(t),this.parseIncludeStatement()}return this.popLocation(),this.parseAssignmentOrCallStatement(e)}parseLabelStatement(e){let t=this.token,i=this.parseIdentifier();return this.scopeIdentifierName("::"+t.value+"::"),this.attachScope(i,!0),this.lexer.expect("::"),e.addLabel(t.value,t),this.finishNode(q.labelStatement(i))}parseBreakStatement(){return this.lexer.consume(";"),this.finishNode(q.breakStatement())}parseGotoStatement(e){let t=this.token.value,i=this.previousToken,r=this.parseIdentifier();return e.addGoto(t,i),this.finishNode(q.gotoStatement(r))}parseDoStatement(e){this.createScope(),e.pushScope();let t=this.parseBlock(e);return e.popScope(),this.destroyScope(),this.lexer.expect("end"),this.finishNode(q.doStatement(t))}parseWhileStatement(e){var s;let t,i=((s=this.lexer.token)==null?void 0:s.value)==="(",r=this.parseExpectedExpression(e);return this.lexer.consume("do")?(t=this.parseWhileStatementBody(e),this.lexer.expect("end")):i?this.lexer.withSignificantNewline(()=>{t=this.parseWhileStatementBody(e)}):he(this.token,V.expected,"do",this.token.value),this.finishNode(q.whileStatement(r,t))}parseWhileStatementBody(e){this.createScope(),e.pushScope(!0);let t=this.parseBlock(e);return e.popScope(),this.destroyScope(),t}parseRepeatStatement(e){this.createScope(),e.pushScope(!0);let t=this.parseBlock(e);this.lexer.expect("until"),e.raiseDeferredErrors();let i=this.parseExpectedExpression(e);return e.popScope(),this.destroyScope(),this.finishNode(q.repeatStatement(i,t))}parseReturnStatement(e){let t=[];if(this.token.value!=="end"){let i=this.parseExpression(e);for(i!=null&&t.push(i);this.lexer.consume(",");)i=this.parseExpectedExpression(e),t.push(i);this.lexer.consume(";")}return this.finishNode(q.returnStatement(t))}parseIfStatement(e){var y;let t=[],i,r,s=this.locations[this.locations.length-1];this.pushLocation(s);let c=((y=this.lexer.token)==null?void 0:y.value)==="(";if(i=this.parseExpectedExpression(e),!this.lexer.consume("then")&&!this.lexer.consume("do")){if(c)return i.parens=!1,this.lexer.withSignificantNewline(b=>{s=this.createLocationMarker(),this.pushLocation(s),this.createScope(),e.pushScope();let x=this.parseStatement(e);if(x||we("statement",this.token),e.popScope(),this.destroyScope(),t.push(this.finishNode(q.ifClause(i,this.finishNode(q.block([x]),!0)))),this.lexer.consume("else")){let k=!1;this.lexer.consumeTokenType("Newline")&&(b(),k=!0),s=this.createLocationMarker(),this.pushLocation(s),this.createScope(),e.pushScope();let E;if(k)E=this.parseBlock(e),this.lexer.expect("end");else{let C=this.parseStatement(e);C||we("statement",this.token),E=q.block([C])}e.popScope(),this.destroyScope(),t.push(this.finishNode(q.elseClause(this.finishNode(E))))}}),this.finishNode(q.ifStatement(t,!0));we("statement",this.token)}for(this.createScope(),e.pushScope(),r=this.parseBlock(e),e.popScope(),this.destroyScope(),t.push(this.finishNode(q.ifClause(i,r),!0)),s=this.createLocationMarker();this.lexer.consume("elseif");)this.pushLocation(s),i=this.parseExpectedExpression(e),!this.lexer.consume("then")&&!this.lexer.consume("do")&&et(this.token,V.expectedToken,"'do' or 'this'",this.token.value),this.createScope(),e.pushScope(),r=this.parseBlock(e),e.popScope(),this.destroyScope(),t.push(this.finishNode(q.elseifClause(i,r),!0)),s=this.createLocationMarker();return this.lexer.consume("else")&&(s=new mt(this.previousToken),this.pushLocation(s),this.createScope(),e.pushScope(),r=this.parseBlock(e),e.popScope(),this.destroyScope(),t.push(this.finishNode(q.elseClause(r),!0))),this.lexer.expect("end"),this.finishNode(q.ifStatement(t,!1))}parseForStatement(e){let t=this.parseIdentifier(),i;if(this.createScope(),this.scopeIdentifier(t),this.lexer.consume("=")){let r=this.parseExpectedExpression(e);this.lexer.expect(",");let s=this.parseExpectedExpression(e),c=this.lexer.consume(",")?this.parseExpectedExpression(e):null;return this.lexer.expect("do"),e.pushScope(!0),i=this.parseBlock(e),e.popScope(),this.lexer.expect("end"),this.destroyScope(),this.finishNode(q.forNumericStatement(t,r,s,c,i))}else{let r=[t];for(;this.lexer.consume(",");)t=this.parseIdentifier(),this.scopeIdentifier(t),r.push(t);this.lexer.expect("in");let s=[];do{let c=this.parseExpectedExpression(e);s.push(c)}while(this.lexer.consume(","));return this.lexer.expect("do"),e.pushScope(!0),i=this.parseBlock(e),e.popScope(),this.lexer.expect("end"),this.destroyScope(),this.finishNode(q.forGenericStatement(r,s,i))}}parseLocalStatement(e){let t,i=this.previousToken;if(this.token.type==="Identifier"){let r=[],s=[];do t=this.parseIdentifier(),r.push(t),e.addLocal(t.name,i);while(this.lexer.consume(","));let c;if(Ba(this.token)){c=this.token.value,this.lexerNext();do{let y=this.parseExpectedExpression(e);s.push(y)}while(this.lexer.consume(","))}for(let y=0,b=r.length;y<b;++y)this.scopeIdentifier(r[y]);return this.finishNode(q.localStatement(r,c,s))}if(this.lexer.consume("function"))return t=this.parseIdentifier(),e.addLocal(t.name,i),this.scopeIdentifier(t),this.createScope(),this.parseFunctionDeclaration(t,!0);we("<name>",this.token)}parseAssignmentOrCallStatement(e){let t,i,r,s,c=[],y=this.createLocationMarker();do{t=this.createLocationMarker(),this.token.type==="Identifier"?(s=this.token.value,r=this.parseIdentifier(),this.attachScope(r,this.scopeHasName(s)),i=!0):this.token.value==="("?(this.lexerNext(),r=this.parseExpectedExpression(e),this.lexer.expect(")"),i=!1):this.unexpectedToken(this.token);e:for(;;){switch(this.token.type==="StringLiteral"?'"':this.token.value){case".":case"[":i=!0;break;case":":case"(":case"{":case'"':i=null;break;default:break e}r=this.parsePrefixExpressionPart(r,t,e)}if(c.push(r),this.token.value!==",")break;i||this.unexpectedToken(this.token),this.lexerNext()}while(!0);if(c.length===1&&i===null)return this.pushLocation(t),this.finishNode(q.callStatement(c[0]));i||this.unexpectedToken(this.token),Ba(this.token)||we("assignment operator",this.token);let b=this.token.value;this.lexerNext();let x=[];do x.push(this.parseExpectedExpression(e));while(this.lexer.consume(","));return this.pushLocation(y),this.finishNode(q.assignmentStatement(c,b,x))}parseSpecialPrint(e){let t=this.createLocationMarker(),i=[];this.lexer.withSignificantNewline(()=>{let c=this.parseExpectedExpression(e);for(i.push(c);this.token.type==="Punctuator"&&this.token.value===",";)this.lexerNext(),c=this.parseExpectedExpression(e),i.push(c)});let r=this.finishNode(q.identifier("?"));this.pushLocation(t);let s=this.finishNode(q.callExpression(r,i));return this.pushLocation(t),this.finishNode(q.callStatement(s))}parseIncludeStatement(){let e=this.token.value,i=/#include\s+(.*)$/.exec(e);return i||we("#include <filename>",this.token),this.lexerNext(),this.finishNode({type:"IncludeStatement",filename:i[1]})}getIncludeStatementError(e,t){let i=this.lexerStack.length>=2?this.lexerStack[1].includeStatement:e,r=this.lexerStack.reverse().map(s=>Wa.basename(s.lexer.filename.path)).join(", which is #included from ");return new nn(`Can't #include ${e.filename} from ${r}: ${t}`,i.loc)}parseIdentifier(){this.markLocation();let e=this.token.value;return this.token.type!=="Identifier"&&we("<name>",this.token),this.lexerNext(),this.finishNode(q.identifier(e))}parseFunctionDeclaration(e,t){let i=new Vn;i.pushScope();let r=[];if(this.lexer.expect("("),!this.lexer.consume(")")){do if(this.token.type==="Identifier"){let c=this.parseIdentifier();this.scopeIdentifier(c),r.push(c)}else if(this.token.type==="VarargLiteral"){i.allowVararg=!0,r.push(this.parsePrimaryExpression(i));break}else for(this.errors.push(et(this.token,V.expectedToken,"<name> or '...'",this.token.value));this.token.value!==")"&&this.token.value!==",";)this.lexerNext();while(this.lexer.consume(","));if(!this.lexer.consume(")")){for(this.errors.push(et(this.token,V.expected,")",this.token.value));this.token.value!==")";)this.lexerNext();this.lexerNext()}}let s=this.parseBlock(i);return i.popScope(),this.lexer.expect("end"),this.destroyScope(),t=t||!1,this.finishNode(q.functionStatement(e,r,t,s))}parseFunctionName(){let e,t,i=this.createLocationMarker();for(e=this.parseIdentifier(),this.attachScope(e,this.scopeHasName(e.name)),this.createScope();this.lexer.consume(".");)this.pushLocation(i),t=this.parseIdentifier(),e=this.finishNode(q.memberExpression(e,".",t));return this.lexer.consume(":")&&(this.pushLocation(i),t=this.parseIdentifier(),e=this.finishNode(q.memberExpression(e,":",t)),this.scopeIdentifierName("self")),e}parseTableConstructor(e){let t=[],i,r;for(;;){if(this.markLocation(),this.token.type==="Punctuator"&&this.lexer.consume("["))i=this.parseExpectedExpression(e),this.lexer.expect("]"),this.lexer.expect("="),r=this.parseExpectedExpression(e),t.push(this.finishNode(q.tableKey(i,r)));else if(this.token.type==="Identifier")this.lexer.lookahead.value==="="?(i=this.parseIdentifier(),this.lexerNext(),r=this.parseExpectedExpression(e),t.push(this.finishNode(q.tableKeyString(i,r)))):(r=this.parseExpectedExpression(e),t.push(this.finishNode(q.tableValue(r))));else{if((r=this.parseExpression(e))==null){this.popLocation();break}t.push(this.finishNode(q.tableValue(r)))}if(",;".indexOf(this.token.value)>=0){this.lexerNext();continue}break}return this.lexer.expect("}"),this.finishNode(q.tableConstructorExpression(t))}parseExpression(e){return this.parseSubExpression(0,e)}parseExpectedExpression(e){let t=this.parseExpression(e);if(t==null)we("<expression>",this.token);else return t}parseSubExpression(e,t){let i=this.token.value,r=null,s=this.createLocationMarker();if(Jh(this.token)){this.markLocation(),this.lexerNext();let y=this.parseSubExpression(10,t);y==null&&we("<expression>",this.token),r=this.finishNode(q.unaryExpression(i,y))}if(r==null&&(r=this.parsePrimaryExpression(t),r==null&&(r=this.parsePrefixExpression(t))),r==null)return null;let c;for(;i=this.token.value,c=this.token.type==="Punctuator"||this.token.type==="Keyword"?le.binaryPrecedenceOf(i):le.minPrecedenceValue,!(c===le.minPrecedenceValue||c<=e);){(i==="^"||i==="..")&&--c,this.lexerNext();let y=this.parseSubExpression(c,t);y==null&&we("<expression>",this.token),this.pushLocation(s),r=this.finishNode(q.binaryExpression(i,r,y))}return r}parsePrefixExpressionPart(e,t,i){let r,s;if(this.token.type==="Punctuator")switch(this.token.value){case"[":return this.pushLocation(t),this.lexerNext(),r=this.parseExpectedExpression(i),this.lexer.expect("]"),this.finishNode(q.indexExpression(e,r));case".":return this.pushLocation(t),this.lexerNext(),s=this.parseIdentifier(),this.finishNode(q.memberExpression(e,".",s));case":":return this.pushLocation(t),this.lexerNext(),s=this.parseIdentifier(),e=this.finishNode(q.memberExpression(e,":",s)),this.pushLocation(t),this.parseCallExpression(e,i);case"(":case"{":return this.pushLocation(t),this.parseCallExpression(e,i)}else if(this.token.type==="StringLiteral")return this.pushLocation(t),this.parseCallExpression(e,i);return null}parsePrefixExpression(e){let t,i=this.createLocationMarker();if("Identifier"===this.token.type){let r=this.token.value;t=this.parseIdentifier(),this.attachScope(t,this.scopeHasName(r))}else if(this.lexer.consume("("))t=this.parseExpectedExpression(e),this.lexer.expect(")"),t.parens=!0;else return null;for(;;){let r=this.parsePrefixExpressionPart(t,i,e);if(r===null)break;t=r}return t}parseCallExpression(e,t){if("Punctuator"===this.token.type)switch(this.token.value){case"(":this.lexerNext();let i=[],r=this.parseExpression(t);for(r!=null&&i.push(r);this.lexer.consume(",");)r=this.parseExpectedExpression(t),i.push(r);return this.lexer.expect(")"),this.finishNode(q.callExpression(e,i));case"{":this.markLocation(),this.lexerNext();let s=this.parseTableConstructor(t);return this.finishNode(q.tableCallExpression(e,s))}else if("StringLiteral"===this.token.type)return this.finishNode(q.stringCallExpression(e,this.parsePrimaryExpression(t)));we("arguments",this.token)}parsePrimaryExpression(e){let t=["StringLiteral","NumericLiteral","BooleanLiteral","NilLiteral","VarargLiteral"],i=this.token.value,r=this.token.type,s=this.createLocationMarker();if(r==="VarargLiteral"&&!e.allowVararg&&he(this.token,V.cannotUseVararg,this.token.value),t.includes(r)){this.pushLocation(s);let c=this.lexer.input.slice(this.token.bounds.start.index,this.token.bounds.end.index);return this.lexerNext(),this.finishNode(q.literal(r,i,c))}else{if(r==="Keyword"&&i==="function")return this.pushLocation(s),this.lexerNext(),this.createScope(),this.parseFunctionDeclaration(null,!1);if(this.lexer.consume("{"))return this.pushLocation(s),this.parseTableConstructor(e)}return null}};function Jh(n){return n.type==="Punctuator"?["#","-","~","@","%","$"].includes(n.value):n.type==="Keyword"?n.value==="not":!1}function Ba(n){return n.type==="Punctuator"&&["=","+=","-=","*=","/=","\\=","%=","^=","..=","|=","&=","^^=","<<=",">>=",">>>=","<<>=",">><="].includes(n.value)}function Xh(n){if(n.type==="EOF")return!0;if(n.type!=="Keyword")return!1;switch(n.value){case"else":case"elseif":case"end":case"until":return!0;default:return!1}}function Xn(n){return n.type==="EOF"}var Oe={circ:{sig:"circ( x, y, [r,] [col] )",desc:"Draws a circle shape, without fill.",params:["x: The x coordinate of the center of the circle.","y: The y coordinate of the center of the circle.","r: The radius of the circle, in pixels. If omitted, the radius will be 4.","col: The color of the circle and fill. If omitted, the color from the draw state is used."]},cursor:{sig:"cursor( [x,] [y,] [col] )",desc:"Sets the left-margin cursor position for print().",params:["x: The x coordinate of the upper left corner of the line. The default is 0.","y: The y coordinate of the upper left corner of the line. The default is 0.","col: (Optional) The palette index to set the pen color to.","return-value: An x,y,c tuple representing the previous cursor position and color."]},cls:{sig:"cls( [color] )",desc:"Clears the graphics buffer.",params:["color: A color to use for the background. The default is 0 (black)."]},reset:{sig:"reset( )",desc:"Reset the values in RAM from 0x5f00..0x5f7f to their default values. This includes the palette, camera position, clipping, and fill pattern."},info:{sig:"info( )",desc:"Print out some information about the cartridge, including code size, tokens, and compressed size."},ovalfill:{sig:"ovalfill( x0, y0, x1, y1, [col] )",desc:"Draws a filled oval shape.",params:["x0: The x coordinate of the upper left corner.","y0: The y coordinate of the upper left corner.","x1: The x coordinate of the lower right corner.","y1: The y coordinate of the lower right corner.","col: The color of the oval. If omitted, the color from the draw state is used."]},circfill:{sig:"circfill( x, y, [r,] [col] )",desc:"Draws a filled-in circle shape.",params:["x: The x coordinate of the center of the circle.","y: The y coordinate of the center of the circle.","r: The radius of the circle, in pixels. If omitted, the radius will be 4.","col: The color of the circle and fill. If omitted, the color from the draw state is used."]},fget:{sig:"fget( n, [f] )",desc:"Gets the value of a flag of a sprite.",params:["n: The sprite number.","f: The flag index (0-7). If omitted, a bit field of all flags is returned."]},color:{sig:"color( [col] )",desc:"Sets the draw color in the draw state.",params:["col: The color number. Default is 6 (light gray)."]},pget:{sig:"pget( x, y )",desc:"Gets the color value of a pixel at the given coordinates.",params:["x: The x coordinate.","y: The y coordinate."]},line:{sig:"line( [x0,] [y0,] [x1,] [y1,] [color] )",desc:"Draws a line between two points.",params:["x0: The x coordinate of the start of the line. If omitted, the x coordinate of the end of the previous line is used, or 0 if no previous line has been drawn.","y0: The y coordinate of the start of the line. If omitted, the y coordinate of the end of the previous line is used, or 0 if no previous line has been drawn.","x1: The x coordinate of the end of the line.","y1: The y coordinate of the end of the line.","color: The color of the line. If omitted, the color from the draw state is used. This also sets the color in the draw state."]},rect:{sig:"rect( x0, y0, x1, y1, [col] )",desc:"Draws an empty rectangle shape.",params:["x0: The x coordinate of the upper left corner.","y0: The y coordinate of the upper left corner.","x1: The x coordinate of the lower right corner.","y1: The y coordinate of the lower right corner.","col: The color of the rectangle border. If omitted, the color from the draw state is used."]},rrect:{sig:"rrect( x, y, w, h, r, [col] )",desc:"Draws an empty rectangle shape with rounded corners.",params:["x: The x coordinate of the upper left corner.","y: The y coordinate of the upper left corner.","w: The width of the rounded rectangle, in pixels.","h: The height of the rounded rectangle, in pixels.","r: The size of the quarter-circle to be drawn at each corner. The maximum radius is min(width, height)/2. Default is 0.","col: The color of the rounded rectangle border. If omitted, the color from the draw state is used."]},palt:{sig:"palt( [col,] [t] )",desc:"Change the transparency of a color in the draw state for subsequent draw calls.",params:["col: The number of the color to modify.","t: If true, treat this color as transparent. If false, treat this color as opaque."]},oval:{sig:"oval( x0, y0, x1, y1, [col] )",desc:"Draws an empty oval shape.",params:["x0: The x coordinate of the upper left corner.","y0: The y coordinate of the upper left corner.","x1: The x coordinate of the lower right corner.","y1: The y coordinate of the lower right corner.","col: The color of the oval's border. If omitted, the color from the draw state is used."]},pset:{sig:"pset( x, y, [c] )",desc:"Sets a pixel in the graphics buffer.",params:["x: The x coordinate.","y: The y coordinate.","c: The color value. If not specified, uses the current color of the draw state."]},fillp:{sig:"fillp( [pat] )",desc:"Sets the fill pattern.",params:["pat: A bitfield representing the fill pattern to use."]},flip:{sig:"flip( )",desc:"Copies the graphics buffer to the screen, then synchronizes to the next frame at 30 frames per second.",params:[]},spr:{sig:"spr( n, x, y, [w,] [h,] [flip_x,] [flip_y] )",desc:"Draws a sprite, or a range of sprites, on the screen.",params:["n: The sprite number. When drawing a range of sprites, this is the upper-left corner.","x: The x coordinate.","y: The y coordinate.","w: The width of the range, as a number of sprites. Non-integer values may be used to draw partial sprites. The default is 1.0.","h: The height of the range, as a number of sprites. Non-integer values may be used to draw partial sprites. The default is 1.0.","flip_x: If true, the sprite is drawn inverted left to right. The default is false.","flip_y: If true, the sprite is drawn inverted top to bottom. The default is false."]},sget:{sig:"sget( x, y )",desc:"Gets the color value of a pixel on the sprite sheet.",params:["x: The x coordinate on the sprite sheet.","y: The y coordinate on the sprite sheet."]},print:{sig:"print( text, [x,] [y,] [color] )",desc:"Prints a string of characters to the screen.",params:["text: The Lua string of characters to print.","x: The x coordinate of the upper left corner to start printing.","y: The y coordinate of the upper left corner to start printing.","color: The color to use for the text.","return-value: The x coordinate of the next character to be printed (can be used to calculate printed width)"]},pal:{sig:"pal( c0, c1, [p] )",desc:"Changes the draw state so all instances of a given color are replaced with a new color.",params:["c0: The number of the original color to replace.","c1: The number of the new color to use instead.","p: 0 to modify the palette used by draw operations, 1 to modify the palette for the screen already drawn, or 2 to modify the secondary screen palette. The default is 0."]},sset:{sig:"sset( x, y, [c] )",desc:"Sets the color value of a pixel on the sprite sheet.",params:["x: The x coordinate on the sprite sheet.","y: The y coordinate on the sprite sheet.","c: The color value to set. If unspecified, the color of the current draw state will be used."]},camera:{sig:"camera( [x,] [y] )",desc:"Sets the camera offset in the draw state.",params:["x: The x offset, in pixels, to subtract from future draw coordinates. (default 0)","y: The y offset, in pixels, to subtract from future draw coordinates. (default 0)","return-value: An x,y tuple representing the previous camera offset."]},ipairs:{},clip:{sig:"clip( x, y, w, h, [clip_previous] )",desc:"Sets the clipping region in the draw state.",params:["x: The x coordinate of the upper left corner of the clipping rectangle.","y: The y coordinate of the upper left corner of the clipping rectangle.","w: The width of the clipping rectangle, in pixels.","h: The height of the clipping rectangle, in pixels.","clip_previous: If true, the new clipping rectangle is formed by clipping it to the area of the one currently specified within the draw state.","return-value: An x,y,w,h tuple representing the previous clipping rectangle."]},mset:{sig:"mset( celx, cely, snum )",desc:"Sets a cell on the map to a new sprite number.",params:["celx: The column (x) coordinate of the cell.","cely: The row (y) coordinate of the cell.","snum: The new sprite number to store."]},mget:{sig:"mget( celx, cely )",desc:"Gets the sprite number assigned to a cell on the map.",params:["celx: The column (x) coordinate of the cell.","cely: The row (y) coordinate of the cell."]},next:{sig:"next( tbl, [key] )",desc:"A stateless iterator of key-value pairs for all elements in a table.",params:["tbl: The table.","key: The current key."]},band:{sig:"band( first, second )",desc:"Calculates the bitwise-and of two numbers.",params:["first: The first number.","second: The second number.","return-value: The bitwise-and of first and second."],deprecated:!0},unpack:{sig:"unpack( tbl, [i,] [j] )",desc:"Returns the elements from the given table.",params:["tbl: The table to unpack.","i: First index to unpack. Default is 1.","j: Last index to unpack. Default is #tbl."]},setmetatable:{sig:"setmetatable( tbl, metatbl )",desc:"Updates the metatable for a table.",params:["tbl: The table whose metatable to modify.","metatbl: The new metatable.","return-value: The same tbl that was passed in."]},fset:{sig:"fset( n, [f,] v )",desc:"Sets the value of a flag of a sprite.",params:["n: The sprite number.","f: The flag index (0-7). If omitted, a bit field of all flags is returned.","v: The value, either true or false if the flag index is specified, or the bit field of all flags if it is not."]},sub:{sig:"sub( str, start, [end] )",desc:"Gets the substring of a string.",params:["str: The string.","start: The starting index, counting from 1 at the left, or -1 at the right.","end: The ending index, counting from 1 at the left, or -1 at the right. (default -1)"]},split:{sig:"split( str, [separator,] [convert_numbers] )",desc:'Split a string into a table of elements delimited by the given separator (defaults to ",").',params:["str: The string.",'separator: The separator (defaults to ",").',"convert_numbers: When convert_numbers is true, numerical tokens are stored as numbers (defaults to true)."]},rectfill:{sig:"rectfill( x0, y0, x1, y1, [col] )",desc:"Draws a filled-in rectangle shape.",params:["x0: The x coordinate of the upper left corner.","y0: The y coordinate of the upper left corner.","x1: The x coordinate of the lower right corner.","y1: The y coordinate of the lower right corner.","col: The color of the rectangle and fill. If omitted, the color from the draw state is used."]},rrectfill:{sig:"rrectfill( x, y, w, h, r, [col] )",desc:"Draws a filled-in rectangle shape with rounded corners.",params:["x: The x coordinate of the upper left corner.","y: The y coordinate of the upper left corner.","w: The width of the rounded rectangle, in pixels.","h: The height of the rounded rectangle, in pixels.","r: The size of the quarter-circle to be drawn at each corner. The maximum radius is min(width, height)/2. Default is 0.","col: The color of the rounded rectangle and fill. If omitted, the color from the draw state is used."]},sfx:{sig:"sfx( n, [channel,] [offset,] [length] )",desc:"Plays a sound effect.",params:["n: The number of the sound effect to play (0-63), -1 to stop playing sound on the given channel, or -2 to release the sound of the given channel from looping.","channel: The channel to use for the sound effect (0-3). The default is -1, which chooses an available channel automatically. Can be -2 to stop playing the given sound effect on any channels it plays on.","offset: The note position in the sound effect to start playing (0-31). The default is 0 (the beginning).","length: The number of notes in the sound effect to play (0-31). The default is to play the entire sound effect."]},printh:{sig:"printh( str, [filename,] [overwrite] )",desc:"Prints a string to a console window that is running PICO-8, or to a file or the clipboard.",params:["str: The string to print.",'filename: The name of a file to append the output, instead of printing to the console. If this is the string "@clip", the message replaces the contents of the system clipboard instead of writing to a file.',"overwrite: If filename is provided and is the name of a file and overwrite is true, this overwrites the file. The default is false, which appends the message to the end of the file."]},getmetatable:{sig:"getmetatable( tbl )",desc:"Gets the metatable for a table.",params:["tbl: The table."]},pack:{sig:"pack( ... )",desc:"Creates a table from the given parameters.",params:["...: parameters"]},sin:{sig:"sin( angle )",desc:"Calculates the sine of an angle.",params:["angle: The angle, using a full circle range of 0.0-1.0 measured clockwise (0.0 to the right)."]},memcpy:{sig:"memcpy( destaddr, sourceaddr, len )",desc:"Copies a region of memory to another location in memory.",params:["destaddr: The address of the first byte of the destination.","sourceaddr: The address of the first byte of the memory to copy.","len: The length of the memory region to copy, as a number of bytes."]},sqrt:{sig:"sqrt( num )",desc:"Calculates the square root of a number.",params:["num: The number. Must be positive."]},memset:{sig:"memset( destaddr, val, len )",desc:"Writes a byte value to every address in a region of memory.",params:["destaddr: The address of the first memory location to write.","val: The byte value to write.","len: The length of the region of memory to write, as a number of bytes."]},all:{sig:"all( tbl )",desc:"Returns an iterator for all non-nil items in a sequence in a table, for use with for...in.",params:["tbl: The table to iterate.","return-value: An interator function that can be used with for...in to iterate over tbl."]},flr:{sig:"flr( num )",desc:'Returns the nearest integer at or below a number (its "floor").',params:["num: The number.","return-value: The nearest integer at or below num."]},sspr:{sig:"sspr( sx, sy, sw, sh, dx, dy, [dw,] [dh,] [flip_x,] [flip_y] )",desc:"Draws a rectangle of pixels from the sprite sheet, optionally stretching the image to fit a rectangle on the screen.",params:["sx: The x coordinate of the upper left corner of the rectangle in the sprite sheet.","sy: The y coordinate of the upper left corner of the rectangle in the sprite sheet.","sw: The width of the rectangle in the sprite sheet, as a number of pixels.","sh: The height of the rectangle in the sprite sheet, as a number of pixels.","dx: The x coordinate of the upper left corner of the rectangle area of the screen.","dy: The y coordinate of the upper left corner of the rectangle area of the screen.","dw: The width of the rectangle area of the screen. The default is to match the image width (sw).","dh: The height of the rectangle area of the screen. The default is to match the image height (sh).","flip_x: If true, the image is drawn inverted left to right. The default is false.","flip_y: If true, the image is drawn inverted top to bottom. The default is false."]},deli:{sig:"deli( table, [index] )",desc:"Removes the element at the given index of a sequence in a table.",params:["table: The table.","index: The index for the value to be removed."]},count:{sig:"count( tbl, [v] )",desc:"Returns the length of a table, or the number of instances of a value within a table.",params:["tbl: The table.","v: Value to count occurrences of."]},peek:{sig:"peek( addr, [n] )",desc:"Reads one or more bytes from contiguous memory locations starting at addr.",params:["addr: The address of the first memory location.","n: The number of bytes to return. (1 by default, 8192 max.)"]},abs:{sig:"abs( num )",desc:"Returns the absolute value of a number.",params:["num: The number.","return-value: The absolute value of num."]},atan2:{sig:"atan2( dx, dy )",desc:"Calculates the arctangent of dy/dx, the angle formed by the vector on the unit circle. The result is adjusted to represent the full circle.",params:["dx: The horizontal component.","dy: The vertical component.","return-value: The angle of the line from 0,0 to dx,dy."]},min:{sig:"min( first, [second] )",desc:"Returns the minimum of two numbers.",params:["first: The first number.","second: The second number. (default 0)"]},lshr:{sig:"lshr( num, bits )",desc:"Shifts the bits of a number to the right, using logical shift.",params:["num: The number.","bits: The number of bits to shift."],deprecated:!0},cos:{sig:"cos( angle )",desc:"Calculates the cosine of an angle.",params:["angle: The angle, using a full circle range of 0.0-1.0."]},mid:{sig:"mid( first, second, third )",desc:"Returns the middle of three numbers. Also useful for clamping.",params:["first: The first number.","second: The second number.","third: The third number."]},rawequals:{},tline:{sig:"New in PICO-8 0.2.0.",desc:"Draws a textured line between two points, sampling the map for texture data.",params:["x0: The x coordinate of the start of the line.","y0: The y coordinate of the start of the line.","x1: The x coordinate of the end of the line.","y1: The y coordinate of the end of the line.","mx: The x coordinate to begin sampling the map, expressed in (fractional) map tiles.","my: The y coordinate to begin sampling the map, expressed in (fractional) map tiles.","mdx: The amount to add to mx after each pixel is drawn, expressed in (fractional) map tiles. Default is 1/8 (move right one map pixel).","mdy: The amount to add to mx after each pixel is drawn, expressed in (fractional) map tiles. Default is 0 (a horizontal line)."]},bnot:{sig:"bnot( num )",desc:"Calculates the bitwise not of a number.",params:["num: The number.","return-value: The bitwise-not of num."],deprecated:!0},pairs:{sig:"pairs( tbl )",desc:"Returns an iterator of key-value pairs for all elements in a table, for use with for...in.",params:["tbl: The table."]},ceil:{sig:"ceil( num )",desc:'Returns the nearest integer at or above a number (its "ceiling").',params:["num: The number.","return-value: The nearest integer at or above num."]},foreach:{sig:"foreach( tbl, func )",desc:"Calls a function for each element in a sequence in a table.",params:["tbl: The table.","func: The function to call. The function should accept an element as its sole argument."]},dget:{sig:"dget( index )",desc:"Gets a value from persistent cartridge data.",params:["index: The index of the value, 0 to 63."]},rnd:{sig:"rnd( [max] )",desc:"Generates a random number between 0 and the given maximum exclusive, or returns a random element from a 1-based table sequence.",params:["max: The range, non-inclusive. Defaults to 1."]},btn:{sig:"btn( [i,] [p] )",desc:"Tests if a button is being pressed at this moment.",params:["i: The button number.","p: The player number.","return-value: If a button is specified, then true or false, otherwise a bitfield for multiple players."]},srand:{sig:"srand( val )",desc:"Initializes the random number generator with an explicit seed value.",params:["val: The seed value."]},map:{sig:"map( celx, cely, sx, sy, celw, celh, [layer] )",desc:"Draws a portion of the map to the graphics buffer.",params:["celx: The column location of the map cell in the upper left corner of the region to draw, where 0 is the leftmost column.","cely: The row location of the map cell in the upper left corner of the region to draw, where 0 is the topmost row.","sx: The x coordinate of the screen to place the upper left corner.","sy: The y coordinate of the screen to place the upper left corner.","celw: The number of map cells wide in the region to draw.","celh: The number of map cells tall in the region to draw.","layer: If specified, only draw sprites that have flags set for every bit in this value (a bitfield). The default is 0 (draw all sprites)."]},poke:{sig:"poke( addr, [value,] [...] )",desc:"Writes one or more bytes to contiguous memory locations.",params:["addr: The address of the first memory location.","value: The byte value to write to memory. Defaults to 0.","...: Additional byte values to be written consecutively to memory."]},self:{},cartdata:{sig:"cartdata( id )",desc:"Sets up cartridge data for the cart.",params:["id: A string that is likely to be unique across all PICO-8 carts."]},music:{sig:"",desc:"Plays a music pattern, or stops playing.",params:["n: The pattern number to start playing (0-63), or -1 to stop playing music.","fadems: If not 0, fade in (or out) the music volume over a duration, given as a number of milliseconds.","channelmask: A bitfield indicating which of the four sound channels should be reserved for music. The default is 0 (no channels reserved)."]},coyield:{},costatus:{sig:"costatus( cor )",desc:"Tests a coroutine and returns a string representing its status.",params:["cor: The coroutine to test."]},shl:{sig:"shl( num, bits )",desc:"Shifts the bits of a number to the left.",params:["num: The number.","bits: The number of bits to shift."],deprecated:!0},add:{sig:"add( table, value, [index] )",desc:"Adds a element to the end of a sequence in a table.",params:["table: The table.","value: The value to add.","index: The index for the value to be inserted.","return-value: The value that was passed in."]},rotl:{sig:"rotl( num, bits )",desc:"Rotates the bits of a number to the left.",params:["num: The number.","bits: The number of bits to rotate."],deprecated:!0},del:{sig:"del( table, value )",desc:"Deletes the first occurrence of a value from a sequence in a table.",params:["table: The table.","value: The value to match and remove."]},cocreate:{sig:"cocreate( func )",desc:"Creates a coroutine from a function.",params:["func: The function for the coroutine to run.","return-value: A new coroutine."]},sgn:{sig:"sgn( [number] )",desc:"Returns the sign of a number, 1 for positive, -1 for negative",params:["number: The number to determine the sign of."]},max:{sig:"max( first, [second] )",desc:"Returns the maximum of two numbers.",params:["first: The first number.","second: The second number. (default 0)"]},bor:{sig:"bor( first, second )",desc:"Calculates the bitwise-or of two numbers.",params:["first: The first number.","second: The second number.","return-value: The bitwise-or of first and second."],deprecated:!0},rotr:{sig:"rotr( num, bits )",desc:"Rotates the bits of a number to the right.",params:["num: The number.","bits: The number of bits to rotate."],deprecated:!0},shr:{sig:"shr( num, bits )",desc:"Shifts the bits of a number to the right.",params:["num: The number.","bits: The number of bits to shift."],deprecated:!0},assert:{sig:"assert( cond, [message] )",desc:"Causes a runtime error if a conditional expression is false.",params:["cond: The conditional expression to assert.","message: A message to print when the assertion fails.","return-value: All arguments as passed to assert() in a tuple (if the assert didn't fail)."]},rawget:{sig:"rawget( tbl, member )",desc:"Read a table member, bypassing metamethods",params:["tbl: The table whose member to read.","member: The member to read."]},load:{sig:"load( filename, [breadcrumb], [param] )",desc:"Loads a cartridge, completely replacing the current cart in memory and beginning to execute immediately.",params:['filename: Either the name of the cartridge file, a BBS cart ID in the form "#mycartid123", or "@clip" to load a cartridge from the system clipboard copied from the BBS.',"breadcrumb: Adds an item to the pause menu to return to the original cart.","param: An arbitrary string value that can be accessed by the loaded cart using stat(6)."]},reload:{sig:"reload( destaddr, sourceaddr, len, [filename] )",desc:"Loads a region of data from the cartridge, or from another cartridge, into memory.",params:["destaddr: The address of the first byte of the destination in memory.","sourceaddr: The address of the first byte in the cartridge data.","len: The length of the memory region to copy, as a number of bytes.","filename: If specified, the filename of a cartridge from which to read data. The default is to read from the currently loaded cartridge."]},tonum:{sig:"tonum( str )",desc:"Converts a string representation of a decimal, hexadecimal, or binary number to a number value.",params:["str: The string."]},rawlen:{sig:"rawlen( tbl )",desc:"Get the length of a table, bypassing metamethods",params:["tbl: The table whose length to retrieve."]},btnp:{sig:"btnp( [i,] [p] )",desc:"Tests if a button has just been pressed, with keyboard-style repeating.",params:["i: The button number.","p: The player number.","return-value: If a button is specified, then true or false, otherwise a bitfield for multiple players."]},chr:{sig:"New in PICO-8 0.2.0.",desc:"Gets the character(s) corresponding to an ordinal(s) (numeric) value.",params:["ord [, ord1, ordn]: The ordinal value to be converted to a single-character string. Accepts an array of ordinals and will return a string of characters","return-value: A string consisting of a single character corresponding to the given ordinal number or a string of characters if an array was provided"]},rawset:{sig:"rawset( tbl, member, value )",desc:"Write to a table member, bypassing metamethods",params:["tbl: The table whose member to modify.","member: The member to modify.","value: The member's new value."]},cstore:{sig:"cstore( destaddr, sourceaddr, len, [filename] )",desc:"Store a region of memory in the cartridge file, or another cartridge file.",params:["destaddr: The address of the first byte of the destination in the cartridge.","sourceaddr: The address of the first byte in memory to copy.","len: The length of the memory region to copy, as a number of bytes.","filename: If specified, the filename of a cartridge to which data is written. The default is to write to the currently loaded cartridge."]},dset:{sig:"dset( index, value )",desc:"Sets a value in persistent cartridge data.",params:["index: The index of the value.","value: The new value to set."]},type:{sig:"type( value )",desc:"Returns the basic type of a given value as a string.",params:["value: The value whose type to test."]},coresume:{sig:"coresume( cor, [...] )",desc:"Starts a coroutine, or resumes a suspended coroutine.",params:["cor: The coroutine, as created by cocreate().","...: The arguments to pass to the coroutine's function or the coroutine's subsequent yields.","return-values: A boolean indicating whether or not the coroutine is alive. On death, there may be a second value with an exception string."]},bxor:{sig:"bxor( first, second )",desc:"Calculates the bitwise-xor (exclusive or) of two numbers.",params:["first: The first number.","second: The second number.","return-value: The bitwise-xor of first and second."],deprecated:!0},ord:{sig:"ord( str, [index] )",desc:"Gets the ordinal (numeric) version of a character in a string.",params:["str: The string whose character is to be converted to an ordinal.","index: The index of the character in the string. Default is 1, the first character.","return-value: The ordinal value of the character at index in str"]},tostr:{sig:"tostr( val, [usehex] )",desc:"Converts a non-string value to a string representation.",params:["val: The value to convert.","usehex: If true, uses 32-bit unsigned fixed point hexadecimal notation for number values. The default is to use concise decimal notation for number values."]},tostring:{sig:"tostring( val )",desc:"Converts a non-string value to a string representation.",params:["val: The value to convert."]},menuitem:{sig:"menuitem( index, [label,] [callback] )",desc:"Adds a custom item to the PICO-8 menu.",params:["index: The item index, a number between 1 and 5.","label: The label text of the menu item to add or change.","callback: A Lua function to call when the user selects this menu item."]},poke4:{sig:"poke4( addr, [...] )",desc:"Writes one or more 32-bit fixed-point PICO-8 number values to contiguous groups of four consecutive memory locations.",params:["addr: The address of the first memory location.","...: The 32-bit values to write to memory. If these are omitted, a zero is written to the first 4 bytes."]},poke2:{sig:"poke2( addr, [...] )",desc:"Writes one or more 16-bit values to contiguous groups of two consecutive memory locations.",params:["addr: The address of the first memory location.","...: The 16-bit values to write to memory. If these are omitted, a zero is written to the first 2 bytes."]},peek2:{sig:"peek2( addr, [n] )",desc:"Reads one or more 16-bit values from contiguous groups of two consecutive memory locations.",params:["addr: The address of the first memory location.","n: The number of values to return. (1 by default, 8192 max.)"]},peek4:{sig:"peek4( addr, [n] )",desc:"Reads one or more 32-bit fixed-point number values from contiguous groups of four consecutive memory locations.",params:["addr: The address of the first memory location.","n: The number of values to return. (1 by default, 8192 max.)"]},stat:{sig:"stat( n )",desc:"Returns information about the current runtime environment.",params:["n: The ID of the information to return."]},t:{sig:"t( )",desc:"Returns the amount of time since PICO-8 was last started, as a (fractional) number of seconds."},time:{sig:"time( )",desc:"Returns the amount of time since PICO-8 was last started, as a (fractional) number of seconds."},extcmd:{sig:"extcmd( cmd )",desc:"Executes an administrative command from within a program.",params:["'label': Sets the cart label to the current screen.","'screen': Saves a screenshot.","'rec': Sets the video recording start point.","'video': Saves an animated GIF to the desktop.","'audio_rec': Starts audio recording.","'audio_end': Ends audio recording and saves to the desktop.","'pause': Activates the pause menu, as if the player pressed the pause button.","'reset': Resets the currently running cart, as if the player pressed the reset key sequence (Control-R or Command-R).","'breadcrumb': After a cart uses load() with the breadcrumb parameter to load another cart, loads the original cart, as if the player selected the breadcrumb menu item.","'shutdown': Exits the program if used in an exported binary.","'set_filename': Set the filename of the next screenshot or gif.","'set_title': set window title (useful for exported binaries)","'folder': opens the folder where carts are. Nice if you want to open to a created file or what have you."]},serial:{sig:"serial( channel, address, length)",desc:"Buffers and dispatches GPIO writes at the end of each frame, allowing clock cycling at higher and/or more regular speeds than is possible by manually bit-banging using poke() calls.",params:["channel: the channel to fread from/write to","address: the PICO-8 memory location to read from/write to.","length: number of bytes to send. 1/8ths are allowed to send partial bit strings."]},select:{sig:"select( index, ... )",desc:"Selects from the given parameters.",params:["index: Index to return parameters from, or '#' to return number of parameters","...: parameters"]},yield:{sig:"yield( [...] )",desc:"Yields control back to the caller from within a coroutine.",params:["...: Arguments to be passed to the coresume() that resumed its coroutine."]},stop:{sig:"stop( [message,] [x,] [y,] [col] )",desc:"Stops the program's execution and returns to the command prompt.",params:["message: An optional message to print before stopping.","x: The x coordinate of the upper left corner to start printing.","y: The y coordinate of the upper left corner to start printing.","col: The color to use for the text."]},trace:{sig:"trace( [coroutine,] [message,] [skip] )",desc:"Returns a description of the current call stack as a string.",params:["coroutine: Optionally get the stack trace for a coroutine. Defaults to the current one or the main thread.","message: Adds the given string to the top of the trace report. Defaults to blank.","skip: Number of levels of the stack to skip. Defaults to 1, to skip the trace() call's own level."]},run:{sig:"run( [str] )",desc:"Runs the current cartridge from the start of the program.",params:['str: A "breadcrumb" string, as if passed by a calling cartridge.']}};Oe.mapdraw=Oe.map;Oe["?"]=Oe.print;var Ua=new Set(["_ENV","\u2588","\u2592","\u{1F431}","\u2B07\uFE0F","\u2591","\u273D","\u25CF","\u2665","\u2609","\uC6C3","\u2302","\u2B05\uFE0F","\u{1F610}","\u266A","\u{1F17E}\uFE0F","\u25C6","\u2026","\u27A1\uFE0F","\u2605","\u29D7","\u2B06\uFE0F","\u02C7","\u2227","\u274E","\u25A4","\u25A5"]);function Ga(n){return{symbolName:n,definitions:[],usages:[]}}var $a=class{constructor(){this.lines=[]}getLine(e){let t=this.lines[e];return t||(t=[],this.lines[e]=t),t}add(e,t){let i=this.getLine(e.start.line);for(let r of i)if(r.defUs.symbolName===t.symbolName&&tn(r.loc,e)){this.addLocationsIfNotExists(t.definitions,r.defUs.definitions),this.addLocationsIfNotExists(t.usages,r.defUs.usages);return}i.push({loc:e,defUs:t})}addLocationsIfNotExists(e,t){for(let i of e){let r=!0;for(let s of t)if(tn(i,s)){r=!1;break}r&&t.push(i)}}lookup(e,t){let i=this.lines[e];if(!i)return;let r;for(let s of i){let c=e===s.loc.start.line&&t>=s.loc.start.column&&t<=s.loc.end.column,y=!r||Tr(r.loc)>Tr(s.loc);c&&y&&(r=s)}return r==null?void 0:r.defUs}};function Ha(n,e={}){return new Va(n,e).findDefinitionsUsages()}var cn=class{constructor(e,t,i){this.children=[];this.type=e,this.loc=t,this.name=i.name,this.self=i.self,this.symbols=i.symbols||new Map}get(e){return this.symbols.get(e)}set(e,t){return this.symbols.set(e,t)}has(e){return this.symbols.has(e)}keys(){return this.symbols.keys()}contains(e){return this.loc===null?!0:!e.filename.equals(this.loc.start.filename)&&!e.filename.equals(this.loc.end.filename)||!(e.line>=this.loc.start.line&&e.line<=this.loc.end.line)?!1:this.loc.start.line===this.loc.end.line?e.column>=this.loc.start.column&&e.column<=this.loc.end.column:e.line===this.loc.start.line?e.column>=this.loc.start.column:e.line===this.loc.end.line?e.column<=this.loc.end.column:!0}lookupScopeFor(e){for(let t of this.children)if(t.contains(e))return t.lookupScopeFor(e);return this}allSymbols(){let e=[],t=this;for(;t;)e.push(...t.symbols.keys()),t=t.parent;return e}},Va=class extends gt{constructor(e,t={}){super();this.lookup=new $a;this.earlyRefs={};this.warnings=[];this.chunk=e,this.dontAddGlobalSymbols=!!t.dontAddGlobalSymbols,this.injectedGlobalScope=t.injectedGlobalScope}findDefinitionsUsages(){return this.visit(this.chunk),this.resolveEarlyRefs(),{definitionsUsages:this.lookup,warnings:this.warnings,scopes:this.scopeStack[0]}}startingScope(){if(this.injectedGlobalScope)return this.injectedGlobalScope;let e=new Map;if(!this.dontAddGlobalSymbols){for(let t in Oe)e.set(t,Ga(t));for(let t of Ua)e.set(t,Ga(t))}return new cn("Global",null,{symbols:e})}createDefaultScope(e,t){var s,c;t=t||"Other";let i=(s=this.topScope())==null?void 0:s.self,r=(c=this.topScope())==null?void 0:c.name;return new cn(t,(e==null?void 0:e.loc)||null,{self:i,name:r})}resolveEarlyRefs(){for(let e in this.earlyRefs){let t=e,i=this.earlyRefs[e],r=t.indexOf(".")!==-1;for(;!this.isSymbolDefined(t)&&t.indexOf(".")!==-1;)t=t.split(".").slice(1).join(".");this.isSymbolDefined(t)||(!r&&t!=="self"&&i.forEach(s=>{this.warnings.push(Ca(s,V.undefinedVariable,e))}),this.globalScope().has(t)||this.globalScope().set(t,{symbolName:t,definitions:[],usages:[]})),i.forEach(s=>{this.addUsage(t,s)})}}onEnterScope(e){this.topScope(1).children.push(e),e.parent=this.topScope(1)}onExitScope(e){e.type!=="Table"}isSymbolLocal(e){for(let t=this.scopeStack.length-1;t>0;t--)if(this.scopeStack[t].has(e))return!0;return!1}isSymbolDefined(e){for(let t=this.scopeStack.length-1;t>=0;t--)if(this.scopeStack[t].has(e))return!0;return!1}getSymbolDef(e){for(let t=this.scopeStack.length-1;t>=0;t--){let i=this.scopeStack[t].get(e);if(i)return i}}globalScope(){return this.scopeStack[0]}addDefinition(e,t,i){let r=i||this.topScope(),s=r.get(e);s?(s.definitions.push(t),s.usages.push(t)):(s={symbolName:e,definitions:[t],usages:[t]},r.set(e,s)),this.lookup.add(t,s)}addUsage(e,t){let i=this.getSymbolDef(e);if(!i){this.addEarlyRef(e,t);return}tn(t,i.usages[i.usages.length-1])||i.usages.push(t),!this.isSymbolLocal(e)&&this.isInAssignment()&&!this.isInAssignmentTarget()&&(tn(t,i.definitions[i.definitions.length-1])||i.definitions.push(t)),this.lookup.add(t,i)}addEarlyRef(e,t){let i=this.earlyRefs[e];i||(i=[],this.earlyRefs[e]=i),i.push(t)}visitFunctionDeclaration(e){var s;let t=e.identifier&&Oa(e),i=e.identifier&&e.identifier.loc,r;if(((s=e.identifier)==null?void 0:s.type)==="MemberExpression")r=Pr(e.identifier);else if(!e.identifier&&this.isInAssignment()){let c=this.topNode().node;switch(c.type){case"Identifier":t=c.name,i=c.loc;break;case"MemberExpression":r=Pr(c),t=xe(c)||c.identifier.name,i=c.loc;break;case"TableKeyString":t=c.key.name,i=c.key.loc,r=this.topScope().name;break;default:throw new Error(`Unexpected previous node type after checking isInAssignment: ${c.type}`)}}return t&&this.addDefinition(t,i,this.globalScope()),new cn("Function",e.loc,{self:r,name:t||void 0})}visitIdentifier(e){var i;let t=(i=this.topNode())==null?void 0:i.node;if((t==null?void 0:t.type)==="FunctionDeclaration"){this.addDefinition(e.name,e.loc,void 0);return}(t==null?void 0:t.type)==="MemberExpression"&&!this.isInAssignmentTarget()||this.addUsage(e.name,e.loc)}visitAssignmentStatement(e){this.defsForAssignment(e)}visitLocalStatement(e){this.defsForAssignment(e)}defsForAssignment(e){for(let t=0;t<e.variables.length;t++){let i=e.variables[t];i.type==="Identifier"?this.defsForSimpleAssignment(i,e):i.type==="MemberExpression"&&this.defsForMemberExpressionAssignment(i)}}defsForSimpleAssignment(e,t){let i=e.name;t.type==="LocalStatement"||!this.isSymbolDefined(i)?this.addDefinition(i,e.loc,t.type==="LocalStatement"?void 0:this.globalScope()):this.addUsage(i,e.loc)}defsForMemberExpressionAssignment(e){let t=xe(e)||`self.${e.identifier.name}`,i=Nr(e),r=i==null?void 0:i.name,s=this.topScope().self;r==="self"&&s&&(r=s,t=t==null?void 0:t.replace(/\bself\b/,s)),i&&r&&this.addUsage(r,i.loc),this.addDefinition(t,e.loc,this.globalScope())}visitForGenericStatement(e){for(let t of e.variables)this.addDefinition(t.name,t.loc);return this.createDefaultScope(e)}visitForNumericStatement(e){return this.addDefinition(e.variable.name,e.variable.loc),this.createDefaultScope(e)}visitTableConstructorExpression(e){var t,i;if(this.isInAssignment()){let r=(t=this.topScope())==null?void 0:t.self,s=(i=this.topScope())==null?void 0:i.name,c=this.topNode().node;switch(c.type){case"Identifier":s=c.name;break;case"TableKeyString":s=c.key.name;break;case"MemberExpression":let y=xe(c);y&&(s=y);break}return new cn("Table",e.loc,{name:s,self:r})}return this.createDefaultScope(e,"Table")}visitTableKeyString(e){this.addDefinition(e.key.name,e.key.loc)}visitMemberExpression(e){if(this.isInAssignment())return;this.addUsagesOfBases(e);let{name:t}=this.resolveSelf(e);this.addUsage(t,e.loc)}addUsagesOfBases(e){let t=e.base;for(;;)switch(t.type){case"Identifier":this.addUsage(t.name,t.loc);return;case"MemberExpression":let i=xe(t)||`self.${t.identifier.name}`;this.addUsage(i,t.loc),t=t.base;break;default:return}}resolveSelf(e){let t=Nr(e),i=xe(e)||`self.${e.identifier.name}`,r=t==null?void 0:t.name,s=this.topScope().self;return r==="self"&&s&&(r=s,i=i.replace(/\bself\b/,s)),{name:i,baseName:r}}visitLabelStatement(e){this.addDefinition(e.label.name,e.loc,this.globalScope())}};var za=Ce(require("util"));var Ka=Object.freeze({tabSize:2,insertSpaces:!0}),Yn=class{constructor(e){this.currentIndent=0;e?this.options={...Ka,...e}:this.options=Ka,this.tab=this.options.insertSpaces?" ".repeat(this.options.tabSize):"	"}formatChunk(e,t,i){if(e.errors.length>0){console.error("can't format - errors are present!");return}let r;if(i)r={start:{line:0,character:0},end:{line:Number.MAX_VALUE,character:0}};else{let c=this.formatBoundsFromOriginalText(t);if(!c)return;r=c}this.insertComments(e),this.insertWhitespaceIntoBlock(e.block);let s=this.visitBlock(e.block,"",!0,!0);return s=s.split(`
`).map(c=>c.trimRight()).join(`
`),i||(s=s+`
`,r.end.line!==Number.MAX_VALUE&&(s+=`
`)),{formattedText:s,formattedRange:r}}formatBoundsFromOriginalText(e){let t=e.split(`
`).map(c=>c.trim()),i,r=Number.MAX_VALUE,s=!1;for(let c=0;c<t.length;c++){let y=t[c];if(!s&&Ia(y))i=c+1,s=!0;else if(s&&_r(y)){r=c;break}}if(!!i)return{start:{line:i,character:0},end:{line:r,character:0}}}insertWhitespaceIntoBlock(e){!e||this.insertWhitespaceIntoArray(e.body)}insertWhitespaceIntoArray(e){let t=e[0];for(let i=1;i<e.length;i++){this.maybeRecurseToInsertWhitespace(t);let r=e[i];if(r.included)continue;let s=r.loc.start.line,c=t.loc.end.line;if(s-c>1){let y=t.loc.end,b=r.loc.start,x=s-c-1,k=b.line-1;e.splice(i,0,{type:"Whitespace",count:x,loc:{start:{line:k,column:0,index:y.index+1,filename:y.filename},end:{line:k,column:0,index:b.index-1,filename:b.filename}}}),i++}t=r}e.length>0&&this.maybeRecurseToInsertWhitespace(e[e.length-1])}maybeRecurseToInsertWhitespace(e){if(!(!e||e.included)){if(Fr(e)){this.insertWhitespaceIntoBlock(e.block);return}if(Dr(e)){this.maybeRecurseToInsertWhitespace(e.value);return}switch(e.type){case"IfStatement":e.clauses.map(i=>i.block).forEach(i=>this.insertWhitespaceIntoBlock(i));return;case"ReturnStatement":this.insertWhitespaceIntoArray(e.arguments);return;case"AssignmentStatement":case"LocalStatement":this.insertWhitespaceIntoArray(e.init),this.insertWhitespaceIntoArray(e.variables);return;case"TableConstructorExpression":this.insertWhitespaceIntoArray(e.fields);return;case"CallExpression":this.insertWhitespaceIntoArray(e.arguments);return;case"BinaryExpression":case"LogicalExpression":let t=e;this.maybeRecurseToInsertWhitespace(t.left),this.maybeRecurseToInsertWhitespace(t.right);return}}}insertComments(e){e.comments.forEach(t=>this.insertComment(t,e.block.body,!0))}insertComment(e,t,i,r){for(let s=0;s<t.length;s++){let c=t[s];if(c.included)continue;let y=xr(e.loc,c.loc);if(y===0)return this.insertCommentIntoNode(e,c),!0;if(y===-1)return i?t.splice(s,0,e):this.putCommentOnNode(c,e),!0}return r?!1:(t.push(e),!0)}insertCommentIntoNode(e,t){if(!(Aa(t)&&this.maybeInsertCommentOnNode(e,t.condition))){if(Fr(t)){this.insertComment(e,t.block.body,!0);return}if(Dr(t)){this.insertCommentIntoNode(e,t.value);return}switch(t.type){case"IfStatement":this.insertComment(e,t.clauses,!1);return;case"ReturnStatement":this.insertComment(e,t.arguments,!1);return;case"AssignmentStatement":case"LocalStatement":this.insertComment(e,t.init,!1,!0)||this.insertComment(e,t.variables,!1);return;case"TableConstructorExpression":this.insertComment(e,t.fields,!0);return;case"CallStatement":let r=t.expression;if(r&&r.arguments){this.insertComment(e,r.arguments,!0);return}break;case"CallExpression":let s=t;if(s&&s.arguments){this.insertComment(e,s.arguments,!0);return}return;case"BinaryExpression":case"LogicalExpression":let c=t;if(this.maybeInsertCommentOnNode(e,c.left)||this.maybeInsertCommentOnNode(e,c.right))return;break}this.putCommentOnNode(t,e)}}maybeInsertCommentOnNode(e,t){let i=xr(e.loc,t.loc);return i===0?(this.insertCommentIntoNode(e,t),!0):i===-1?(this.putCommentOnNode(t,e),!0):!1}putCommentOnNode(e,t){e.comments===void 0?e.comments=[t]:e.comments.push(t)}newline(){return`
`+this.tabsForDepth()}tabsForDepth(){let e="";for(let t=0;t<this.currentIndent;t++)e+=this.tab;return e}increaseDepth(e=1){this.currentIndent+=e}decreaseDepth(e=1){this.currentIndent-=e}commentsBeforeNode(e,t,i){let r="";if(e.comments!==void 0){t||this.increaseDepth();for(let s=0;s<e.comments.length;s++){let c=e.comments[s];t||(r+=this.newline()),r+=this.visitComment(c),(!i||s!==e.comments.length-1)&&(r+=this.newline())}}return r}visitStatement(e){let t=this.currentIndent,i=this.commentsBeforeNode(e);switch(e.type){case"AssignmentStatement":i+=this.visitAssignmentStatement(e);break;case"BreakStatement":i+=this.visitBreakStatement(e);break;case"CallStatement":i+=this.visitCallStatement(e);break;case"DoStatement":i+=this.visitDoStatement(e);break;case"ForGenericStatement":i+=this.visitForGenericStatement(e);break;case"ForNumericStatement":i+=this.visitForNumericStatement(e);break;case"FunctionDeclaration":i+=this.visitFunctionDeclaration(e);break;case"GotoStatement":i+=this.visitGotoStatement(e);break;case"IfStatement":i+=this.visitIfStatement(e);break;case"IncludeStatement":i+=this.visitIncludeStatement(e);break;case"LabelStatement":i+=this.visitLabelStatement(e);break;case"LocalStatement":i+=this.visitLocalStatement(e);break;case"RepeatStatement":i+=this.visitRepeatStatement(e);break;case"ReturnStatement":i+=this.visitReturnStatement(e);break;case"WhileStatement":i+=this.visitWhileStatement(e);break;case"Comment":i+=this.visitComment(e);break;case"Whitespace":i+=this.visitWhitespace(e);break;default:throw new Error("Unexpected statement type: "+e.type)}return this.currentIndent=t,i}visitBlock(e,t,i,r){let s="";t!=null||(t="do"),s+=t,r||this.increaseDepth();let c=e.body,y=!!this.options.forceSeparateLines;for(let b=0;b<c.length;b++){let x=c[b];if(!x.included){if(b!==0||!r)if(y)s+=this.newline();else{let k=b>0?c[b-1]:void 0;s+=k&&!k.included&&k.loc.end.line===x.loc.start.line?" ":this.newline()}s+=this.visitStatement(x).trimRight()}}return r||this.decreaseDepth(),i||(s+=this.newline(),s+="end"),s}visitGeneralIfClause(e){switch(e.type){case"IfClause":return this.visitIfClause(e);case"ElseClause":return this.visitElseClause(e);case"ElseifClause":return this.visitElseifClause(e);case"Comment":return this.visitComment(e)+this.newline();case"Whitespace":return this.visitWhitespace(e)+this.newline();default:throw new Error("Unexpected if clause type: "+e.type+", "+za.inspect(e,{depth:99}))}}visitExpression(e,t={}){let i=this.currentIndent,r=this.commentsBeforeNode(e);switch(e.type){case"FunctionDeclaration":r+=this.visitFunctionDeclaration(e);break;case"BinaryExpression":r+=this.visitBinaryOrLogicalExpression(e,t);break;case"BooleanLiteral":r+=this.visitBooleanLiteral(e);break;case"CallExpression":r+=this.visitCallExpression(e);break;case"IndexExpression":r+=this.visitIndexExpression(e);break;case"Identifier":r+=this.visitIdentifier(e);break;case"LogicalExpression":r+=this.visitBinaryOrLogicalExpression(e,t);break;case"MemberExpression":r+=this.visitMemberExpression(e);break;case"NilLiteral":r+=this.visitNilLiteral(e);break;case"NumericLiteral":r+=this.visitNumericLiteral(e);break;case"StringCallExpression":r+=this.visitStringCallExpression(e);break;case"StringLiteral":r+=this.visitStringLiteral(e);break;case"TableCallExpression":r+=this.visitTableCallExpression(e);break;case"TableConstructorExpression":r+=this.visitTableConstructorExpression(e);break;case"UnaryExpression":r+=this.visitUnaryExpression(e);break;case"VarargLiteral":r+=this.visitVarargLiteral(e);break;default:throw new Error("Unexpected expression type: "+e.type)}return this.currentIndent=i,r}visitGeneralTableField(e){let t=this.commentsBeforeNode(e,!0);switch(e.type){case"TableKey":t+=this.visitTableKey(e);break;case"TableKeyString":t+=this.visitTableKeyString(e);break;case"TableValue":t+=this.visitTableValue(e);break;case"Comment":t+=this.visitComment(e);break;case"Whitespace":t+=this.visitWhitespace(e);break;default:throw new Error("Unexpected table field type: "+e.type)}return t}visitAssignmentStatement(e){let t=e.variables.map(s=>this.visitExpression(s)),i=e.init.map(s=>this.visitExpression(s)),r=t.join(", ");return r+=" ",r+=e.operator,r+=" ",r+=i.join(", "),r}visitLocalStatement(e){var s;let t=e.variables.map(c=>this.visitExpression(c)),i=e.init.map(c=>this.visitExpression(c)),r="local ";return r+=t.join(", "),i.length>0&&(r+=" ",r+=(s=e.operator)!=null?s:"=",r+=" ",r+=i.join(", ")),r}visitBreakStatement(e){return"break"}visitCallStatement(e){if(!e.expression)throw new Error("Can't visit CallStatement with null expression!");return this.visitExpression(e.expression)}visitDoStatement(e){return this.visitBlock(e.block)}visitForGenericStatement(e){let t=e.variables.map(s=>this.visitExpression(s)),i=e.iterators.map(s=>this.visitExpression(s)),r="for ";return r+=t.join(", "),r+=" in ",r+=i.join(", "),r+=" ",r+=this.visitBlock(e.block),r}visitForNumericStatement(e){let t="for ";return t+=this.visitIdentifier(e.variable),t+=" = ",t+=this.visitExpression(e.start),t+=", ",t+=this.visitExpression(e.end),e.step&&(t+=", ",t+=this.visitExpression(e.step)),t+=" ",t+=this.visitBlock(e.block),t}visitGotoStatement(e){return"goto "+this.visitIdentifier(e.label)}visitIfStatement(e){if(e.oneLine){let i=e.clauses.filter(s=>s.type!=="Comment"),r=e.clauses.filter(s=>s.type==="Comment");if(i.length===1){let s=i[0],c=`if (${this.visitExpression(s.condition)})`;for(let y of s.block.body)c+=" "+this.visitStatement(y);for(let y of r)c+=this.newline()+this.visitComment(y);return c}}if(this.isSingleLineIfStatement(e)){if(e.clauses.length===1){let i=e.clauses[0];return e.oneLine?`if (${this.visitExpression(i.condition)}) ${this.visitStatement(i.block.body[0])}`:`if ${this.visitExpression(i.condition)} then ${this.visitStatement(i.block.body[0])} end`}else if(e.clauses.length===2&&e.clauses[1].type==="ElseClause"){let i=e.clauses[0],r=e.clauses[1];return`if ${this.visitExpression(i.condition)} then ${this.visitStatement(i.block.body[0])} else ${this.visitStatement(r.block.body[0])} end`}}let t="";for(let i of e.clauses)t+=this.visitGeneralIfClause(i);return t+="end",t}isSingleLineIfStatement(e){if(e.oneLine)return!0;let t=e.loc.start.line;return e.clauses.every(i=>i.loc.start.line===t&&i.loc.end.line===t&&!i.comments&&i.block.body.length===1&&i.block.body.every(r=>r.loc.start.line===t&&r.loc.end.line===t&&!r.comments))}visitIncludeStatement(e){return`#include ${e.filename}`}visitLabelStatement(e){let t="::";return t+=this.visitIdentifier(e.label),t+="::",t}visitRepeatStatement(e){let t=this.visitBlock(e.block,"repeat",!0);return e.condition.comments!==void 0&&(t+=this.commentsBeforeNode(e.condition,!1,!0),e.condition.comments=void 0,this.decreaseDepth()),t+=this.newline(),t+="until ",t+=this.visitExpression(e.condition),t}visitReturnStatement(e){let t="";if(!e.arguments||e.arguments.length===0)return t+="return",t;let i=e.arguments.filter(r=>r.type!=="Whitespace").map(r=>this.visitExpression(r)).join(", ");return t+="return ",t+=i,t}visitWhileStatement(e){let t="while ";return t+=this.visitExpression(e.condition),t+=this.visitBlock(e.block," do"),t}visitIfClause(e){let t="if ";return t+=this.visitExpression(e.condition),t+=this.visitBlock(e.block," then",!0),t+=this.newline(),t}visitElseifClause(e){let t="elseif ";return t+=this.visitExpression(e.condition),t+=this.visitBlock(e.block," then",!0),t+=this.newline(),t}visitElseClause(e){return this.visitBlock(e.block,"else",!0)+this.newline()}visitBooleanLiteral(e){return e.value?"true":"false"}visitNilLiteral(e){return"nil"}visitNumericLiteral(e){return e.raw}visitStringLiteral(e){return e.raw}visitVarargLiteral(e){return"..."}visitBinaryOrLogicalExpression(e,t={}){return this.wrapWithParenthesesIfNeeded({isRightSideOfAnExpression:t.isRightSideOfAnExpression,parentOperator:t.parentOperator,currentOperator:e.operator,extraIndent:!0,parens:e.parens},()=>{let i="";return i+=this.visitExpression(e.left,{parentOperator:e.operator}),e.left.loc.end.line!==e.right.loc.start.line?(this.increaseDepth(2),i+=this.newline(),e.right.comments&&(i+=this.commentsBeforeNode(e.right,!0),e.right.comments=void 0),this.decreaseDepth(2)):i+=" ",i+=`${e.operator} `,i+=this.visitExpression(e.right,{parentOperator:e.operator,isRightSideOfAnExpression:!0}),i})}visitCallExpression(e){let t=e.arguments.length>1&&e.arguments.some(c=>{var y;return c.loc.end.line!==((y=e.base.loc)==null?void 0:y.start.line)}),i=this.visitExpression(e.base,{parentOperator:le.fakeMaxPrecedenceOperator}),r=e.base.type==="Identifier"&&e.base.name==="?";e.base.type==="FunctionDeclaration"&&(i=`(${i})`);let s=this.visitCommaDelimited(e.arguments,this.visitExpression.bind(this),{multiline:t,noParens:r});return i+s}visitFunctionDeclaration(e){let t=this.options.forceSeparateLines||e.loc.start.line!==e.loc.end.line,i="";e.isLocal&&(i+="local "),i+="function",e.identifier&&(i+=" "+this.visitExpression(e.identifier)),i+="("+e.parameters.map(r=>this.visitExpression(r)).join(", ")+")",this.increaseDepth();for(let r of e.block.body)i+=t?this.newline():" ",i+=this.visitStatement(r);return this.decreaseDepth(),i+=t?this.newline():" ",i+="end",i}visitIdentifier(e){return e.name}visitIndexExpression(e){let t=this.visitExpression(e.base,{parentOperator:le.fakeMaxPrecedenceOperator});return e.base.type==="TableConstructorExpression"&&(t="("+t+")"),t+="[",t+=this.visitExpression(e.index),t+="]",t}visitMemberExpression(e){let t="";return t+=this.visitExpression(e.base,{parentOperator:le.fakeMaxPrecedenceOperator}),t+=e.indexer,t+=this.visitIdentifier(e.identifier),t}visitStringCallExpression(e){return this.visitExpression(e.base)+" "+this.visitStringLiteral(e.argument)}visitTableCallExpression(e){return this.visitExpression(e.base)+" "+this.visitTableConstructorExpression(e.arguments)}visitTableConstructorExpression(e){var i;if(!((i=e.fields)==null?void 0:i.length))return"{}";let t=e.fields.some(r=>{var s;return r.loc.end.line!==((s=e.loc)==null?void 0:s.start.line)});return this.visitCommaDelimited(e.fields,this.visitGeneralTableField.bind(this),{multiline:t,paddingForSingleLine:!0,curlyBraces:!0})}visitUnaryExpression(e){let t=e.operator;return t==="not"&&(t="not "),`${t}${this.visitExpression(e.argument)}`}visitTableKey(e){return"["+this.visitExpression(e.key)+"] = "+this.visitExpression(e.value)}visitTableKeyString(e){return this.visitIdentifier(e.key)+" = "+this.visitExpression(e.value)}visitTableValue(e){return this.visitExpression(e.value)}visitComment(e){return e.raw}visitWhitespace(e){return""}wrapWithParenthesesIfNeeded(e,t){let{parentOperator:i,currentOperator:r,isRightSideOfAnExpression:s,extraIndent:c,parens:y}=e,b=!!y,x=i?le.binaryPrecedenceOf(i):le.minPrecedenceValue;(r?le.binaryPrecedenceOf(r):le.minPrecedenceValue)<x&&(b=!0),i&&i===r&&s&&le.doesNeedParenthesesIfOnTheRightSide(i)&&(b=!0),b&&c&&this.increaseDepth();let E=t();return b&&c&&this.decreaseDepth(),b?`(${E})`:E}visitCommaDelimited(e,t,i){let r=!!i.multiline,s=r?this.newline.bind(this):()=>"",c="";i.noParens||(c=i.curlyBraces?"{":"("),r?this.increaseDepth():i.paddingForSingleLine&&(c+=" ");let y=null,b=!0,x;for(let k=0;k<e.length;k++){let E=e[k];if(!x)c+=s();else{let B=E.loc.start.line;B===x+1?c+=s():B>x+1?c+=s()+s():r&&(c+=" ")}x=E.loc.end.line;let C=E.type==="Comment",D=E.type==="Whitespace",N=!C&&!D;if(D?c+=this.visitWhitespace(E):C?c+=this.visitComment(E):(c+=t(E),b=!0),!(k===e.length-1)&&N){let B=","+(r?"":" ");y=[c.length,c.length+B.length],b=!1,c+=B}}return b||(c=c.slice(0,y[0])+c.slice(y[1])),r?(this.decreaseDepth(),c+=s()):i.paddingForSingleLine&&(c+=" "),i.noParens||(c+=i.curlyBraces?"}":")"),c}};function Ja(n){let e=[];return Ir(n,t=>e.push(t.document.textDocument.uri)),e}function Ir(n,e){let t=i=>{e(i);for(let r of i.included)t(r)};t(n.root)}function Xa(n){let e=new Map;for(let t of n.keys())Ya(t,e,n);return Array.from(e.values()).filter(t=>!t.isChild).map(t=>({root:t}))}function Ya(n,e,t){if(e.has(n))return;let i=t.get(n);if(!i)return;let r={document:i,included:[],isChild:!1};e.set(n,r);let s=i.chunk.includes;for(let c of s){let y=c.resolvedFile.fileURL,b=e.get(y);b||(b=Ya(y,e,t)),b&&(b.isChild=!0,r.included.push(b))}return r}var qr=class extends gt{constructor(){super(...arguments);this.ranges=[]}createDefaultScope(){}addExplicitRange(e,t){let i=e-1,r=t-1;i<r&&this.ranges.push({startLine:i,endLine:r})}visitIfStatement(e){if(e.loc)for(let t=0;t<e.clauses.length;t++){let i=e.clauses[t],r=t+1<e.clauses.length?e.clauses[t+1]:null;if(!i.loc)continue;let s=i.loc.start.line,c;r&&r.loc?c=r.loc.start.line-1:c=e.loc.end.line-1,this.addExplicitRange(s,c)}}visitWhileStatement(e){e.loc&&this.addExplicitRange(e.loc.start.line,e.loc.end.line)}visitDoStatement(e){e.loc&&this.addExplicitRange(e.loc.start.line,e.loc.end.line)}visitRepeatStatement(e){e.loc&&this.addExplicitRange(e.loc.start.line,e.loc.end.line)}visitForNumericStatement(e){e.loc&&this.addExplicitRange(e.loc.start.line,e.loc.end.line)}visitForGenericStatement(e){e.loc&&this.addExplicitRange(e.loc.start.line,e.loc.end.line)}visitFunctionDeclaration(e){e.loc&&this.addExplicitRange(e.loc.start.line,e.loc.end.line)}};var ln=Ce(require("url")),Ae=Ce(require("fs")),Za=Ce(require("path"));function Yh(n){let e,t;for(let i=0;i<n.length;i++){let r=n[i].trim();r==="__lua__"?e=i:r==="__gfx__"&&(t=i)}return{luaStartLine:e,gfxStartLine:t}}function Or(n,e,t,i){return{name:`${i}: ${n}`,startLine:e,endLine:t}}function Qh(n,e){let t=n[e+1];return t.raw==="-->8"?"tab":t.value.trim()||"tab"}function Qa(n,e){let t=[],i=n.getText().split(`
`),r=e.sort((D,N)=>D.loc.start.line-N.loc.start.line),{luaStartLine:s,gfxStartLine:c}=Yh(i),y=0,b,x,k=[],E=/^#region\s*(.*)$/,C=/^#endregion\s*(.*)$/;if(s!==void 0){let D=r.find(N=>N.raw==="-->8"&&N.loc.start.line-1>s);if(D){let N=s+1,$=r.find(v=>v.loc.start.line-1===N),B=$?$.value.trim():"tab";t.push(Or(B,N,D.loc.start.line-2,y++))}}for(let D=0;D<r.length;D++){let N=r[D],$=N.value.trim(),B=E.exec($);if(B){let v=B[1]?B[1].trim():"",g=v||"region";k.push({startLine:N.loc.start.line,name:g,isDefaultName:!v})}else{let v=C.exec($);if(v&&k.length>0){let g=k.pop(),R=v[1]?v[1].trim():"",I=g.name;g.isDefaultName&&R&&(I=R),t.push({name:I,startLine:g.startLine-1,endLine:N.loc.start.line-1})}}N.raw==="-->8"&&(b!==void 0&&t.push(Or(x,b,N.loc.start.line-2,y++)),b=N.loc.start.line,x=Qh(r,D))}if(b!==void 0){let D=n.lineCount-1;c!==void 0&&(D=c),t.push(Or(x,b,D,y++))}for(;k.length>0;){let D=k.pop();t.push({name:D.name,startLine:D.startLine,endLine:n.lineCount-1})}return t.sort((D,N)=>D.startLine!==N.startLine?D.startLine-N.startLine:D.endLine-N.endLine),t}console.log("PICO-8 Language Server starting.");var te=(0,J.createConnection)(J.ProposedFeatures.all),un=new J.TextDocuments(Ar.TextDocument),Mr=!1,jr=!1,bt=new Map,Qn=[],Wr=new Map;te.onInitialize(n=>{let e=n.capabilities;Mr=!!(e.workspace&&e.workspace.configuration),jr=!!(e.workspace&&e.workspace.workspaceFolders);let t={capabilities:{textDocumentSync:J.TextDocumentSyncKind.Incremental,documentSymbolProvider:!0,definitionProvider:!0,referencesProvider:!0,completionProvider:{triggerCharacters:[".",":"],resolveProvider:!0},hoverProvider:!0,signatureHelpProvider:{triggerCharacters:["("],retriggerCharacters:[","]},documentFormattingProvider:!0,foldingRangeProvider:!0,executeCommandProvider:{commands:["pico8formatFile","pico8formatFileSeparateLines"]}}};return jr&&(t.capabilities.workspace={workspaceFolders:{supported:!0}}),t});te.onInitialized(()=>{Mr&&te.client.register(J.DidChangeConfigurationNotification.type,void 0),jr&&te.workspace.onDidChangeWorkspaceFolders(n=>{te.console.log("Workspace folder change event received: "+JSON.stringify(n))}),Zn()});function Zn(){te.workspace.getWorkspaceFolders().then(n=>{!n||Promise.all(n.map(Zh)).catch(e=>{console.log("Error scanning workspace folders",e)})}).catch(n=>{console.log("Failed to get workspace folder(s):",n)})}async function Zh(n){let e=ln.fileURLToPath(n.uri),t=await ec(e);bt=(await Promise.all(t.map(tc))).map(ei).filter(r=>!!r).reduce((r,s)=>(r.set(s.textDocument.uri,s),r),new Map),nc(),Qn.forEach(ic)}async function ec(n){let e=[];try{let t=await Ae.promises.readdir(n);await Promise.all(t.map(async i=>{let r=Za.join(n,i),s=await Ae.promises.lstat(r);s.isDirectory()&&!i.startsWith(".")?e.push(...await ec(r)):s.isFile()&&/\.(p8|lua)$/i.exec(r)&&e.push(r)}))}catch(t){console.error("Error when scanning workspace folder "+n,t)}return e}async function tc(n){let e=Cr(n),t=un.get(e);if(t)return t;let i=n.endsWith("p8")?"pico-8":"pico-8-lua",r=(await Ae.promises.readFile(n)).toString();return Ar.TextDocument.create(e,i,0,r)}function nc(){Qn=Xa(bt),Wr=new Map;let n=(e,t)=>{Wr.set(e.document.textDocument.uri,t);for(let i of e.included)n(i,t)};for(let e of Qn)n(e.root,e)}function ic(n){ef(n);let e=[],t=rc(n.root.document),i=t==null?void 0:t.scopes;if(!i)return;e.push(...t.warnings);let r=c=>{let y=rc(c.document,i);y&&y.warnings&&e.push(...y.warnings);for(let b of c.included)r(b)};for(let c of n.root.included)r(c);let s={};s=e.map(c=>({uri:c.bounds.start.filename.fileURL,diagnostic:fc(c)})).reduce((c,{uri:y,diagnostic:b})=>{let x=c[y];return x===void 0&&(x=[],c[y]=x),x.push(b),c},s);for(let c in s)te.sendDiagnostics({uri:c,diagnostics:s[c]})}function ef(n){Ir(n,tf)}function tf(n){let e=bt.get(n.document.textDocument.uri);if(!e){console.log("refreshNodeContents: cannot find contents of file "+n.document.textDocument.uri);return}n.document=e}function rc(n,e){try{let t=n.textDocument.uri,{warnings:i,definitionsUsages:r,scopes:s}=Ha(n.chunk,{injectedGlobalScope:e});return cc.set(t,r),lc.set(t,s),{scopes:s,warnings:i}}catch(t){console.error(t)}}var sc={maxNumberOfProblems:1e3},nf=sc;un.onDidChangeContent(n=>{let e=n.document,t=ei(e);if(!t){console.log("Failed to parse "+e.uri);return}let i=t.chunk.includes.map(b=>b.resolvedFile.fileURL).sort(),r=bt.get(e.uri),s=r==null?void 0:r.chunk.includes.map(b=>b.resolvedFile.fileURL).sort();s=s||[],bt.set(e.uri,t);let c=i.length!==s.length;for(let b=0;b<i.length;b++)i[b]!==s[b]&&(c=!0);let y={[e.uri]:t};if(c)console.log("Found differences in #include statements -- rebuilding project tree"),nc(),rf(y);else{let b=Wr.get(e.uri);b&&oc(b,y).catch(x=>{console.error("error reparsing project files: ",x)})}});function rf(n){Qn.forEach(e=>void oc(e,n))}async function oc(n,e){let t=Ja(n);await Promise.all(t.map(async i=>{if(e[i])return;let r=await tc(ln.fileURLToPath(i)),s=ei(r);s?bt.set(r.uri,s):console.error("error parsing",r.uri)})),ic(n)}var ac=new Map;un.onDidClose(n=>ac.delete(n.document.uri));var Br=new Map,Ur=new Map,cc=new Map,lc=new Map,uc=new Map;te.onDidChangeConfiguration(n=>{Mr?ac.clear():nf=n.settings["pico8-ls"]||sc,Zn()});var sf={["Function"]:J.SymbolKind.Function,["LocalVariable"]:J.SymbolKind.Variable,["GlobalVariable"]:J.SymbolKind.Class,["Label"]:J.SymbolKind.Null};function dc(n,e){var t,i,r,s;return{start:n.positionAt((i=(t=e==null?void 0:e.start)==null?void 0:t.index)!=null?i:0),end:n.positionAt((s=(r=e==null?void 0:e.end)==null?void 0:r.index)!=null?s:0)}}function hc(n,e){return{name:e.name,detail:e.detail,kind:sf[e.type],range:dc(n,e.loc),selectionRange:dc(n,e.selectionLoc),children:e.children.map(t=>hc(n,t))}}function of(n,e){let t=e.bounds.start.filename.fileURL;return n===t}function fc(n){return{message:n.message,range:{start:{line:n.bounds.start.line-1,character:n.bounds.start.column},end:{line:n.bounds.end.line-1,character:n.bounds.end.column}},severity:n.type==="ParseError"?J.DiagnosticSeverity.Error:J.DiagnosticSeverity.Warning,source:"PICO-8 LS"}}var af={doesFileExist:n=>Ae.existsSync(n),isFile:n=>Ae.lstatSync(n).isFile(),loadFileContents:n=>{let e=ln.pathToFileURL(n).toString(),t=un.get(e);return t?t.getText():Ae.readFileSync(n).toString()}};function ei(n){try{let e=n.getText();Br.set(n.uri,n);let i=new Jn($e.fromFileURL(n.uri),e,{includeFileResolver:af}).parse(),{errors:r,symbols:s,includes:c}=i,y=s.map(C=>hc(n,C)),b=Qa(n,i.comments||[]),x=[],k=b.map(C=>{let D=J.Range.create(C.startLine,0,C.endLine,0),N=J.DocumentSymbol.create(C.name,"",J.SymbolKind.Namespace,D,D);return N.children=[],N});for(let C of y){let D;for(let N of k)if(N.range.start.line<=C.range.start.line&&N.range.end.line>=C.range.end.line){D=N;break}D?D.children.push(C):x.push(C)}Ur.set(n.uri,x.concat(k)),uc.set(n.uri,c);let E=r.filter(C=>of(n.uri,C)).map(C=>fc(C));return te.sendDiagnostics({uri:n.uri,diagnostics:E}),{textDocument:n,chunk:i,errors:r}}catch(e){$n(e)?console.error(`ParseError: ${e.stack?e.stack:e.message}
Bounds: ${kr(e.bounds)}`):console.error(e);return}}te.onDocumentSymbol(n=>Ur.get(n.textDocument.uri));function pc(n){let e=cc.get(n.textDocument.uri);if(!e){console.log(`Definition/usages lookup table unavailable for ${n.textDocument.uri} -- re-scanning`),Zn();return}return e.lookup(n.position.line+1,n.position.character)}function mc(n){return{uri:n.start.filename.fileURL,range:{start:{line:n.start.line-1,character:n.start.column},end:{line:n.end.line-1,character:n.end.column}}}}te.onDefinition(n=>{let e=uc.get(n.textDocument.uri);if(e){let i=n.position.line+1,r=n.position.character;for(let s of e){let c=s.stmt.loc;if(i===c.start.line&&r>=c.start.column&&r<=c.end.column)return[{uri:s.resolvedFile.fileURL,range:{start:{line:0,character:0},end:{line:Number.MAX_SAFE_INTEGER,character:0}}}]}}let t=pc(n);return t?t.definitions.map(i=>mc(i)):[]});te.onReferences(n=>{let e=pc(n);return e?e.usages.map(t=>mc(t)):[]});te.onDidChangeWatchedFiles(n=>{te.console.log("We received a file change event")});te.onCompletion(n=>{let e=lc.get(n.textDocument.uri);if(!e)return console.log(`Definition/usages lookup table unavailable for ${n.textDocument.uri} -- re-scanning everything`),Zn(),[];let t=n.position.line,i=$r(n.textDocument.uri,n.position),r=0,s=0,c="";if(i!==void 0){let y=cf(n.position.character,i);r=y.beginIdx,s=y.endIdx,c=y.text}return e.lookupScopeFor({line:n.position.line+1,column:n.position.character,index:0,filename:$e.fromFileURL(n.textDocument.uri)}).allSymbols().filter(y=>y.startsWith(c)).map(y=>({label:y,textEdit:{range:{start:{line:t,character:r},end:{line:t,character:s}},newText:y}}))});function Gr(n,e){var t;return e.sig?`## ${n}

\`${e.sig}\`

${e.desc}

### Params:
${(t=e.params)==null?void 0:t.map(i=>` - ${i}`).join(`
`)}`:""}te.onCompletionResolve(n=>{let e=n.label,t=Oe[e];return t&&(n.detail=t.sig,n.documentation={kind:"markdown",value:Gr(e,t)},t.deprecated&&(n.tags=[J.CompletionItemTag.Deprecated])),n});function cf(n,e){let t=n-1,i;for(i=t;i>=0;i--){let s=e.charCodeAt(i);if(!an(s)&&s!==46)break}let r=i+1;return{beginIdx:r,endIdx:n,text:e.substring(r,n)}}function gc(n,e){let t;for(t=n;t>=0;t--)if(!an(e.charCodeAt(t))){t++;break}let i=t;for(t=n;t<e.length&&an(e.charCodeAt(t));t++);let r=t;return e.substring(i,r)}function $r(n,e){let t=Br.get(n);if(!!t)return t.getText({start:J.Position.create(e.line,0),end:J.Position.create(e.line,Number.MAX_VALUE)})}te.onHover(n=>{let e=$r(n.textDocument.uri,n.position);if(!e)return;let t=gc(n.position.character,e),i=Oe[t];if(i)return{contents:Gr(t,i)}});te.onSignatureHelp(n=>{let e=$r(n.textDocument.uri,n.position);if(!e)return;let t=n.position.character,i=0;for(;t>=0&&e[t]!=="(";)e[t]===","&&i++,t--;if(t<0)return;let s=gc(t-1,e),c=Oe[s];return!c||!c.sig||!c.params?void 0:{signatures:[{label:c.sig,documentation:{kind:"markdown",value:Gr(s,c)},activeParameter:i,parameters:c.params.map(b=>{let x=b.indexOf(":");return{label:b.substring(0,x),documentation:b}})}],activeSignature:0,activeParameter:i}});te.onDocumentFormatting(n=>{let e=yc(n.textDocument.uri,n.options);return e?[e]:null});function bc(n){let e=[];for(let t of n)t.range.start.line<t.range.end.line&&e.push({startLine:t.range.start.line,endLine:t.range.end.line,kind:t.kind===J.SymbolKind.Namespace?"region":void 0}),t.children&&e.push(...bc(t.children));return e}function lf(n){let e=[];for(let t of n)t.loc&&t.loc.start.line<t.loc.end.line&&e.push({startLine:t.loc.start.line-1,endLine:t.loc.end.line-1,kind:"comment"});return e}te.onFoldingRanges(n=>{let e=n.textDocument.uri,t=bt.get(e);if(!t)return[];let i=Ur.get(e)||[],r=bc(i),s=new qr;s.visit(t.chunk);let c=s.ranges,y=lf(t.chunk.comments||[]),b=[...r,...c,...y];return Array.from(new Map(b.map(k=>[`${k.startLine}-${k.endLine}`,k])).values())});te.onExecuteCommand(n=>{switch(n.command){case"pico8formatFile":case"pico8formatFileSeparateLines":return yc(n.arguments[0],n.arguments[1]);default:console.error(`onExecuteCommand received unexpected command: ${n.command}`);break}});var uf=["pico-8","pico-8-lua"];function yc(n,e){let t=Br.get(n);if(!t)return console.error("Can't find textDocument at uri "+n),null;if(!uf.includes(t.languageId))return console.error("Unsupported language for formatter: "+t.languageId),null;let i=ei(t);if(!i||i.errors&&i.errors.length>0)return console.error(`Can't format document when there are parsing errors! (document: "${t.uri}")`),null;let r=new Yn(e).formatChunk(i.chunk,t.getText(),t.languageId==="pico-8-lua");return r?J.TextEdit.replace(r.formattedRange,r.formattedText):(console.error("Unknown error formatting document"),null)}un.listen(te);te.listen();console.log("PICO-8 Language Server launched.");
